(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{272:function(e,t,a){e.exports=a(504)},277:function(e,t,a){},418:function(e,t){},504:function(e,t,a){"use strict";a.r(t);var r=a(0),n=a.n(r),o=a(10),s=a.n(o),i=(a(277),a(16)),c=a(17),l=a(19),u=a(18),d=a(20),m=a(525),p=a(529),f=a(509),h=a(29),g=a.n(h),b=a(39),y=a(506),v=a(518),E=a(524),C=a(187),S=a(140),j=a(508),k=a(527),w=a(9),O=a(507),x=a(528);function _(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return void 0===e&&console.log("El par\xe1metro 'query' de la funcion gql est\xe1 vac\xedo"),a+"/graphql?query="+e.replace(/\n/gi,"%0A").replace(/:/gi,"%3A").replace(/\\/gi,"%22").replace(/ {2}/gi,"%09").replace(/ /gi,"%20").replace(/{/gi,"%7B").replace(/}/gi,"%7D").replace(/\(/gi,"%28").replace(/\)/gi,"%29").split("$").map(function(e,a){return a%2?t[e]:e}).reduce(function(e,t){return e+t},"")}function A(){return"undefined"!==window.localStorage.getItem("jwt")?JSON.parse(window.localStorage.getItem("jwt")):void 0}function I(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"application/json",a=A(),r={Accept:t,"Content-Type":t};return a&&!e&&(r.Authorization="Bearer "+a),r}function D(){var e=window.localStorage.getItem("user");return["undefined","",void 0].includes(e)?void 0:JSON.parse(window.localStorage.getItem("user"))}function P(e){window.localStorage.setItem("jwt",JSON.stringify(e.jwt)),window.localStorage.setItem("user",JSON.stringify(e.user))}var N=a(67),U=a(26),M="CARGAR_USUARIOS",T="CARGAR_CALENDARIO",R="CARGAR_ES",L="CARGAR_DOCUMENTOS",q="CARGAR_GRUPOS",Y="CARGAR_PWS",B="CARGAR_AUTH",G="CAMBIAR_BLUE_COLLAR";a(287);function F(e){return e.json?e.json():e}function z(e){return e.status>=200&&e.status<300?e:F(e).then(function(t){t.errors&&t.errors.forEach(function(e){console.log(e)});var a=new Error(e.statusText);throw a.response=e,a.response.payload=t,a})}function H(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];a&&(t.headers=Object.assign({"Content-Type":"application/json"},t.headers,{}));var r=A();if(r&&(t.headers=Object.assign({Authorization:"Bearer ".concat(r)},t.headers)),t&&t.params){var n=function(e){return Object.keys(e).map(function(t){return"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(e[t]))}).join("&")}(t.params);e="".concat(e,"?").concat(n)}return t&&t.body&&a&&(t.body=JSON.stringify(t.body)),fetch("https://we.blacknosaur.com"+e,t).then(z).then(F)}var J=function(){return function(e){return H("/users?_limit=0&equipo="+(D()&&D().equipo)).then(function(t){e({type:M,payload:t})}).catch(function(e){throw e})}};var W=function(){return function(e){return H("/users/me").then(function(t){e({type:B,payload:t})}).catch(function(e){throw e})}};var V=function(){return function(e){return H(_((t=D(),t.equipo?'{\n    dias(where: { equipo: "'.concat(t.equipo,'" }, limit: 10000){\n        _id\n        fecha\n        tipo\n        aprobado\n        nombre\n        user{\n            _id\n            username\n            avatar{\n                url\n            }\n        }\n    }\n}'):"{}"))).then(function(t){var a;e((a=t.data.dias,{type:T,payload:a}))}).catch(function(e){throw e});var t}};var K=function(){return function(e){return H(_((t=D(),t.equipo?'{\n    equipo(id: "'.concat(t.equipo,'"){\n        users{\n            _id\n            username\n            avatar{\n                url\n            }\n            registros{\n                _id\n                fecha\n                idcard\n                aprobado\n                user{\n                    _id\n                    username\n                }\n                ultimoEditor{\n                    _id\n                    username\n                }\n            }\n            duracionjornada\n        }\n    }\n}'):"{}"))).then(function(t){var a;e((a=t.data.equipo&&t.data.equipo.users,{type:R,payload:a}))}).catch(function(e){throw e});var t}};var Z=function(){return function(e){return H("/documentos?_limit=0").then(function(t){e({type:L,payload:t})}).catch(function(e){throw e})}};var Q=function(){return function(e){return H("/grupos?_limit=0").then(function(t){e({type:q,payload:t})}).catch(function(e){throw e})}};var $=function(){return function(e){return H("/pws?_limit=0").then(function(t){e({type:Y,payload:t})}).catch(function(e){throw e})}},X=(r.Component,function(e){function t(){return Object(i.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=D();return("object"!==typeof e||null===e||!1!==e.blocked||this.props.blue?{role:{name:"Not Authorised"}}:e).manager?this.props.children:""}}]),t}(r.Component)),ee=y.a.Header,te=y.a.Footer,ae=y.a.Sider,re=y.a.Content,ne=v.a.Title,oe=v.a.Paragraph,se=function(e){function t(){var e,a;Object(i.a)(this,t);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={user:{username:" ",avatar:{}},local:!1},a.cerrarSesion=function(){window.localStorage.removeItem("jwt"),window.localStorage.removeItem("user"),E.a.info("\xa1Vuelve pronto!"),a.props.history.push("/login")},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=Object(b.a)(g.a.mark(function e(){var t,a,r,n,o,s=this;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=D(),this.props.socket.on("notification",function(e){e.es?s.props.dispatch(K()):e.dia?s.props.dispatch(V()):e.user&&s.props.dispatch(J())}),a=[].concat.apply([],this.props.es.map(function(e){return e.registros})).map(function(e){return e.aprobado}),r=!(!this.props.dias.map(function(e){return e.aprobado}).includes(null)&&!this.props.dias.map(function(e){return e.aprobado}).includes(!1)),n=!(!a.includes(!1)&&!a.includes(null)),o=!!this.props.usuarios.map(function(e){return e.confirmed}).includes(!1),this.setState({user:t,diasPorConfirmar:r,registrosPorConfirmar:n,usuariosPorConfirmar:o});case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"componentDidUpdate",value:function(e,t){if(this.props.dias!==e.dias)this.props.dias.map(function(e){return e.aprobado}).includes(null)||this.props.dias.map(function(e){return e.aprobado}).includes(!1)?this.setState({diasPorConfirmar:!0}):this.setState({diasPorConfirmar:!1});else if(this.props.es!==e.es){var a=[].concat.apply([],this.props.es.map(function(e){return e.registros})).map(function(e){return e.aprobado});a.includes(!1)||a.includes(null)?this.setState({registrosPorConfirmar:!0}):this.setState({registrosPorConfirmar:!1})}else this.props.usuarios!==e.usuarios&&(this.props.usuarios.map(function(e){return e.confirmed}).includes(!1)?this.setState({usuariosPorConfirmar:!0}):this.setState({usuariosPorConfirmar:!1}))}},{key:"render",value:function(){var e=this,t=this.state.user,a=this.props.isLogged,r=n.a.createElement(C.b,null,n.a.createElement(C.b.Item,null,n.a.createElement(O.a,{to:"/perfil"},"Perfil")),n.a.createElement(C.b.Item,{onClick:this.cerrarSesion},n.a.createElement("span",null,"Cerrar sesi\xf3n")),t&&t.manager&&n.a.createElement(C.b.Item,{onClick:function(){return e.props.dispatch((t=!e.props.blueCollar,{type:G,payload:t}));var t}},n.a.createElement("span",null,this.props.blueCollar?"Modo Manager":"Modo Blue Collar")));return n.a.createElement("div",{style:{minHeight:"100vh",display:"flex",flexDirection:"column"}},n.a.createElement(ee,{key:"header",style:{backgroundColor:"black",display:"flex",alignItems:"center",justifyContent:"space-between"}},n.a.createElement(ne,{style:{color:"#f0f0f0",margin:"0.25em",display:"flex",alignItems:"center"}},n.a.createElement("img",{src:"https://we.blacknosaur.com/logo.png",alt:"Blacknosaur Logo",style:{filter:"invert(1)",height:45,marginRight:20}})," Portal del Blacknosaurio"),a&&n.a.createElement(S.a,{overlay:r},n.a.createElement(j.a,{style:{boxShadow:this.props.blueCollar?"inset 0 0 4px 1px blue":"none"},src:t&&t.avatar&&"https://we.blacknosaur.com"+t.avatar.url},t&&t.username[0].toUpperCase()))),n.a.createElement(y.a,{key:"layout",style:{flex:1}},a&&n.a.createElement(ae,{style:{backgroundColor:"#191919"}},n.a.createElement(C.b,{theme:"dark",style:{backgroundColor:"#191919"},mode:"vertical-left",selectedKeys:[window.location.pathname]},n.a.createElement(C.b.Item,{key:"/calendario",style:{display:"flex",alignItems:"center"}},n.a.createElement(O.a,{to:"/calendario"},"Calendario"),this.state.diasPorConfirmar&&t&&t.manager&&!this.props.blueCollar&&n.a.createElement(k.a,{style:{transform:"initial",position:"static",marginLeft:10},count:n.a.createElement(w.a,{type:"bell",style:{color:"#f5222d"}})})),n.a.createElement(C.b.Item,{key:"/archivos"},n.a.createElement(O.a,{to:"/archivos"},"Documentos")),n.a.createElement(C.b.Item,{key:"/registro",style:{display:"flex",alignItems:"center"}},n.a.createElement(O.a,{to:"/registro"},"Registro E/S"),this.state.registrosPorConfirmar&&t&&t.manager&&!this.props.blueCollar&&n.a.createElement(k.a,{style:{transform:"initial",position:"static",marginLeft:10},count:n.a.createElement(w.a,{type:"bell",style:{color:"#f5222d"}})})),n.a.createElement(C.b.Item,{key:"/usuarios",style:{alignItems:"center"}},n.a.createElement(O.a,{to:"/usuarios"},"Usuarios"),this.state.usuariosPorConfirmar&&t&&t.manager&&!this.props.blueCollar&&n.a.createElement(k.a,{style:{transform:"initial",position:"static",marginLeft:10},count:n.a.createElement(w.a,{type:"bell",style:{color:"#f5222d"}})})),n.a.createElement(C.b.Item,{key:"/grupos",style:{alignItems:"center",display:t&&t.manager&&!this.props.blueCollar?"flex":"none"}},n.a.createElement(O.a,{to:"/grupos"},"Grupos")),n.a.createElement(C.b.Item,{key:"/passwords",style:{alignItems:"center"}},n.a.createElement(O.a,{to:"/passwords"},"Contrase\xf1as")),n.a.createElement(C.b.Item,{key:"/configuracion",style:{alignItems:"center",display:t&&t.manager&&!this.props.blueCollar?"flex":"none"}},n.a.createElement(O.a,{to:"/configuracion"},"Configuraci\xf3n")),n.a.createElement(C.b.Item,{key:"telefonillo",className:"telefonillo",style:{alignItems:"center",display:"flex",justifyContent:"space-between"}},n.a.createElement("a",{href:"http://192.168.1.65:24491",target:"_blank",rel:"noopener noreferrer"},"Telefonillo ")))),n.a.createElement(y.a,null,n.a.createElement(re,{style:{padding:"2em",display:"flex",flexDirection:"column"}},n.a.createElement("div",{style:{flex:1}},this.props.children),n.a.createElement(te,{style:{paddingBottom:0}},n.a.createElement(oe,null,"\xae 2019 - Made with ",n.a.createElement("span",{role:"img","aria-label":"heart"},"\u2764\ufe0f"),", ",n.a.createElement("span",{role:"img","aria-label":"beer"},"\ud83c\udf7a")," and ",n.a.createElement("span",{role:"img","aria-label":"poo"},"\ud83d\udca9")," by ",n.a.createElement("a",{href:"https://blacknosaur.com",target:"_blank",rel:"noopener noreferrer"},"Blacknosaur")," & ",n.a.createElement("a",{href:"https://www.alhill.dev",target:"_blank",rel:"noopener noreferrer"},"AlHill Development")))))))}}]),t}(r.Component),ie=Object(N.socketConnect)(Object(U.b)(function(e){return{blueCollar:e.blueCollar,es:e.es,usuarios:e.usuarios,dias:e.dias}})(Object(x.a)(se))),ce=a(516),le=a(514),ue=a(521),de=a(96),me=a(55),pe=a(41);var fe=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).handleSubmit=function(e){e.preventDefault(),a.props.form.validateFields(function(e,t){e||fetch("https://we.blacknosaur.com/auth/local",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({identifier:t.userName,password:t.password})}).then(function(e){e.json().then(function(e){console.log(e.user),400===e.statusCode?a.setState({error:!0}):e.user.confirmed?(a.setState({error:!1}),P(e),a.props.dispatch(W()),a.props.dispatch(J()),a.props.dispatch(V()),a.props.dispatch(K()),a.props.history.push("/calendario")):E.a.info("Tu acceso al equipo de trabajo todav\xeda no ha sido aprobado")}).catch(function(e){return console.log(e)})}).catch(function(e){return console.log(e)})})},a.state={error:!1},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.props.form.validateFields(),A()&&this.props.history.push("/")}},{key:"render",value:function(){var e,t=this,a=this.props.form,r=a.getFieldDecorator,o=a.getFieldsError,s=a.getFieldError,i=a.isFieldTouched,c=i("userName")&&s("userName"),l=i("password")&&s("password");return n.a.createElement(y.a,{style:{height:"100vh"}},n.a.createElement(ie,{isLogged:!!A()},n.a.createElement(y.a.Content,{style:{display:"flex",justifyContent:"center",alignItems:"center"}},n.a.createElement(ce.a,{style:{width:450,maxWidth:"90%"}},n.a.createElement(le.a,{onSubmit:this.handleSubmit},n.a.createElement(le.a.Item,{validateStatus:c||this.state.error?"error":"",help:c||""},r("userName",{rules:[{required:!0,message:"Introduce tu nombre de usuario"}]})(n.a.createElement(ue.a,{onChange:function(e){return t.setState({user:e.target.value})},prefix:n.a.createElement(w.a,{type:"user",style:{color:"rgba(0,0,0,.25)"}}),placeholder:"Nombre de usuario"}))),n.a.createElement(le.a.Item,{validateStatus:l||this.state.error?"error":"",help:l||""},r("password",{rules:[{required:!0,message:"Introduce tu contrase\xf1a"}]})(n.a.createElement(ue.a,{onChange:function(e){return t.setState({pw:e.target.value})},prefix:n.a.createElement(w.a,{type:"lock",style:{color:"rgba(0,0,0,.25)"}}),type:"password",placeholder:"Contrase\xf1a"}))),n.a.createElement(le.a.Item,null,n.a.createElement(de.a,null,n.a.createElement(me.a,{span:12,style:{justifyContent:"center",display:"flex"}},n.a.createElement(pe.a,{type:"primary",onClick:function(){return t.props.history.push("/register")}},"Registrarse")),n.a.createElement(me.a,{span:12,style:{justifyContent:"center",display:"flex"}},n.a.createElement(pe.a,{type:"primary",htmlType:"submit",disabled:(e=o(),Object.keys(e).some(function(t){return e[t]}))},"Acceder")))))))))}}]),t}(r.Component),he=le.a.create({name:"login_form"})(Object(U.b)()(fe)),ge=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).handleSubmit=function(e){e.preventDefault(),a.props.form.validateFields(function(e,t){e||(t.password===t.password2?a.validateEmail(t.email)?fetch("https://we.blacknosaur.com/auth/local/register",{method:"POST",headers:I(!0),body:JSON.stringify({username:t.userName,password:t.password,email:t.email,confirmed:!1})}).then(function(e){e.json().then(function(e){P(e),a.props.history.push("/nuevousuario")}).catch(function(e){return console.log(e)})}).catch(function(e){return console.log(e)}):a.setState({errorEmail:!0}):a.setState({errorPw:!0}))})},a.state={errorUser:!1,errorEmail:!1,errorPw:!1},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.props.form.validateFields()}},{key:"validateEmail",value:function(e){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(e).toLowerCase())}},{key:"render",value:function(){var e=this,t=this.props.form,a=t.getFieldDecorator,r=t.getFieldError,o=t.isFieldTouched,s=o("userName")&&r("userName"),i=o("email")&&r("email"),c=o("password")&&r("password"),l=o("password2")&&r("password2");return n.a.createElement(y.a,{style:{height:"100vh"}},n.a.createElement(ie,{isLogged:!!A()},n.a.createElement(y.a.Content,{style:{display:"flex",justifyContent:"center",alignItems:"center"}},n.a.createElement(ce.a,{style:{width:450,maxWidth:"90%"}},n.a.createElement(le.a,{onSubmit:this.handleSubmit},n.a.createElement(le.a.Item,{validateStatus:s||this.state.errorUser?"error":"",help:s||""},a("userName",{rules:[{required:!0,message:"Introduce tu nombre de usuario"}]})(n.a.createElement(ue.a,{onChange:function(t){return e.setState({user:t.target.value})},prefix:n.a.createElement(w.a,{type:"user",style:{color:"rgba(0,0,0,.25)"}}),placeholder:"Nombre de usuario"}))),n.a.createElement(le.a.Item,{validateStatus:i||this.state.errorEmail?"error":"",help:i||""},a("email",{rules:[{required:!0,message:"Introduce tu email"}]})(n.a.createElement(ue.a,{onChange:function(t){return e.setState({email:t.target.value})},prefix:n.a.createElement(w.a,{type:"mail",style:{color:"rgba(0,0,0,.25)"}}),type:"email",placeholder:"Email"}))),n.a.createElement(le.a.Item,{validateStatus:c||this.state.errorPw?"error":"",help:c||""},a("password",{rules:[{required:!0,message:"Introduce tu contrase\xf1a"}]})(n.a.createElement(ue.a,{onChange:function(t){return e.setState({pw:t.target.value})},prefix:n.a.createElement(w.a,{type:"lock",style:{color:"rgba(0,0,0,.25)"}}),type:"password",placeholder:"Contrase\xf1a"}))),n.a.createElement(le.a.Item,{validateStatus:l||this.state.errorPw?"error":"",help:l||""},a("password2",{rules:[{required:!0,message:"Repite la contrase\xf1a"}]})(n.a.createElement(ue.a,{onChange:function(t){return e.setState({pw:t.target.value})},prefix:n.a.createElement(w.a,{type:"lock",style:{color:"rgba(0,0,0,.25)"}}),type:"password",placeholder:"Repetir contrase\xf1a"}))),n.a.createElement(le.a.Item,null,n.a.createElement(de.a,null,n.a.createElement(me.a,{style:{justifyContent:"center",display:"flex"}},n.a.createElement(pe.a,{type:"primary",onClick:this.handleSubmit},"Registrarse")))))))))}}]),t}(r.Component),be=le.a.create({name:"register_form"})(ge),ye=function(){return n.a.createElement(y.a,{style:{height:"100vh"}},n.a.createElement(ie,{isLogged:!!A()},n.a.createElement(y.a.Content,{style:{display:"flex",justifyContent:"center",alignItems:"center"}},n.a.createElement(ce.a,{style:{width:450,maxWidth:"90%"}},n.a.createElement(v.a.Title,{style:{margin:0,textAlign:"center"}},"404!")))))},ve=(a(391),a(512)),Ee=a(265),Ce=a.n(Ee),Se=a(7),je=a.n(Se),ke=(a(392),a(255)),we=a.n(ke),Oe=a(269),xe=a(526),_e=function(e){var t=e.component,a=e.onlyManager,r=void 0!==a&&a,o=Object(Oe.a)(e,["component","onlyManager"]),s=D();return n.a.createElement(f.a,Object.assign({},o,{render:function(e){return s&&(!r||r&&s.manager)?n.a.createElement(t,e):n.a.createElement(xe.a,{to:{pathname:"/login",state:{from:e.location}}})}}))},Ae=a(43),Ie=function(e){function t(){var e,a;Object(i.a)(this,t);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this;fetch("https://opendata.aemet.es/opendata/api/prediccion/especifica/municipio/horaria/28079/?api_key=eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJhbHZhcm9naWxAYmxhY2tub3NhdXIuY29tIiwianRpIjoiNTQwNjQ0NzEtMzhiMC00MTRiLWE3MDktMGYxYTVmY2JkOGUyIiwiaXNzIjoiQUVNRVQiLCJpYXQiOjE1NjAyNTcyNTMsInVzZXJJZCI6IjU0MDY0NDcxLTM4YjAtNDE0Yi1hNzA5LTBmMWE1ZmNiZDhlMiIsInJvbGUiOiIifQ.ihZx3I_3987zhxRmM8oA8_-hSI9OTakxR6e-WmU5fjs",{headers:{"Cache-Control":"no-cache"}}).then(function(t){t.json().then(function(t){fetch(t.datos).then(function(t){t.json().then(function(t){var a=t[0].prediccion.dia.map(function(e){var t=e.estadoCielo.map(function(e){return e.periodo});return Object(Ae.a)({},je()().isSame(e.fecha,"day")?"Hoy":je()().add(1,"day").isSame(e.fecha,"day")?"Ma\xf1ana":"borrar",t.map(function(t){return{hora:t,estadoCielo:e.estadoCielo.find(function(e){return e.periodo===t}).value,temperatura:e.temperatura.find(function(e){return e.periodo===t}).value}}))}).filter(function(e){return"borrar"!==Object.keys(e)[0]});console.log(a),e.setState({meteo:a})})})}).catch(function(e){console.log(e)})}).catch(function(e){console.log(e)})}},{key:"render",value:function(){return n.a.createElement(y.a,{style:{height:"100vh"}},n.a.createElement(ie,{isLogged:!!A()},n.a.createElement("h1",null,"Hola, ",D().nombre),n.a.createElement("br",null),this.state.meteo&&this.state.meteo.map(function(e,t){return n.a.createElement("div",{key:"d"+t},n.a.createElement("h3",null,Object.keys(e)[0]),n.a.createElement("div",{style:{display:"inline-flex",border:"1px solid gainsboro",borderRadius:3,boxShadow:"rgba(0, 0, 0, 0.1) 1px 1px 5px 0px",overflowX:"auto",marginBottom:"1em"}},Object.values(e)[0].map(function(e){return n.a.createElement("div",{style:{display:"flex",flex:1,flexDirection:"column"}},n.a.createElement("div",{style:{backgroundColor:"#333",color:"white",padding:5,textAlign:"center"}},e.hora,":00"),n.a.createElement("div",{style:{padding:5,textAlign:"center",fontWeight:"bold",color:e.temperatura<=15?"#2222cc":e.temperatura>=28?"#cc0000":"#333"}},e.temperatura,"\xba"),n.a.createElement("div",{style:{display:"flex",justifyContent:"center",alignItems:"center"}},n.a.createElement("img",{src:"".concat("","/meteo/").concat(e.estadoCielo,".png")})))})))})))}}]),t}(r.Component),De=a(24),Pe=a(36),Ne=a(510),Ue=a(511),Me=a(268),Te=a(102),Re=a(523),Le=a(513),qe=a(520),Ye=(D()&&'{\n    dias(where: { equipo: "'.concat(D().equipo,'" }){\n        _id\n        fecha\n        tipo\n        aprobado\n        user{\n            _id\n            username\n            avatar{\n                url\n            }\n        }\n    }\n}'),function(e){function t(){var e,a;Object(i.a)(this,t);for(var r=arguments.length,o=new Array(r),s=0;s<r;s++)o[s]=arguments[s];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).state={modalPedirDia:!1,dias:[],diasFilter:[],diasPorAprobar:[],festivos:[],festivosArrUTC:[],sel1:"libres",sel2:"global"},a.fetchDias=Object(b.a)(g.a.mark(function e(){return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.props.dispatch(V());case 2:a.organizarDias();case 3:case"end":return e.stop()}},e)})),a.organizarDias=function(){var e=a.props.dias,t=a.props.dias.filter(function(e){return"festivo"===e.tipo}).map(function(e){return Object(Pe.a)({},e,{fecha:je.a.utc(e.fecha).hour(0).minute(0).seconds(0).milliseconds(0).format()})}),r=t.map(function(e){return je.a.utc(e.fecha).hour(2).minute(0).seconds(0).milliseconds(0).format()});a.setState({dias:e,festivos:t,festivosArrUTC:r,diasFilter:a.filtrarDias(e),diasPorAprobar:e.filter(function(e){return!e.aprobado}).map(function(e){return Object(Pe.a)({},e,{key:e._id})})})},a.filtrarDias=function(e){var t="libres"===a.state.sel1?e.filter(function(e){return"libre"===e.tipo}):e.filter(function(e){return"remoto"===e.tipo});return"aprobados"===a.state.sel2?t.filter(function(e){return e.aprobado&&e.user._id===D()._id}):"pendientes"===a.state.sel2?t.filter(function(e){return!e.aprobado&&e.user._id===D()._id}):t.filter(function(e){return e.aprobado})},a.responderSolicitud=function(e,t){t?H("/dias/"+e._id,{method:"PUT",body:{aprobado:!0}}).then(function(t){E.a.success("Se ha aprobado la solicitud de ".concat(e.user.username," de d\xeda ").concat(e.tipo," el d\xeda ").concat(je()(e.fecha).format("YYYY-MM-DD"))),a.fetchDias()}).catch(function(t){console.error(t),E.a.error("Se ha producido un error durante la aprobaci\xf3n del d\xeda ".concat(e.tipo," solicitado"))}):H("/dias/"+e._id,{method:"DELETE"}).then(function(t){E.a.info("Se ha denegado la solicitud de d\xeda "+e.tipo),a.fetchDias()}).catch(function(t){E.a.error("Se ha producido un error durante la denegaci\xf3n del d\xeda ".concat(e.tipo," solicitado")),console.error(t)})},a.getListData=function(e){return a.state.diasFilter.filter(function(t){return je()(t.fecha).format("YYYYMMDD")===je()(e).format("YYYYMMDD")}).map(function(e){return{user:e.user.username,fecha:je()(e.fecha),avatar:e.user.avatar&&"https://we.blacknosaur.com"+e.user.avatar.url}})||[]},a.dateFullCellRender=function(e){console.log(e);var t=a.getListData(e),r=je.a.utc(e.hour(2).minute(0).seconds(0).milliseconds(0)).format(),o=a.state.festivos.find(function(e){return je.a.utc(e.fecha).format()===r}),s={title:o?o.nombre:e.format("LL"),color:o?"rgba(255, 40, 30, 0.5)":[0,6].includes(e.day())?"rgba(255, 200, 100, 0.5)":"transparent"};return n.a.createElement("div",{className:"ant-fullcalendar-date",style:{backgroundColor:s.color,margin:"-1px 0",borderRadius:3},title:s.title},n.a.createElement("div",{className:"ant-fullcalendar-value"},e.date()),n.a.createElement("div",{className:"ant-fullcalendar-content"},n.a.createElement("ul",{className:"events"},t.map(function(e){return n.a.createElement(Ne.a,{key:e.user+e.fecha,content:n.a.createElement("span",null,e.user)},n.a.createElement(j.a,{src:e.avatar?e.avatar:null},e.user[0].toUpperCase()))}))))},a.solicitarDia=function(e,t){var r=D(),n=r._id,o=r.equipo;console.log(D()),console.log(t),fetch("https://we.blacknosaur.com/dias",{method:"POST",headers:I(),body:JSON.stringify({fecha:e,tipo:t,user:n,equipo:o})}).then(function(e){e.json().then(function(e){console.log(e),E.a.info("Has solicitado como d\xeda ".concat(t," el ").concat(je()(a.state.dia).format("DD/MM/YYYY"),". Tu solicitud est\xe1 pendiente de aprobaci\xf3n")),a.fetchDias(),a.setState({modalPedirDia:!1,dias:[].concat(Object(De.a)(a.state.dias),[e])})}).catch(function(e){return console.log(e)})}).catch(function(e){return console.log(e)})},a.lanzarModalDia=function(e){var t=a.state.dias.filter(function(e){return e.user&&e.user._id===D()._id});if(je()().isSameOrBefore(e,"day"))if(void 0===a.state.festivos.find(function(t){return je()(t.fecha).isSame(e,"day")})){var r=t.find(function(t){return je()(t.fecha).isSame(e,"day")});r?r.aprobado||E.a.warning("La solicitud de ese d\xeda todav\xeda se encuentra pendiente de aprobaci\xf3n"):a.setState({dia:e,modalPedirDia:!0})}else E.a.warning("No puedes solicitar un d\xeda festivo");else E.a.warning("No puedes solicitar un d\xeda pasado")},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=[{title:"Nombre de usuario",key:"user",render:function(e){return e.user&&e.user.username}},{title:"Tipo",dataIndex:"tipo",key:"tipo"},{title:"Fecha",key:"fecha",render:function(e){return je()(e.fecha).format("YYYY-MM-DD")}},{title:"Acci\xf3n",key:"action",render:function(t,a){return n.a.createElement("span",null,n.a.createElement(Ue.a,{title:"\xbfEst\xe1s seguro de que deseas aceptar la solicitud de d\xeda ".concat(a.tipo," para el d\xeda ").concat(je()(a.fecha).format("YYYY-MM-DD")," a ").concat(a.user&&a.user.username,"?"),onConfirm:function(t){return e.responderSolicitud(a,!0)}},n.a.createElement(Me.a,{color:"green",key:"".concat(a._id,"_aceptar")},"Aprobar")),n.a.createElement(Ue.a,{title:"\xbfEst\xe1s seguro de que deseas denegar la solicitud de d\xeda ".concat(a.tipo," para el d\xeda ").concat(je()(a.fecha).format("YYYY-MM-DD")," a ").concat(a.user&&a.user.username,"?"),onConfirm:function(t){return e.responderSolicitud(a,!1)}},n.a.createElement(Me.a,{color:"volcano",key:"".concat(a._id,"_denegar")},"Denegar")))}}];this.setState({columns:t}),this.props.dias&&this.organizarDias()}},{key:"componentDidUpdate",value:function(e,t){t.sel1!==this.state.sel1||t.sel2!==this.state.sel2?this.setState({diasFilter:this.filtrarDias(this.state.dias)}):e.dias!==this.props.dias&&this.organizarDias()}},{key:"render",value:function(){var e=this;return n.a.createElement(y.a,{style:{height:"100vh"}},n.a.createElement(ie,{isLogged:!!A()},n.a.createElement(de.a,{style:{justifyContent:"space-around",display:"flex"}},n.a.createElement(Te.a.Group,{defaultValue:this.state.sel1,buttonStyle:"solid"},n.a.createElement(Te.a.Button,{onClick:function(){return e.setState({sel1:"libres"})},value:"libres"},"Libres"),n.a.createElement(Te.a.Button,{onClick:function(){return e.setState({sel1:"remotos"})},value:"remotos"},"Remotos")),n.a.createElement(Te.a.Group,{defaultValue:this.state.sel2,buttonStyle:"solid"},n.a.createElement(Te.a.Button,{onClick:function(){return e.setState({sel2:"global"})},value:"global"},"Global aprobados"),n.a.createElement(Te.a.Button,{onClick:function(){return e.setState({sel2:"aprobados"})},value:"aprobados"},"Mis d\xedas aprobados"),n.a.createElement(Te.a.Button,{onClick:function(){return e.setState({sel2:"pendientes"})},value:"pendientes"},"Mis d\xedas pendientes de aprobaci\xf3n"))),n.a.createElement(Re.a,{onSelect:function(t){return e.lanzarModalDia(t)},dateFullCellRender:this.dateFullCellRender,style:{margin:"-1px 0"}}),n.a.createElement(X,{blue:this.props.blueCollar},n.a.createElement("h1",null,"D\xedas pendientes de revisi\xf3n"),n.a.createElement(Le.a,{dataSource:this.state.diasPorAprobar,columns:this.state.columns||[]}))),n.a.createElement(qe.a,{visible:this.state.modalPedirDia,onCancel:function(){return e.setState({modalPedirDia:!1})},footer:[n.a.createElement(pe.a,{key:"libre",onClick:function(){return e.solicitarDia(e.state.dia,"libre")}},"D\xeda libre"),n.a.createElement(pe.a,{key:"remoto",type:"primary",onClick:function(){return e.solicitarDia(e.state.dia,"remoto")}},"D\xeda remoto")]},n.a.createElement("p",null,"Solicitar el d\xeda ",je()(this.state.dia).format("DD/MM/YYYY")," como... ")))}}]),t}(r.Component)),Be=Object(U.b)(function(e){return{dias:e.dias,blueCollar:e.blueCollar}})(Ye),Ge=v.a.Title,Fe='{\n    equipos(where: {nombre: "$nombre$"}){\n        _id\n    }\n}',ze=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).solicitarAcceso=function(e){e.preventDefault(),a.props.form.validateFields(function(e,t){fetch("https://we.blacknosaur.com"+_(Fe,{nombre:t.unirse}),{headers:I()}).then(function(e){console.log(e),e.json().then(function(e){console.log(e),e.data.equipos[0]?fetch("https://we.blacknosaur.com/users/"+D()._id,{method:"PUT",headers:I(),body:JSON.stringify({equipo:e.data.equipos[0]._id,confirmed:!1})}).then(function(e){console.log(e),e.ok&&E.a.info('Se ha solicitado con \xe9xito el acceso al equipo "'.concat(t.unirse,'"'))}):E.a.error('No se ha encontrado ning\xfan equipo "'.concat(t.unirse,'"'))}).catch(function(e){return console.log(e)})}).catch(function(e){return console.log(e)})})},a.crearEquipo=function(e){e.preventDefault(),a.props.form.validateFields(function(e,t){fetch("https://we.blacknosaur.com/equipos",{method:"POST",headers:I(),body:JSON.stringify({nombre:t.crear,users:[D()._id]})}).then(function(e){e.json().then(function(e){fetch("https://we.blacknosaur.com/users/"+D()._id,{method:"PUT",headers:I(),body:JSON.stringify({confirmed:!0,manager:!0})}).then(function(){a.props.history.push("/")})}).catch(function(e){console.log(e),E.a.error("Se ha producido un error al asignar el usuario al equipo recien creado")})}).catch(function(e){console.log(e),E.a.error("Se ha producido un error al crear el equipo")})})},a.state={errorUser:!1,errorEmail:!1,errorPw:!1},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this,t=this.props.form,a=t.getFieldDecorator,r=t.getFieldError,o=t.isFieldTouched,s=o("unirse")&&r("unirse"),i=o("crear")&&r("crear");return n.a.createElement(y.a,{style:{height:"100vh"}},n.a.createElement(ie,{isLogged:!!A()},n.a.createElement(y.a.Content,{style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"}},n.a.createElement(le.a,{onSubmit:this.handleSubmit},n.a.createElement(ce.a,{style:{width:450,maxWidth:"90%",marginBottom:"1em"}},n.a.createElement(Ge,{level:2},"Unirse a un equipo"),n.a.createElement(le.a.Item,{validateStatus:s||this.state.errorUnirse?"error":"",help:s||""},a("unirse",{rules:[{required:!0,message:"Introduce el nombre del equipo"}]})(n.a.createElement(ue.a,{onChange:function(t){return e.setState({pw:t.target.value})},prefix:n.a.createElement(w.a,{type:"team",style:{color:"rgba(0,0,0,.25)"}}),type:"text",placeholder:"Nombre del equipo al que te quieres unir"}))),n.a.createElement(le.a.Item,null,n.a.createElement(de.a,null,n.a.createElement(me.a,{style:{justifyContent:"center",display:"flex"}},n.a.createElement(pe.a,{type:"primary",onClick:this.solicitarAcceso},"Solicitar acceso"))))),n.a.createElement(ce.a,{style:{width:450,maxWidth:"90%"}},n.a.createElement(Ge,{level:2},"Crear un equipo"),n.a.createElement(le.a.Item,{validateStatus:i||this.state.errorCrear?"error":"",help:i||""},a("crear",{rules:[{required:!0,message:"Introduce el nombre del equipo"}]})(n.a.createElement(ue.a,{onChange:function(t){return e.setState({pw:t.target.value})},prefix:n.a.createElement(w.a,{type:"usergroup-add",style:{color:"rgba(0,0,0,.25)"}}),type:"password",placeholder:"Nombre del equipo a crear"}))),n.a.createElement(le.a.Item,null,n.a.createElement(de.a,null,n.a.createElement(me.a,{style:{justifyContent:"center",display:"flex"}},n.a.createElement(pe.a,{type:"primary",onClick:this.crearEquipo},"Crear equipo")))))))))}}]),t}(r.Component),He=le.a.create({name:"nuevousuario_form"})(ze),Je=a(517),We=a(94),Ve=a(519),Ke=a(63),Ze='{\nuser(id:"$userId$"){\n    documentos{\n        _id\n    }\n}}',Qe=function(e){function t(){var e,a;Object(i.a)(this,t);for(var r=arguments.length,o=new Array(r),s=0;s<r;s++)o[s]=arguments[s];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).state={fileList:[],asociarA:[],userInfo:D(),selectedUser:{documentos:[]},disponibleParaTodos:!0,columns:[{title:"Nombre de usuario",dataIndex:"username",key:"username"},{title:"Email",dataIndex:"email",key:"email"}],misArchColumns:[{title:"Nombre de archivo",dataIndex:"name",key:"name"},{key:"archivo",render:function(e){return n.a.createElement("div",{key:e._id,style:{display:"flex",justifyContent:"flex-end"}},n.a.createElement("a",{href:"https://we.blacknosaur.com"+e.url,target:"_blank",rel:"noopener noreferrer"},n.a.createElement(Me.a,{color:"geekblue",key:"".concat(e._id,"_file")},n.a.createElement(w.a,{type:"file-text"})," Enlace")),n.a.createElement(Ue.a,{title:"\xbfEst\xe1s seguro de que deseas desvincular ".concat(e.name," de ").concat(a.state.selectedUser.username,"?"),onConfirm:function(){return a.desvincularArchivo(e,a.state.selectedUser)}},n.a.createElement(Me.a,{color:"orange",key:"".concat(e._id,"_file")},n.a.createElement(w.a,{type:"disconnect"})," Desvincular")),n.a.createElement(Ue.a,{title:"\xbfEst\xe1s seguro de que deseas borrar ".concat(e.name,"? Esto borrar\xe1 el archivo para todos los usuarios"),onConfirm:function(){return a.borrarArchivo(e)},icon:n.a.createElement(w.a,{type:"warning",style:{color:"red"}})},n.a.createElement(Me.a,{color:"volcano",key:"".concat(e._id,"_file")},n.a.createElement(w.a,{type:"delete"})," Borrar")))}}],archGlobColumns:[{title:"Nombre de archivo",dataIndex:"name",key:"name"},{key:"archivo",render:function(e){return n.a.createElement("div",{key:e._id,style:{display:"flex",justifyContent:"flex-end"}},n.a.createElement("a",{href:"https://we.blacknosaur.com"+e.url,target:"_blank",rel:"noopener noreferrer"},n.a.createElement(Me.a,{color:"geekblue",key:"".concat(e._id,"_file")},n.a.createElement(w.a,{type:"file-text"})," Enlace")),n.a.createElement(Ue.a,{title:"\xbfEst\xe1s seguro de que deseas borrar ".concat(e.name,"? Esto borrar\xe1 el archivo para todos los usuarios"),onConfirm:function(){return a.borrarArchivo(e)},icon:n.a.createElement(w.a,{type:"warning",style:{color:"red"}})},n.a.createElement(Me.a,{color:"volcano",key:"".concat(e._id,"_file")},n.a.createElement(w.a,{type:"delete"})," Borrar")))}}],archUserColumns:[{title:"Nombre de archivo",dataIndex:"name",key:"name"},{key:"archivo",render:function(e){return n.a.createElement("div",{key:e._id,style:{display:"flex",justifyContent:"flex-end"}},n.a.createElement("a",{href:"https://we.blacknosaur.com"+e.url,target:"_blank",rel:"noopener noreferrer"},n.a.createElement(Me.a,{color:"geekblue",key:"".concat(e._id,"_file")},n.a.createElement(w.a,{type:"file-text"})," Enlace")))}}]},a.rowSelection={onChange:function(e,t){a.setState({asociarA:t.map(function(e){return e._id})})},getCheckboxProps:function(e){return{disabled:"Disabled User"===e.name,name:e.name}}},a.desvincularArchivo=function(){var e=Object(b.a)(g.a.mark(function e(t,r){var n,o,s;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.state.selectedUser.documentos.find(function(e){return e.archivo._id===t._id})._id,e.next=3,H("/documentos/"+n);case 3:o=e.sent,s=o.users.filter(function(e){return e._id!==r._id}),H("/documentos/"+n,{method:"PUT",body:{users:s}}).then(function(e){E.a.info("El archivo se desvincul\xf3 correctamente"),a.props.dispatch(Z())}).catch(function(e){console.log(e),E.a.error("Se produjo un error durante la desvinculaci\xf3n del documento")});case 6:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}(),a.borrarArchivo=function(){var e=Object(b.a)(g.a.mark(function e(t){var r;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=a.props.documentos.find(function(e){return e.archivo._id===t._id})._id,H("/upload/files/"+t._id,{method:"DELETE"}).then(function(e){H("/documentos/"+r,{method:"DELETE"}).then(function(e){E.a.info("El archivo se borr\xf3 correctamente"),a.props.dispatch(Z())}).catch(function(e){console.log(e),E.a.error("Se produjo un error durante el borrado del documento")})}).catch(function(e){console.log(e),E.a.error("Se produjo un error durante el borrado del documento")});case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.handleUpload=Object(b.a)(g.a.mark(function e(){var t,r,n;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=a.state.fileList.map(function(){var e=Object(b.a)(g.a.mark(function e(t){var r,n;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(),e.next=3,H("/documentos",{method:"POST",body:{global:a.state.disponibleParaTodos}});case 3:return r=e.sent,(n=new FormData).append("ref","documento"),n.append("refId",r._id),n.append("field","archivo"),n.append("files",t),H("/upload",{method:"POST",headers:{Authorization:"Bearer "+A()},body:n},!1),e.abrupt("return",r._id);case 11:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),e.next=4,Promise.all(t);case 4:r=e.sent,console.log(r),0!==a.state.asociarA.length||a.state.disponibleParaTodos?a.state.disponibleParaTodos?(E.a.info("Los documentos se han subido correctamente"),a.props.dispatch(Z()),a.setState({mostrarListaUsuarios:!1,fileList:[]})):(n=a.state.asociarA.map(function(){var e=Object(b.a)(g.a.mark(function e(t){var a;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,H(_(Ze,{userId:t}));case 2:return a=e.sent.data.user.documentos,e.abrupt("return",H("/users/"+t,{method:"PUT",body:{documentos:[].concat(Object(De.a)(a),Object(De.a)(r))}}));case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),Promise.all(n).then(function(){E.a.info("Los documentos se han subido correctamente"),a.props.dispatch(Z()),a.setState({mostrarListaUsuarios:!1,fileList:[]})})):E.a.error("El documento no est\xe1 asociado a ning\xfan usuario"),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(0),console.log(e.t0),E.a.error("Ocurri\xf3 un error durante la subida de documentos");case 13:case"end":return e.stop()}},e,null,[[0,9]])})),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.setState({selectedUser:this.props.usuarios.find(function(e){return e.username===D().username})})}},{key:"componentDidUpdate",value:function(e){e.usuarios!==this.props.usuarios&&this.setState({selectedUser:this.props.usuarios.find(function(e){return e.username===D().username})})}},{key:"render",value:function(){var e=this;return n.a.createElement(y.a,{style:{height:"100vh"}},n.a.createElement(ie,{isLogged:!!A()},n.a.createElement("h1",null,"Documentos"),this.state.userInfo.manager&&!this.props.blueCollar&&[n.a.createElement("div",{key:"sa",style:{marginBottom:50}},n.a.createElement("h2",null,"Subir archivo"),n.a.createElement("div",{style:{width:"320px",marginBottom:20}},n.a.createElement(Je.a.Dragger,{name:"file",action:"https://we.blacknosaur.com/upload",multiple:!0,onChange:function(t){var a=t.file.status;"uploading"!==a&&0===t.fileList.length&&e.setState({mostrarListaUsuarios:!1}),"done"===a?E.a.success("".concat(t.file.name," se ha subido correctamente.")):"error"===a&&E.a.error("La subida de ".concat(t.file.name," fall\xf3."))},beforeUpload:function(t,a){return e.setState({fileList:a,mostrarListaUsuarios:!0}),!1},fileList:this.state.fileList,onRemove:function(t){var a=e.state.fileList.filter(function(e){return e.uid!==t.uid});e.setState({fileList:a,mostrarListaUsuarios:a.length>0})}},n.a.createElement(w.a,{type:"inbox"}),n.a.createElement("p",null,"Arrastra documentos aqu\xed"))),this.state.mostrarListaUsuarios&&n.a.createElement("div",{style:{display:"flex",flexDirection:"column"}},n.a.createElement(We.a,{style:{marginBottom:20},checked:this.state.disponibleParaTodos,onChange:function(t){return e.setState({disponibleParaTodos:t.target.checked})}},"Disponible para todos los usuarios"),n.a.createElement(Ve.a,{className:"sinCabecera",bordered:!1,activeKey:this.state.disponibleParaTodos?"0":"1"},n.a.createElement(Ve.a.Panel,{key:"1"},n.a.createElement("h3",{key:"asociarTitle"},"Asociar archivo a:"),n.a.createElement(Le.a,{key:"asociarTabla",rowSelection:this.rowSelection,dataSource:this.props.usuarios,columns:this.state.columns}))),n.a.createElement("div",null,n.a.createElement(pe.a,{onClick:this.handleUpload},"Subir documentos")))),n.a.createElement("div",{key:"apu"},n.a.createElement("h2",null,"Archivos por usuario"),n.a.createElement(Ke.a,{showSearch:!0,style:{width:200,marginBottom:20},placeholder:"Selecciona un usuario",defaultValue:D().username,optionFilterProp:"children",onChange:function(t){var a=e.props.usuarios.find(function(e){return e.username===t});e.setState({selectedUser:a})},filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},this.props.usuarios.map(function(e){return n.a.createElement(Ke.a.Option,{value:e.username,key:e._id},e.username)})),this.state.selectedUser&&n.a.createElement(Le.a,{dataSource:this.props.documentos.filter(function(t){return t.users.map(function(e){return e._id}).includes(e.state.selectedUser._id)}).map(function(e){return e.archivo}),columns:this.state.misArchColumns,rowKey:"_id"}),n.a.createElement("h2",{style:{marginTop:20}},"Archivos globales"),n.a.createElement(Le.a,{dataSource:this.props.documentos.filter(function(e){return e.global}).map(function(e){return e.archivo}),columns:this.state.archGlobColumns,rowKey:"_id"}))],(!this.state.userInfo.manager||this.props.blueCollar)&&n.a.createElement("div",null,n.a.createElement("h2",null,"Mis archivos"),n.a.createElement(Le.a,{dataSource:this.props.documentos.filter(function(t){return e.state.userInfo.documentos.includes(t._id)||t.global}).map(function(e){return e.archivo}),columns:this.state.archUserColumns,rowKey:"_id"}))))}}]),t}(r.Component),$e=Object(U.b)(function(e){return{usuarios:e.usuarios,documentos:e.documentos,blueCollar:e.blueCollar}})(Qe),Xe=function(e){function t(){var e,a;Object(i.a)(this,t);for(var r=arguments.length,o=new Array(r),s=0;s<r;s++)o[s]=arguments[s];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).state={columns:[],extraColumnsA:[],extraColumnsA2:[],extraColumnsB:[]},a.cargaColumnas=function(){var e=D().manager&&!a.props.blueCollar?[{title:"Manager",dataIndex:"manager",render:function(e){return e?n.a.createElement(w.a,Object(Ae.a)({type:"check-circle",theme:"twoTone",twoToneColor:"#eb2f96"},"twoToneColor","#52c41a")):n.a.createElement(w.a,{type:"close-circle",theme:"twoTone",twoToneColor:"#eb2f96"})}},{title:"ID Tarjeta",key:"idcard",render:function(e,t){return t.idcard?n.a.createElement("div",null,n.a.createElement("span",null,t.idcard,"\xa0\xa0"),n.a.createElement(Ue.a,{title:"\xbfEst\xe1s seguro de que deseas desasociar la tarjeta de ".concat(t.email,"?"),onConfirm:function(e){return a.desasociarTarjeta(t)}},n.a.createElement(Me.a,{color:"volcano",key:"".concat(t._id,"_denegar")},n.a.createElement(w.a,{type:"delete"})))):n.a.createElement(pe.a,{type:"primary",onClick:function(){return a.setState({modalAsociar:!0,usuarioAsociar:t._id})}},"Asociar tarjeta")}}]:[],t=[{key:"btn",render:function(e,t){return n.a.createElement(O.a,{to:"/usuario/"+t._id},n.a.createElement(Me.a,{key:"".concat(t._id,"_denegar")},n.a.createElement(w.a,{type:"user"})," Editar"))}}],r=[{title:"Acci\xf3n",key:"action",render:function(e,t){return n.a.createElement("span",null,n.a.createElement(Ue.a,{title:"\xbfEst\xe1s seguro de que deseas aceptar en ".concat(t.equipo&&t.equipo.nombre," a ").concat(t.email,"?"),onConfirm:function(e){return a.responderSolicitud(t,!0)}},n.a.createElement(Me.a,{color:"green",key:"".concat(t._id,"_aceptar")},"Aceptar")),n.a.createElement(Ue.a,{title:"\xbfEst\xe1s seguro de que deseas denegar la solicitud de ".concat(t.email," para entrar en ").concat(t.equipo&&t.equipo.nombre,"?"),onConfirm:function(e){return a.responderSolicitud(t,!1)}},n.a.createElement(Me.a,{color:"volcano",key:"".concat(t._id,"_denegar")},"Denegar")))}}];a.setState({columns:[{title:"Nombre de usuario",dataIndex:"username",key:"username"},{title:"Email",dataIndex:"email",key:"email"}],extraColumnsA:e,extraColumnsA2:t,extraColumnsB:r})},a.filtraUsuarios=function(e){var t=a.props.usuarios.filter(function(e){return e.confirmed}).map(function(e){return Object(Pe.a)({},e,{key:e._id})}),r=a.props.usuarios.filter(function(e){return!e.confirmed}).map(function(e){return Object(Pe.a)({},e,{key:e._id})});a.setState({activos:t,pendientes:r})},a.fetchUsers=Object(b.a)(g.a.mark(function e(){return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.props.dispatch(J());case 2:a.filtraUsuarios(a.props.usuarios);case 3:case"end":return e.stop()}},e)})),a.responderSolicitud=function(e,t){t?H("/users/"+e._id,{method:"PUT",body:{confirmed:!0}}).then(function(t){E.a.success("\xa1".concat(e.email," ahora forma parte del equipo ").concat(e.equipo.nombre,"!")),a.fetchUsers()}).catch(function(e){console.error(e),E.a.error("Se ha producido un error durante la confirmaci\xf3n de la solicitud del usuario")}):H("/users/"+e._id,{method:"DELETE"}).then(function(e){E.a.info("La solicitud se ha denegado correctamente"),a.fetchUsers()}).catch(function(e){E.a.error("Se ha producido un error durante la denegaci\xf3n de la solicitud del usuario"),console.error(e)})},a.desasociarTarjeta=function(e){console.log(e),H("/users/"+e._id,{method:"PUT",body:{idcard:""}}).then(function(){return a.fetchUsers()})},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.cargaColumnas(),this.props.usuarios&&this.filtraUsuarios(this.props.usuarios)}},{key:"componentDidUpdate",value:function(e,t){var a=this;e.usuarios!==this.props.usuarios?this.filtraUsuarios(this.props.usuarios):t.modalAsociar!==this.state.modalAsociar?this.state.modalAsociar?this.props.socket.on("notification",function(e){console.log(e),a.props.usuarios.map(function(e){return e.idcard}).includes(e.es)?E.a.error("Esa tarjeta ya est\xe1 asociada a un usuario. Desasociela antes de reasignarla."):H("/users/"+a.state.usuarioAsociar,{method:"PUT",body:{idcard:e.es&&e.es.idcard}}).then(function(e){E.a.info("La tarjeta ha sido asociada correctamente"),a.fetchUsers(),a.setState({modalAsociar:!1,usuarioAsociar:void 0})}).catch(function(e){E.a.error("Se produjo un error durante el proceso de asociaci\xf3n de la tarjeta"),console.log(e),a.setState({modalAsociar:!1,usuarioAsociar:void 0})})}):this.props.socket.off("notification"):e.blueCollar!==this.props.blueCollar&&this.cargaColumnas()}},{key:"render",value:function(){var e=this,t=this.state,a=t.activos,r=t.pendientes,o=t.columns,s=t.extraColumnsA,i=t.extraColumnsA2,c=t.extraColumnsB;return n.a.createElement(y.a,{style:{height:"100vh"}},n.a.createElement(ie,{isLogged:!!A()},n.a.createElement("h1",null,"Usuarios activos"),n.a.createElement(Le.a,{dataSource:a,columns:[].concat(Object(De.a)(o),Object(De.a)(s),Object(De.a)(i))}),D().manager&&!this.props.blueCollar&&[n.a.createElement("h1",{key:"pendAprobTitle"},"Usuarios pendientes de aprobaci\xf3n"),n.a.createElement(Le.a,{key:"pendAprobTable",dataSource:r,columns:[].concat(Object(De.a)(o),Object(De.a)(c))})]),n.a.createElement(qe.a,{visible:this.state.modalAsociar,onOk:function(e){return e},onCancel:function(){return e.setState({modalAsociar:!1,usuarioAsociar:void 0})},footer:[n.a.createElement(pe.a,{key:"back",type:"primary",onClick:function(){return e.setState({modalAsociar:!1,usuarioAsociar:void 0})}},"Cancelar")]},n.a.createElement("p",null,"Acerca la tarjeta al lector sin cerrar esta ventana para asociarla al usuario")))}}]),t}(r.Component),et=Object(N.socketConnect)(Object(U.b)(function(e){return{usuarios:e.usuarios,blueCollar:e.blueCollar}})(Xe)),tt=function(e){function t(){var e,a;Object(i.a)(this,t);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={usuario:{},duracionjornada:"",frasesStr:"",frases:[],frasePr:"",frasePrAct:!1,manager:void 0},a.guardarDatos=function(){a.state.duracionjornada>0&&a.state.duracionjornada<24?H("/users/"+a.state.usuario._id,{method:"PUT",body:{frases:a.state.frases.filter(function(e){return![void 0,null,""].includes(e)}),frasePrioritaria:a.state.frasePr,actFrasePrioritaria:a.state.frasePrAct,manager:a.state.manager,duracionjornada:a.state.duracionjornada}}).then(function(e){E.a.success("Los cambios se guardaron correctamente"),a.props.dispatch(K()),a.props.dispatch(J())}).catch(function(e){console.log(e),E.a.error("Se produjo un error durante el guardado")}):E.a.error("La duraci\xf3n media de la jornada ha de estar entre 0 y 24")},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this;if(this.props.usuarios.length>0){var t=this.props.usuarios.find(function(t){return t._id===e.props.match.params.id});console.log(t),this.setState({duracionjornada:t.duracionjornada,frasesStr:t.frases.reduce(function(e,t){return e+t+"\n"},""),frases:t.frases,frasePr:t.frasePrioritaria,frasePrAct:t.actFrasePrioritaria,manager:t.manager,usuario:t})}}},{key:"componentDidUpdate",value:function(e,t){var a=this;if(this.props.usuarios&&this.props.usuarios!==e.usuarios){var r=this.props.usuarios.find(function(e){return e._id===a.props.match.params.id});console.log(r),this.setState({duracionjornada:r.duracionjornada,frasesStr:r.frases.reduce(function(e,t){return e+t+"\n"},""),frases:r.frases,frasePr:r.frasePrioritaria,frasePrAct:r.actFrasePrioritaria,manager:r.manager,usuario:r})}else this.state.frasesStr!==t.frasesStr&&this.setState({frases:this.state.frasesStr.split(/\n/gm)})}},{key:"render",value:function(){var e=this,t=this.state.usuario;return n.a.createElement(y.a,{style:{height:"100vh"}},n.a.createElement(ie,{isLogged:!!A()},n.a.createElement("h1",null,t.username),n.a.createElement(X,{blue:this.props.blueCollar},n.a.createElement(le.a.Item,{key:"editUserJornada",label:"Duraci\xf3n media de su jornada laboral"},n.a.createElement(ue.a,{type:"number",value:this.state.duracionjornada,onChange:function(t){return e.setState({duracionjornada:t.target.value})}})),n.a.createElement(le.a.Item,{key:"editUserManager",label:"Manager"},n.a.createElement(Te.a.Group,{value:this.state.manager},n.a.createElement(Te.a.Button,{value:!0,onClick:function(){return e.setState({manager:!0})}},"S\xed"),n.a.createElement(Te.a.Button,{value:!1,onClick:function(){return e.setState({manager:!1})}},"No")))),n.a.createElement(le.a.Item,{label:"Frases (una por l\xednea)"},n.a.createElement(ue.a.TextArea,{rows:6,value:this.state.frasesStr,onChange:function(t){return e.setState({frasesStr:t.target.value})}})),n.a.createElement(le.a.Item,{label:"Frase prioritaria"},n.a.createElement(ue.a,{type:"text",value:this.state.frasePr,onChange:function(t){return e.setState({frasePr:t.target.value})}}),n.a.createElement(Te.a.Group,{value:this.state.frasePrAct},n.a.createElement(Te.a.Button,{value:!0,onClick:function(){return e.setState({frasePrAct:!0})}},"Activada"),n.a.createElement(Te.a.Button,{value:!1,onClick:function(){return e.setState({frasePrAct:!1})}},"Desactivada"))),n.a.createElement(pe.a,{onClick:this.guardarDatos},"Guardar")))}}]),t}(r.Component),at=Object(U.b)(function(e){return{usuarios:e.usuarios,blueCollar:e.blueCollar}})(tt),rt=function(e){function t(){return Object(i.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return n.a.createElement(y.a,{style:{height:"100vh"}},n.a.createElement(ie,{isLogged:!!A()},n.a.createElement("h1",null,"Analitica")))}}]),t}(r.Component),nt=a(515),ot=a(266),st=a(522),it=a(267),ct=function(e){function t(){var e,a;Object(i.a)(this,t);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).addRegistro=Object(b.a)(g.a.mark(function e(){var t,r,n,o,s,i,c,l;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.props.usuario||a.state.selectedUser._id||void 0,[a.state.fechaNuevoRegistro,a.state.horaEntradaNuevoRegistro,a.state.horaSalidaNuevoRegistro,t].includes(void 0)){e.next=33;break}if(r=a.state.fechaNuevoRegistro.clone().hour(a.state.horaEntradaNuevoRegistro.hour()).minute(a.state.horaEntradaNuevoRegistro.minute()),n=a.state.fechaNuevoRegistro.clone().hour(a.state.horaSalidaNuevoRegistro.hour()).minute(a.state.horaSalidaNuevoRegistro.minute()),o=r.isBefore(je()()),s=n.isBefore(je()()),i=r.isBefore(n),!(o&&s&&i)){e.next=28;break}return c={user:t,fecha:je.a.utc(r).format(),ultimoEditor:D()._id,aprobado:!!D().manager},l={user:t,fecha:je.a.utc(n).format(),ultimoEditor:D()._id,aprobado:!!D().manager},e.prev=10,e.next=13,H("/registros",{method:"POST",body:c});case 13:return e.sent,e.next=16,H("/registros",{method:"POST",body:l});case 16:e.sent,!0===D().manager?E.a.success("El registro se a\xf1adi\xf3 correctamente"):E.a.success("El registro se a\xf1adi\xf3 correctamente, actualmente est\xe1 pendiente de aprobaci\xf3n"),a.props.cerrarModal&&a.props.cerrarModal(),a.setState({fechaNuevoRegistro:void 0,horaEntradaNuevoRegistro:void 0,horaSalidaNuevoRegistro:void 0}),e.next=26;break;case 22:e.prev=22,e.t0=e.catch(10),console.log(e.t0),E.a.error("Se produjo un error durante el guardado del registro");case 26:e.next=31;break;case 28:o||E.a.error("La hora de entrada es inv\xe1lida"),s||E.a.error("La hora de salida es inv\xe1lida"),i||E.a.error("La hora de entrada ha de ser anterior a la de salida");case 31:e.next=34;break;case 33:E.a.warning("Faltan campos por completar");case 34:case"end":return e.stop()}},e,null,[[10,22]])})),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this,t=Ke.a.Option;return n.a.createElement("div",null,n.a.createElement("div",{style:{display:"flex",justifyContent:"space-between",flexWrap:"wrap"}},!this.props.usuario&&n.a.createElement(le.a.Item,{label:"Usuario"},n.a.createElement(Ke.a,Object(Ae.a)({showSearch:!0,style:{width:200,marginBottom:20},placeholder:"Selecciona un usuario",optionFilterProp:"children",onChange:function(t){var a=e.props.usuarios.find(function(e){return e.username===t});e.setState({selectedUser:a})},filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},"style",{width:250}),this.props.usuarios.map(function(e){return n.a.createElement(t,{value:e.username,key:e._id},e.username)}))),n.a.createElement(le.a.Item,{label:"Fecha"},n.a.createElement(nt.a,{onChange:function(t){return e.setState({fechaNuevoRegistro:t})},style:{width:250}})),n.a.createElement(le.a.Item,{label:"Hora de entrada"},n.a.createElement(it.a,{onChange:function(t){return e.setState({horaEntradaNuevoRegistro:t})},style:{width:250}})),n.a.createElement(le.a.Item,{label:"Hora de salida"},n.a.createElement(it.a,{onChange:function(t){return e.setState({horaSalidaNuevoRegistro:t})},style:{width:250}}))),n.a.createElement(pe.a,{onClick:this.addRegistro},"A\xf1adir registro"))}}]),t}(r.Component),lt=Object(U.b)(function(e){return{usuarios:e.usuarios}})(ct),ut=function(e){function t(){var e,a;Object(i.a)(this,t);for(var r=arguments.length,o=new Array(r),s=0;s<r;s++)o[s]=arguments[s];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).state={datos:{},datosMod:{},modificado:!1,nuevosRegistros:[],hora:je()(),columns:[],extraColumns:[]},a.cargaColumnas=function(){var e=[{key:"a",title:"Hora",render:function(e){return je()(e.fecha).format("HH:mm")}},{key:"b",title:"Evento",render:function(e,t,r){return 0===r?"Entrada":r%2?r===a.state.datosMod.registros.length-1?"Salida":"Comienzo de descanso":"Final de descanso"}}],t=a.props.colAprobado?[{key:"c",title:"Aprobado",render:function(e){return e.aprobado?n.a.createElement(w.a,Object(Ae.a)({type:"check-circle",theme:"twoTone",twoToneColor:"#eb2f96"},"twoToneColor","#52c41a")):D().manager&&!a.props.blueCollar?n.a.createElement("span",null,n.a.createElement(Ue.a,{title:"\xbfEst\xe1s seguro de que deseas aprobar la jornada?",onConfirm:function(){return a.jornadaPendiente(!0,e)}},n.a.createElement(Me.a,{color:"green",key:"".concat(e._id,"_aceptar")},"Aceptar")),n.a.createElement(Ue.a,{title:"\xbfEst\xe1s seguro de que deseas denegar jornada?",onConfirm:function(){return a.jornadaPendiente(!1,e)}},n.a.createElement(Me.a,{color:"volcano",key:"".concat(e._id,"_denegar")},"Denegar"))):n.a.createElement(w.a,{type:"close-circle",theme:"twoTone",twoToneColor:"#eb2f96"})}}]:[];a.setState({columns:e,extraColumns:t})},a.addRegistro=function(){var e=a.state.hora.date(je()(a.state.datos.entrada).date()).month(je()(a.state.datos.entrada).month()).year(je()(a.state.datos.entrada).year());if(e.isSameOrBefore(je()())){var t=[].concat(Object(De.a)(a.state.datosMod.registros),[{fecha:e.utc().format()}]).sort(function(e,t){return je()(e.fecha).isBefore(je()(t.fecha))?-1:je()(e.fecha).isAfter(je()(t.fecha))?1:0});a.setState({modificado:!0,datosMod:Object(Pe.a)({},a.state.datosMod,{registros:t}),nuevosRegistros:[].concat(Object(De.a)(a.state.nuevosRegistros),[{fecha:a.state.hora.utc().format(),user:a.state.datos.registros[0].user._id,ultimoEditor:D()._id,aprobado:!!D().manager}])})}else E.a.warning("No se pueden a\xf1adir registros por adelantado")},a.guardarNuevosRegistros=function(){var e=a.state.nuevosRegistros.length,t=a.state.nuevosRegistros;qe.a.confirm({title:"Por razones legales no es posible editar ni borrar registros. \xbfEst\xe1s seguro de que quieres a\xf1adir ".concat(e>1?e:"un"," nuevo").concat(e>1?"s":""," registro").concat(e>1?"s":"","?"),onOk:function(){var e=Object(b.a)(g.a.mark(function e(){var r,n;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.map(function(e){return fetch("https://we.blacknosaur.com/registros",{method:"POST",headers:{Authorization:"Bearer "+A(),Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e)}).catch(function(e){return e})}),e.next=3,Promise.all(r);case 3:e.t0=function(e){return e.status},(n=e.sent.map(e.t0)).some(function(e){return e>=400})?(E.a.error("Se ha producido un error durante el guardado de los registros"),console.log(n)):(E.a.success("Los nuevos registros se a\xf1adieron correctamente"),a.setState({modificado:!1,nuevosRegistros:[]}),qe.a.destroyAll());case 6:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()})},a.jornadaPendiente=function(e,t){!0===e?H("/registros/"+t._id,{method:"PUT",body:{aprobado:!0}}).then(function(e){E.a.success("Se ha aprobado el registro correctamente"),a.props.dispatch(K()),a.setState({datosMod:Object(Pe.a)({},a.state.datosMod,{registros:a.state.datosMod.registros.map(function(e){return e._id===t._id?Object(Pe.a)({},e,{aprobado:!0}):e})})})}).catch(function(e){console.log(e),E.a.error("Ha ocurrido un error durante la aprobaci\xf3n del registro")}):H("/registros/"+t._id,{method:"DELETE"}).then(function(e){E.a.success("Se ha denegado el registro correctamente"),a.props.dispatch(K()),a.setState({datosMod:Object(Pe.a)({},a.state.datosMod,{registros:a.state.datosMod.registros.filter(function(e){return e._id!==t._id})})})}).catch(function(e){console.log(e),E.a.error("Ha ocurrido un error durante la denegaci\xf3n del registro")})},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.cargaColumnas()}},{key:"componentDidUpdate",value:function(e){e.datos!==this.props.datos&&this.props.datos&&(this.setState({datos:this.props.datos,datosMod:this.props.datos}),this.cargaColumnas())}},{key:"render",value:function(){var e=this,t=this.state,a=t.datos,r=t.datosMod;return n.a.createElement(qe.a,{visible:this.props.visible,footer:null,onCancel:function(){e.state.modificado?qe.a.confirm({title:"Los registros no han sido guardados. \xbfSeguro que desea salir?",onOk:function(){e.setState({datosMod:e.state.datos,modificado:!1,nuevosRegistros:[]}),e.props.cb()}}):e.props.cb()},width:"80vw"},n.a.createElement("h2",null,a.usuario+" - "+je()(a.entrada).format("YYYY-MM-DD")),n.a.createElement("div",null,n.a.createElement(Le.a,{dataSource:r.registros,rowKey:"_id",pagination:!1,style:{marginBottom:20},columns:[].concat(Object(De.a)(this.state.columns),Object(De.a)(this.state.extraColumns))})),n.a.createElement("div",{style:{marginBottom:20}},n.a.createElement(it.a,{placeholder:"Selecciona hora",value:this.state.hora.utcOffset(2),onChange:function(t){return e.setState({hora:t})},style:{marginRight:20}}),n.a.createElement(pe.a,{onClick:this.addRegistro},"A\xf1adir registro")),this.state.modificado&&n.a.createElement("div",null,n.a.createElement(pe.a,{type:"danger",style:{marginRight:20},onClick:function(){return e.setState({datosMod:e.state.datos,modificado:!1,nuevosRegistros:[]})}},"Restablecer"),n.a.createElement(pe.a,{type:"primary",onClick:function(){return e.guardarNuevosRegistros()}},"Guardar")))}}]),t}(r.Component),dt=Object(U.b)()(ut),mt=function(e){function t(){var e,a;Object(i.a)(this,t);for(var r=arguments.length,o=new Array(r),s=0;s<r;s++)o[s]=arguments[s];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).state={usuarios:[],userInfo:D(),mes:je()(),modalVisible:!1,modalLoading:!1},a.columns=[{title:"Entrada",dataIndex:"entrada",key:"entrada",defaultSortOrder:"descend",sorter:function(e,t){return je()(e.entrada).diff(je()(t.entrada))},render:function(e){return je()(e).format("YYYY-MM-DD, HH:mm")}},{title:"Salida",dataIndex:"salida",key:"salida",sorter:function(e,t){return je()(e.entrada).diff(je()(t.entrada))},render:function(e){return"-"!==e?je()(e).format("YYYY-MM-DD, HH:mm"):"-"}},{title:"Tiempo trabajado",dataIndex:"horas",key:"horas",sorter:function(e,t){return e.horas-t.horas},render:function(e){return"-"!==e?Math.trunc(e,10)+"h "+Math.round(e%1*60)+"m":"-"}},{title:"Tiempo de descanso",dataIndex:"tiempoDescanso",key:"tiempoDescanso",sorter:function(e,t){return e.tiempoDescanso-t.tiempoDescanso},render:function(e){return"-"!==e?Math.trunc(e,10)+"h "+Math.round(e%1*60)+"m":"-"}},{title:"",dataIndex:"detalles",key:"detalles",render:function(){return n.a.createElement(Me.a,{color:"blue"},"Detalles")}}],a.diasLaborables=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:je()().month()+1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:je()().year(),n=a.props.dias.filter(function(e){return"festivo"===e.tipo&&je()(e.fecha).month()===t}).length;return Array(je()().month(t).year(r).daysInMonth()).fill(null).filter(function(e,a){return je()().year(r).month(t).date(a+1).weekday()<=4}).length-a.props.dias.filter(function(a){return a.user&&a.user._id===e&&!0===a.aprobado&&je()(a.fecha).month()===t}).length-n},a.procesaES=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:je()().month()+1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:je()().year(),r=je()().month(e-1).year(t).daysInMonth(),n=a.props.es.map(function(n){var o=n.duracionjornada||8,s=a.diasLaborables(n._id,e,t),i=Array(r).fill(null).map(function(e,t){return je()().subtract(t,"days").format("YYYY-MM-DD")}).map(function(e){return n.registros.filter(function(t){return je()(t.fecha).isSame(je()(e),"days")&&je()(t.fecha).isSame(a.state.mes,"month")}).sort(function(e,t){return je()(e.fecha).isBefore(je()(t.fecha))?-1:je()(t.fecha).isBefore(je()(e.fecha))?1:0})}).map(function(e,t){var a=Array(Math.ceil(e.length/2)).fill(null).map(function(a,r){var o=je()(e[2*r].fecha),s=e[2*r+1]?je()(e[2*r+1].fecha):void 0,i=s?je.a.duration(s.diff(o)):o.isSame(je()(),"day")?je.a.duration(je()().diff(o)):"-",c="-"!==i?Math.round(100*i.as("hours"))/100:"-";return{key:n._id+"-"+t+"-"+r,entrada:o.format(),aprobado:!(!e[2*r].aprobado||e[2*r+1]&&!e[2*r+1].aprobado),salida:s?s.format():"-",horas:c}}),r=Array(a.length>0?a.length-1:0).fill(null).map(function(e,t){var r=je()(a[t].salida),n=je()(a[t+1].entrada);return Math.round(100*je.a.duration(n.diff(r)).as("hours"))/100}).reduce(function(e,t){return e+t},0),o=a.map(function(e){return e.horas});return a[0]?{key:a[0].key,entrada:a[0].entrada,salida:a.slice(-1)[0].salida,aprobado:!a.map(function(e){return e.aprobado}).includes(!1),horas:o.includes("-")?"-":o.reduce(function(e,t){return e+t},0),usuario:n.username,registros:e,tiempoDescanso:r}:[]}),c=Math.round(100*i.filter(function(e){return e.aprobado}).map(function(e){return e.horas}).filter(function(e){return"-"!==e&&void 0!==e}).reduce(function(e,t){return e+t},0))/100,l=s*o,u=Math.round(c/(s*o)*1e4)/100,d=Math.round(100*(l-c))/100;return Object(Pe.a)({},n,{jornadas:i,horasTrabajadas:c,horasPendientes:d,porcentajeHoras:u,duracionJornada:o,diasLaborables:s})});a.setState({usuarios:n,jornadasPorAprobar:[].concat.apply([],n.filter(function(e){return e._id===D()._id||D().manager&&!a.props.blueCollar}).map(function(e){return e.jornadas})).filter(function(e){return!Array.isArray(e)&&!e.aprobado})})},a.handleRowClick=function(e,t){a.setState({rowSelect:e,modalInfo:!0,modalInfoApr:t})},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.props.es&&this.procesaES(this.state.mes.month(),this.state.mes.year())}},{key:"componentDidUpdate",value:function(e,t){e.es===this.props.es&&t.mes.isSame(this.state.mes,"month")||this.procesaES(this.state.mes.month(),this.state.mes.year())}},{key:"render",value:function(){var e=this,t=this.state,a=t.modalVisible,r=(t.modalLoading,nt.a.MonthPicker);return n.a.createElement(y.a,{style:{height:"100vh"}},n.a.createElement(ie,{isLogged:!!A()},n.a.createElement("h1",null,"Jornadas"),n.a.createElement(r,{placeholder:"Seleccionar mes",value:this.state.mes,onChange:function(t){return e.setState({mes:t})},style:{marginBottom:20}}),n.a.createElement("div",null,n.a.createElement("h3",null,"Jornadas pendientes de aprobaci\xf3n"),n.a.createElement(Le.a,{style:{marginBottom:"1em"},dataSource:this.state.jornadasPorAprobar,locale:{emptyText:"No hay jornadas pendientes de aprobar"},onRow:function(t){return{onClick:function(){return e.handleRowClick(t,!0)}}},columns:[{title:"Usuario",dataIndex:"usuario",key:"usuario"},{title:"D\xeda",dataIndex:"entrada",key:"dia",render:function(e){return je()(e).format("YYYY-MM-DD")}},{title:"Entrada",dataIndex:"entrada",key:"entrada",render:function(e){return je()(e).format("HH:mm")}},{title:"Salida",dataIndex:"salida",key:"salida",render:function(e){return"Invalid date"===je()(e).format("HH:mm")?" - ":je()(e).format("HH:mm")}},{title:"Horas",dataIndex:"horas",key:"horas"},{title:"",dataIndex:"detalles",key:"detalles",render:function(){return n.a.createElement(Me.a,{color:"blue"},"Detalles")}}]})),n.a.createElement(Ve.a,{defaultActiveKey:!D().manager||this.props.blueCollar?D()._id:void 0},this.state.usuarios&&this.state.usuarios.filter(function(t){return e.state.userInfo._id===t._id||e.state.userInfo.manager&&!e.props.blueCollar}).map(function(t,a){return[n.a.createElement(Ve.a.Panel,{header:n.a.createElement("div",{style:{display:"flex",justifyContent:"space-between",paddingRight:"10px"}},n.a.createElement("span",null,t.username),n.a.createElement("div",{style:{width:"200px"}},n.a.createElement(ot.a,{percent:t.porcentajeHoras}))),key:t._id},n.a.createElement("div",{style:{display:"flex",flexWrap:"wrap",justifyContent:"space-evenly"}},n.a.createElement(st.a,{title:"Horas trabajadas",value:Math.trunc(t.horasTrabajadas,10)+"h "+Math.round(t.horasTrabajadas%1*60)+"m"}),n.a.createElement(st.a,{title:"Horas pendientes",value:Math.trunc(t.horasPendientes,10)+"h "+Math.round(t.horasPendientes%1*60)+"m"}),n.a.createElement(st.a,{title:"D\xedas laborables de este mes",value:t.diasLaborables}),n.a.createElement(st.a,{title:"Duraci\xf3n de jornada",value:t.duracionJornada+"h"})),n.a.createElement("h3",{style:{marginTop:20}},"Desglose de jornadas"),n.a.createElement(Le.a,{key:"table"+a,dataSource:[].concat.apply([],t.jornadas.filter(function(e){return e.aprobado})),columns:e.columns,onRow:function(t){return{onClick:function(){return e.handleRowClick(t,!1)}}}}),(e.state.userInfo._id===t._id||e.state.userInfo.manager&&!e.props.blueCollar)&&n.a.createElement("div",{style:{display:"flex",justifyContent:"center",marginTop:20}},n.a.createElement(pe.a,{onClick:function(){return e.setState({modalVisible:!0,modalUser:t._id})}},"A\xf1adir jornada")))]}))),n.a.createElement(qe.a,{visible:a,title:"A\xf1adir registro",onOk:this.handleNuevoRegistro,onCancel:function(){e.setState({modalVisible:!1})},style:{maxWidth:900},width:"90%",footer:null},n.a.createElement(lt,{usuario:this.state.modalUser,cerrarModal:function(){return e.setState({modalVisible:!1})}})),n.a.createElement(dt,{visible:this.state.modalInfo,colAprobado:this.state.modalInfoApr,cb:function(){return e.setState({modalInfo:!1})},datos:this.state.rowSelect,blueCollar:this.props.blueCollar}))}}]),t}(r.Component),pt=Object(N.socketConnect)(Object(U.b)(function(e){return{es:e.es,dias:e.dias,blueCollar:e.blueCollar}})(mt)),ft=function(e){function t(){var e,a;Object(i.a)(this,t);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={loading:!1,nombre:D().nombre||""},a.handleUpload=function(e){e.onSuccess,e.onError;var t=e.file,r=new FormData,n="image/jpeg"===t.type||"image/png"===t.type;n||E.a.error("Solo se aceptan imagenes en formato JPG y PNG");var o=t.size/1024/1024<2;o||E.a.error("Las imagenes han de ser m\xe1s peque\xf1as de 2MB"),n&&o&&(r.append("files",t),r.append("field","avatar"),r.append("refId",D()._id),r.append("ref","user"),r.append("source","users-permissions"),a.setState({loading:!0}),H("/upload",{method:"POST",body:r},!1).then(function(e){console.log(e),a.setState({loading:!1}),E.a.success("El avatar se actualiz\xf3 correctamente.");var t=D();t.avatar=e[0],window.localStorage.setItem("user",JSON.stringify(t))}).catch(function(e){a.setState({loading:!1}),console.log(e),E.a.error("Ocurri\xf3 un error durante la subida del nuevo avatar")}))},a.handleSave=function(){H("/users/"+D()._id,{method:"PUT",body:{nombre:a.state.nombre}}).then(function(e){var t=D();t.nombre=a.state.nombre,window.localStorage.setItem("user",JSON.stringify(t)),E.a.success("Los datos se guardaron correctamente")}).catch(function(e){E.a.error("Ocurri\xf3 un error durante el guardado de datos"),console.log(e)})},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this,t=n.a.createElement("div",null,n.a.createElement(w.a,{type:this.state.loading?"loading":"plus"}),n.a.createElement("div",{className:"ant-upload-text"},"Upload")),a=this.state.imageUrl;return n.a.createElement(y.a,{style:{height:"100vh"}},n.a.createElement(ie,{isLogged:!!A()},n.a.createElement("h1",null,"Perfil"),n.a.createElement("div",{style:{width:"320px",marginBottom:20}},n.a.createElement(Je.a,{name:"avatar",listType:"picture-card",className:"avatar-uploader",showUploadList:!1,onChange:this.handleChange,customRequest:this.handleUpload},a?n.a.createElement("img",{src:a,alt:"avatar"}):t),n.a.createElement(le.a.Item,{label:"Nombre",style:{marginRight:20}},n.a.createElement(ue.a,{type:"text",value:this.state.nombre,onChange:function(t){return e.setState({nombre:t.target.value})}})),n.a.createElement(pe.a,{onClick:this.handleSave},"Guardar"))))}}]),t}(r.Component),ht={users:[]},gt=function(e){function t(){var e,a;Object(i.a)(this,t);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={seleccionados:[],nombreNuevoGrupo:"",grupoEditar:ht},a.addSeleccionado=function(e,t){if(t){var r=a.props.usuarios.find(function(t){return t.username===e});a.setState({grupoEditar:Object(Pe.a)({},a.state.grupoEditar,{users:[].concat(Object(De.a)(a.state.grupoEditar.users),[r])})})}else a.setState({seleccionados:Object(De.a)(new Set([].concat(Object(De.a)(a.state.seleccionados),[e])))})},a.removeSeleccionado=function(e,t){t?a.setState({grupoEditar:Object(Pe.a)({},a.state.grupoEditar,{users:a.state.grupoEditar.users.filter(function(t){return t._id!==e._id})})}):a.setState({seleccionados:a.state.seleccionados.filter(function(t){return e!==t})})},a.crearGrupo=function(){if(""===a.state.nombreNuevoGrupo)E.a.warning("Es necesario introducir un nombre para el grupo");else if(0===a.state.seleccionados.length)E.a.warning("No se han a\xf1adido usuarios al grupo");else{var e=a.state.seleccionados.map(function(e){return a.props.usuarios.find(function(t){return t.username===e})}).map(function(e){return e._id}),t=D().equipo;H("/grupos",{method:"POST",body:{nombre:a.state.nombreNuevoGrupo,users:e,equipo:t}}).then(function(e){console.log(e),E.a.success("El grupo se cre\xf3 correctamente"),a.props.dispatch(Q())}).catch(function(e){console.log(e),E.a.error("Se produjo un error durante la creaci\xf3n del grupo")})}},a.borrarGrupo=function(e){H("/grupos/"+e._id,{method:"DELETE"}).then(function(e){a.props.dispatch(Q()),E.a.success("El grupo se borr\xf3 correctamente")}).catch(function(e){console.log(e),E.a.error("Se produjo un error durante el borrado del grupo")})},a.editarGrupo=function(){var e=a.state.grupoEditar,t=e.nombre,r=e.users;H("/grupos/"+e._id,{method:"PUT",body:{nombre:t,users:r}}).then(function(e){a.props.dispatch(Q()),E.a.success("El grupo se edit\xf3 correctamente"),a.setState({modalEdicion:!1,grupoEditar:ht})}).catch(function(e){console.log(e),E.a.error("Se produjo un error durante la edici\xf3n del grupo")})},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this,t=Ve.a.Panel;return n.a.createElement(y.a,{style:{height:"100vh"}},n.a.createElement(ie,{isLogged:!!A()},n.a.createElement("h2",null,"Grupos"),n.a.createElement(Le.a,{style:{paddingBottom:30},rowKey:"_id",dataSource:this.props.grupos,columns:[{title:"Grupo",dataIndex:"nombre",key:"nombre"},{title:"Usuarios",dataIndex:"users",render:function(e){return e.map(function(e){return n.a.createElement(Me.a,{key:"u"+e._id},e.username)})}},{render:function(t){return n.a.createElement("div",{style:{display:"flex",margin:5}},n.a.createElement(Me.a,{color:"blue",onClick:function(){return e.setState({modalEdicion:!0,grupoEditar:t})}},n.a.createElement(w.a,{type:"edit"})),n.a.createElement(Ue.a,{title:"\xbfSeguro que deseas borrar el equipo ".concat(t.nombre,"?"),onConfirm:function(){return e.borrarGrupo(t)},okText:"Aceptar",cancelText:"Cancelar"},n.a.createElement(Me.a,{color:"volcano"},n.a.createElement(w.a,{type:"delete"}))))}}]}),n.a.createElement(Ve.a,null,n.a.createElement(t,{key:"nuevoGrupo",header:"Nuevo grupo de usuarios"},n.a.createElement(le.a.Item,{label:"Nombre del grupo"},n.a.createElement(ue.a,{type:"text",value:this.state.nombreNuevoGrupo,onChange:function(t){return e.setState({nombreNuevoGrupo:t.target.value})}})),n.a.createElement(le.a.Item,{label:"Integrantes"},n.a.createElement(Ke.a,{style:{width:"100%"},onChange:function(t){return e.addSeleccionado(t,!1)}},this.props.usuarios.map(function(e,t){return n.a.createElement(Ke.a.Option,{key:"user"+t,value:e.username},e.username)}))),n.a.createElement("div",{style:{paddingBottom:30}},this.state.seleccionados.map(function(t,a){return n.a.createElement(Me.a,{closable:!0,key:t,onClose:function(){return e.removeSeleccionado(t)}},t)})),n.a.createElement(pe.a,{onClick:this.crearGrupo},"Crear nuevo grupo")))),n.a.createElement(qe.a,{visible:this.state.modalEdicion,footer:null,onCancel:function(){return e.setState({modalEdicion:!1,grupoEditar:ht})}},n.a.createElement("h3",null,"Editar grupo"),n.a.createElement(le.a.Item,{label:"Nombre del grupo"},n.a.createElement(ue.a,{type:"text",value:this.state.grupoEditar.nombre,onChange:function(t){return e.setState({grupoEditar:Object(Pe.a)({},e.state.grupoEditar,{nombre:t.target.value})})}})),n.a.createElement(le.a.Item,{label:"Integrantes"},n.a.createElement(Ke.a,{style:{width:"100%"},onChange:function(t){return e.addSeleccionado(t,!0)}},this.props.usuarios.map(function(e,t){return n.a.createElement(Ke.a.Option,{key:"user"+t,value:e.username},e.username)}))),n.a.createElement("div",{style:{paddingBottom:30}},this.state.grupoEditar.users.map(function(t,a){return n.a.createElement(Me.a,{closable:!0,key:t._id,onClose:function(){return e.removeSeleccionado(t,!0)}},t.username)})),n.a.createElement("div",{style:{display:"flex",justifyContent:"flex-end"}},n.a.createElement(pe.a,{style:{paddingLeft:20},onClick:this.editarGrupo},"Editar Grupo"),n.a.createElement(pe.a,{type:"danger",onClick:function(){return e.setState({modalEdicion:!1,grupoEditar:ht})}},"Cancelar"))))}}]),t}(r.Component),bt=Object(U.b)(function(e){return{usuarios:e.usuarios,grupos:e.grupos}})(gt),yt=function(e){function t(){var e,a;Object(i.a)(this,t);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={editNombre:"",editCampos:[{"":""}],editGrupos:[],editUsuarios:[]},a.componentDidUpdate=function(e){e.pwSelect!==a.props.pwSelect&&a.props.pwSelect&&(console.log(a.props.pwSelect),a.setState({editNombre:a.props.pwSelect.nombre,editCampos:Object.keys(a.props.pwSelect.datos).map(function(e,t){return Object(Ae.a)({},e,a.props.pwSelect.datos[e])}),editGrupos:a.props.pwSelect.grupos.map(function(e){return e.nombre}),editUsuarios:a.props.pwSelect.users.map(function(e){return e.username})}))},a.handleRepeater=function(e,t,r){var n=a.state.editCampos[t],o=Object.keys(n)[0],s=Object.values(n)[0];"key"===r?(n[e]=s,delete n[o]):"value"===r&&(n[Object.keys(n)[0]]=e);var i=a.state.editCampos.map(function(e,a){return t===a?n:e});a.setState({editCampos:i})},a.editarEntrada=function(){var e=a.state.editUsuarios.map(function(e){return a.props.usuarios.find(function(t){return t.username===e})._id}),t=a.state.editGrupos.map(function(e){return a.props.grupos.find(function(t){return t.nombre===e})._id}),r=a.state.editCampos.reduce(function(e,t){return Object(Pe.a)({},e,t)},{});a.state.editCampos.length>Object.keys(r).length?E.a.warning("No puede haber dos campos con el mismo identificador"):(0===t.length&&0===e.length&&E.a.info("La entrada no ha sido asignada a nadie, estar\xe1 solo disponible para administradores"),H("/pws/"+a.props.pwSelect._id,{method:"PUT",body:{nombre:a.state.editNombre,datos:r,users:e,grupos:t}}).then(function(e){E.a.success("La entrada se edit\xf3 correctamente"),a.props.dispatch($()),a.setState({editNombre:"",editCampos:[{"":""}],editGrupos:[],editUsuarios:[]}),a.props.cb()}).catch(function(e){console.log(e),E.a.error("Ocurri\xf3 un error durante la edici\xf3n de la entrada")}))},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this,t=le.a.Item,a=Ke.a.Option;return n.a.createElement(qe.a,{visible:this.props.visible,footer:null,onCancel:this.props.cb,width:"80vw"},n.a.createElement("h2",null,this.props.pwSelect.nombre),n.a.createElement("div",null,n.a.createElement(t,{label:"Nombre de la entrada"},n.a.createElement(ue.a,{type:"text",value:this.state.editNombre,onChange:function(t){return e.setState({editNombre:t.target.value})}})),n.a.createElement(t,{label:"Campos"},this.state.editCampos.map(function(a,r){return n.a.createElement("div",{key:"campo"+r,style:{display:"flex"}},n.a.createElement(t,{label:"Identificador",style:{flex:1,paddingRight:"1em"}},n.a.createElement(ue.a,{type:"text",value:Object.keys(a)[0],onChange:function(t){return e.handleRepeater(t.target.value,r,"key")}})),n.a.createElement(t,{label:"Valor",style:{flex:1,paddingRight:"1em"}},n.a.createElement(ue.a,{type:"text",value:Object.values(a)[0],onChange:function(t){return e.handleRepeater(t.target.value,r,"value")}})),e.state.editCampos.length>1&&n.a.createElement(t,{label:" ",colon:!1},n.a.createElement(Me.a,{color:"volcano",onClick:function(){return e.setState({editCampos:e.state.editCampos.filter(function(e,t){return t!==r})})}},n.a.createElement(w.a,{type:"delete"}))))}),n.a.createElement(Me.a,{onClick:function(){return e.setState({editCampos:[].concat(Object(De.a)(e.state.editCampos),[{"":""}])})}},n.a.createElement(w.a,{type:"plus"})," Nuevo campo")),n.a.createElement(X,{blue:this.props.blue},n.a.createElement(t,{label:"Asignar a grupos"},n.a.createElement(Ke.a,{style:{width:"100%"},onChange:function(t){return e.setState({editGrupos:Object(De.a)(new Set([].concat(Object(De.a)(e.state.editGrupos),[t])))})}},this.props.grupos.map(function(e,t){return n.a.createElement(a,{key:"grupo"+t,value:e.nombre},e.nombre)})),n.a.createElement("div",{style:{paddingBottom:30}},this.state.editGrupos.map(function(t,a){return n.a.createElement(Me.a,{closable:!0,key:"gtag"+t,onClose:function(){return e.setState({editGrupos:e.state.editGrupos.filter(function(e){return e!==t})})}},t)}))),n.a.createElement(t,{label:"Asignar a usuarios"},n.a.createElement(Ke.a,{style:{width:"100%"},onChange:function(t){return e.setState({editUsuarios:Object(De.a)(new Set([].concat(Object(De.a)(e.state.editUsuarios),[t])))})}},this.props.usuarios.map(function(e,t){return n.a.createElement(a,{key:"user"+t,value:e.username},e.username)})),n.a.createElement("div",{style:{paddingBottom:30}},this.state.editUsuarios.map(function(t,a){return n.a.createElement(Me.a,{closable:!0,key:"utag"+t,onClose:function(){return e.setState({editUsuarios:e.state.editUsuarios.filter(function(e){return e!==t})})}},t)})))),n.a.createElement(pe.a,{onClick:this.editarEntrada},"Editar entrada")))}}]),t}(r.Component),vt=Object(U.b)()(yt),Et=function(e){function t(){var e,a;Object(i.a)(this,t);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={nuevaNombre:"",nuevaCampos:[{username:""},{password:""}],nuevaGrupos:[],nuevaUsuarios:[],modalPw:!1,pwSelect:{datos:{}}},a.txtRefs=[],a.filtraPw=function(){return a.props.pws.filter(function(e){var t=e.grupos.map(function(e){return e._id}),r=a.props.auth.grupos.map(function(e){return e._id}),n=t.filter(function(e){return r.includes(e)}).length>0,o=e.users.map(function(e){return e._id}).includes(a.props.auth._id),s=a.props.auth.manager&&!a.props.blueCollar;return n||o||s})},a.handleRepeater=function(e,t,r){var n=a.state.nuevaCampos[t],o=Object.keys(n)[0],s=Object.values(n)[0];"key"===r?(n[e]=s,delete n[o]):"value"===r&&(n[Object.keys(n)[0]]=e);var i=a.state.nuevaCampos.map(function(e,a){return t===a?n:e});a.setState({nuevaCampos:i})},a.nuevaEntrada=function(){var e=a.state.nuevaUsuarios.map(function(e){return a.props.usuarios.find(function(t){return t.username===e})._id}),t=a.state.nuevaGrupos.map(function(e){return a.props.grupos.find(function(t){return t.nombre===e})._id}),r=a.state.nuevaCampos.reduce(function(e,t){return Object(Pe.a)({},e,t)},{});a.state.nuevaCampos.length>Object.keys(r).length?E.a.warning("No puede haber dos campos con el mismo identificador"):(0===t.length&&0===e.length&&E.a.info("La contrase\xf1a no ha sido asignada a nadie, estar\xe1 solo disponible para administradores"),H("/pws",{method:"POST",body:{nombre:a.state.nuevaNombre,datos:r,users:e,grupos:t,equipo:D().equipo}}).then(function(e){E.a.success("La entrada se guard\xf3 correctamente"),a.props.dispatch($()),a.setState({nuevaNombre:"",nuevaCampos:[{username:""},{password:""}],nuevaGrupos:[],nuevaUsuarios:[]})}).catch(function(e){console.log(e),E.a.error("Ocurri\xf3 un error durante el guardado de la entrada")}))},a.borrarEntrada=function(e){console.log(e),H("/pws/"+e._id,{method:"DELETE"}).then(function(e){E.a.success("La entrada se elimin\xf3 correctamente"),a.props.dispatch($())}).catch(function(e){console.log(e),E.a.error("Se produjo un error durante el borrado de la entrada")})},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.props.pws.length>0&&this.props.auth&&this.setState({pws:this.filtraPw()})}},{key:"componentDidUpdate",value:function(e){e.pws===this.props.pws&&this.props.blueCollar===e.blueCollar||!this.props.auth||this.setState({pws:this.filtraPw()})}},{key:"render",value:function(){var e=this,t=Ve.a.Panel,a=le.a.Item,r=Ke.a.Option;return n.a.createElement(y.a,{style:{height:"100vh"}},n.a.createElement(ie,{isLogged:!!A()},n.a.createElement("h2",null,"Contrase\xf1as"),n.a.createElement(Le.a,{style:{paddingBottom:30},rowKey:"_id",dataSource:this.state.pws,columns:[{title:"Entrada",dataIndex:"nombre",key:"nombre"},{title:"Asignada a",render:function(e){return console.log(e),[].concat(Object(De.a)(e.grupos),Object(De.a)(e.users)).map(function(e){return n.a.createElement(Me.a,{style:{margin:"2px"}},e.username?e.username:e.nombre)})}},{title:"",key:"btnConsulta",render:function(t){return n.a.createElement("div",{style:{display:"flex",justifyContent:"flex-end"}},n.a.createElement("div",{style:{display:"flex"}},n.a.createElement(X,{blue:e.props.blueCollar},n.a.createElement(Ue.a,{title:"Se borrar\xe1 la entrada. \xbfQuieres continuar?",onConfirm:function(){return e.borrarEntrada(t)},okText:"Aceptar",cancelText:"Cancelar"},n.a.createElement(Me.a,{color:"volcano",onClick:function(){return e.setState({pwSelect:t})}},n.a.createElement(w.a,{type:"delete"})," Eliminar"))),n.a.createElement(Me.a,{color:"gold",onClick:function(){return e.setState({modalEditarPws:!0,pwSelect:t})}},n.a.createElement(w.a,{type:"edit"})," Editar")),n.a.createElement(Me.a,{color:"blue",onClick:function(){return e.setState({modalPw:!0,pwSelect:t})}},n.a.createElement(w.a,{type:"search"})," Consultar"))}}]}),n.a.createElement(Ve.a,null,n.a.createElement(t,{key:"nueva",header:"Nueva entrada"},n.a.createElement(a,{label:"Nombre de la entrada"},n.a.createElement(ue.a,{type:"text",value:this.state.nuevaNombre,onChange:function(t){return e.setState({nuevaNombre:t.target.value})}})),n.a.createElement(a,{label:"Campos"},this.state.nuevaCampos.map(function(t,r){return n.a.createElement("div",{key:"campo"+r,style:{display:"flex"}},n.a.createElement(a,{label:"Identificador",style:{flex:1,paddingRight:"1em"}},n.a.createElement(ue.a,{type:"text",value:Object.keys(t)[0],onChange:function(t){return e.handleRepeater(t.target.value,r,"key")}})),n.a.createElement(a,{label:"Valor",style:{flex:1,paddingRight:"1em"}},n.a.createElement(ue.a,{type:"text",value:Object.values(t)[0],onChange:function(t){return e.handleRepeater(t.target.value,r,"value")}})),e.state.nuevaCampos.length>1&&n.a.createElement(a,{label:" ",colon:!1},n.a.createElement(Me.a,{color:"volcano",onClick:function(){return e.setState({nuevaCampos:e.state.nuevaCampos.filter(function(e,t){return t!==r})})}},n.a.createElement(w.a,{type:"delete"}))))}),n.a.createElement(Me.a,{onClick:function(){return e.setState({nuevaCampos:[].concat(Object(De.a)(e.state.nuevaCampos),[{"":""}])})}},n.a.createElement(w.a,{type:"plus"})," Nuevo campo")),n.a.createElement(a,{label:"Asignar a grupos"},n.a.createElement(Ke.a,{style:{width:"100%"},onChange:function(t){return e.setState({nuevaGrupos:Object(De.a)(new Set([].concat(Object(De.a)(e.state.nuevaGrupos),[t])))})}},this.props.grupos.map(function(e,t){return n.a.createElement(r,{key:"grupo"+t,value:e.nombre},e.nombre)})),n.a.createElement("div",{style:{paddingBottom:30}},this.state.nuevaGrupos.map(function(t,a){return n.a.createElement(Me.a,{closable:!0,key:"gtag"+t,onClose:function(){return e.setState({nuevaGrupos:e.state.nuevaGrupos.filter(function(e){return e!==t})})}},t)}))),n.a.createElement(a,{label:"Asignar a usuarios"},n.a.createElement(Ke.a,{style:{width:"100%"},onChange:function(t){return e.setState({nuevaUsuarios:Object(De.a)(new Set([].concat(Object(De.a)(e.state.nuevaUsuarios),[t])))})}},this.props.usuarios.map(function(e,t){return n.a.createElement(r,{key:"user"+t,value:e.username},e.username)})),n.a.createElement("div",{style:{paddingBottom:30}},this.state.nuevaUsuarios.map(function(t,a){return n.a.createElement(Me.a,{closable:!0,key:"utag"+t,onClose:function(){return e.setState({nuevaUsuarios:e.state.nuevaUsuarios.filter(function(e){return e!==t})})}},t)}))),n.a.createElement(pe.a,{onClick:this.nuevaEntrada},"Guardar entrada")))),n.a.createElement(qe.a,{visible:this.state.modalPw,footer:null,onCancel:function(){return e.setState({modalPw:!1})}},n.a.createElement("h2",null,this.state.pwSelect.nombre),n.a.createElement(Le.a,{showHeader:!1,pagination:!1,size:"small",rowKey:"zzzzz",dataSource:Object.keys(this.state.pwSelect.datos).map(function(t,a){var r;return r={},Object(Ae.a)(r,t,e.state.pwSelect.datos[t]),Object(Ae.a)(r,"zzzzz",a),r}),columns:[{title:"Identificador",key:function(e){return Object.keys(e)[0]},render:function(e){return Object.keys(e)[0]}},{title:"Valor",render:function(e){return Object.values(e)[0]}},{title:"",render:function(e){return n.a.createElement("div",{style:{display:"flex",justifyContent:"flex-end"}},n.a.createElement(pe.a,{onClick:function(){navigator.clipboard.writeText(Object.values(e)[0]),E.a.info("Se ha copiado la clave en el portapapeles")}},"Copiar"))}}]})),n.a.createElement(vt,{visible:this.state.modalEditarPws,cb:function(){return e.setState({modalEditarPws:!1})},pwSelect:this.state.pwSelect,grupos:this.props.grupos,usuarios:this.props.usuarios,blue:this.props.blueCollar}))}}]),t}(r.Component),Ct=Object(U.b)(function(e){return{grupos:e.grupos,usuarios:e.usuarios,pws:e.pws,auth:e.auth,blueCollar:e.blueCollar}})(Et),St=function(e){function t(){var e,a;Object(i.a)(this,t);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={},a.addFestivo=function(){a.state.nombre?a.state.fecha?H("/dias",{method:"POST",body:{fecha:je.a.utc(a.state.fecha).format(),tipo:"festivo",nombre:a.state.nombre,equipo:D().equipo,aprobado:!0}}).then(function(e){E.a.success("El nuevo festivo se ha a\xf1adido correctamente"),a.props.dispatch(V()),a.setState({nombre:void 0,fecha:void 0})}).catch(function(e){console.log(e),E.a.error("Se ha producido un error durante la creaci\xf3n del nuevo festivo")}):E.a.warning("No se ha seleccionado ninguna fecha"):E.a.warning("No se ha asignado nombre al festivo")},a.borrarFestivo=function(e){H("/dias/"+e._id,{method:"DELETE"}).then(function(e){E.a.success("Se ha borrado el festivo correctamente"),a.props.dispatch(V())}).catch(function(e){console.log(e),E.a.error("Ha ocurrido un error durante el borrado del festivo")})},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return n.a.createElement("div",null,n.a.createElement("h3",null,"Lista de festivos"),n.a.createElement(Le.a,{dataSource:this.props.dias.filter(function(e){return"festivo"===e.tipo}),rowKey:"_id",columns:[{title:"Nombre",dataIndex:"nombre",key:"nombre"},{title:"D\xeda",key:"fecha",render:function(e){return je()(e.fecha).format("YYYY-MM-DD")}},{key:"botones",render:function(t){return n.a.createElement("div",{key:t._id,style:{display:"flex",justifyContent:"flex-end"}},n.a.createElement(Ue.a,{title:"\xbfEst\xe1s seguro de que quieres borrar el d\xeda festivo?",onConfirm:function(){return e.borrarFestivo(t)},icon:n.a.createElement(w.a,{type:"warning",style:{color:"red"}})},n.a.createElement(Me.a,{color:"volcano",key:"".concat(t._id,"_dia")},n.a.createElement(w.a,{type:"delete"})," Borrar")))}}]}),n.a.createElement("h3",{style:{marginTOp:20}},"A\xf1adir festivo"),n.a.createElement("div",{style:{display:"flex",flexWrap:"wrap"}},n.a.createElement(le.a.Item,{label:"Nombre",style:{marginRight:20}},n.a.createElement(ue.a,{type:"text",onChange:function(t){return e.setState({nombre:t.target.value})}})),n.a.createElement(le.a.Item,{label:"Fecha",style:{marginRight:20}},n.a.createElement(nt.a,{onChange:function(t){return e.setState({fecha:t})},style:{width:250}})),n.a.createElement(le.a.Item,{label:" ",colon:!1},n.a.createElement(pe.a,{onClick:this.addFestivo},"A\xf1adir"))))}}]),t}(r.Component),jt=Object(U.b)(function(e){return{dias:e.dias}})(St),kt=function(e){function t(){var e,a;Object(i.a)(this,t);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=Ve.a.Panel;return n.a.createElement(y.a,{style:{height:"100vh"}},n.a.createElement(ie,{isLogged:!!A()},n.a.createElement("h1",null,"Configuraci\xf3n"),n.a.createElement(Ve.a,null,n.a.createElement(e,{header:"A\xf1adir registros"},n.a.createElement(lt,null))),n.a.createElement(Ve.a,null,n.a.createElement(e,{header:"Gestionar festivos"},n.a.createElement(jt,null)))))}}]),t}(r.Component),wt=a(79);var Ot=Object(wt.c)({usuarios:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case M:return console.log(t),t.payload;default:return e}},dias:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case T:return console.log(t),t.payload;default:return e}},es:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case R:return console.log(t),t.payload;default:return e}},documentos:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case L:return console.log(t),t.payload;default:return e}},blueCollar:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case G:return t.payload;default:return e}},grupos:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case q:return console.log(t),t.payload;default:return e}},pws:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Y:return console.log(t),t.payload;default:return e}},auth:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case B:return console.log(t),t.payload;default:return e}}}),xt=a(264),_t=Object(wt.d)(Ot,{},Object(wt.a)(xt.a));je.a.locale("es");var At=we.a.connect("https://we.blacknosaur.com",{transports:["websocket"]}),It=function(e){function t(){return Object(i.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=D();e&&e.equipo&&(_t.dispatch(W()),_t.dispatch(J()),_t.dispatch(V()),_t.dispatch(K()),_t.dispatch(Z()),_t.dispatch(Q()),_t.dispatch($()))}},{key:"render",value:function(){return n.a.createElement(U.a,{store:_t},n.a.createElement(ve.a,{locale:Ce.a},n.a.createElement(N.SocketProvider,{socket:At},n.a.createElement(m.a,null,n.a.createElement(p.a,null,n.a.createElement(f.a,{exact:!0,path:"/login",component:he}),n.a.createElement(f.a,{exact:!0,path:"/register",component:be}),n.a.createElement(_e,{exact:!0,path:"/calendario",component:Be}),n.a.createElement(_e,{exact:!0,path:"/archivos",component:$e}),n.a.createElement(_e,{exact:!0,path:"/perfil",component:ft}),n.a.createElement(_e,{exact:!0,path:"/usuarios",component:et}),n.a.createElement(_e,{exact:!0,path:"/passwords",component:Ct}),n.a.createElement(_e,{onlyManager:!0,exact:!0,path:"/analitica",component:rt}),n.a.createElement(_e,{onlyManager:!0,exact:!0,path:"/grupos",component:bt}),n.a.createElement(_e,{onlyManager:!0,exact:!0,path:"/configuracion",component:kt}),n.a.createElement(_e,{exact:!0,path:"/usuario/:id",component:at}),n.a.createElement(_e,{exact:!0,path:"/registro",component:pt}),n.a.createElement(_e,{exact:!0,path:"/nuevousuario",component:He}),n.a.createElement(_e,{exact:!0,path:"/",component:Ie}),n.a.createElement(f.a,{path:"",component:ye}))))))}}]),t}(r.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(n.a.createElement(It,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[272,1,2]]]);
//# sourceMappingURL=main.7722d2f9.chunk.js.map