(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{467:function(e,t,a){e.exports=a(840)},472:function(e,t,a){},603:function(e,t){},615:function(e,t){},617:function(e,t){},744:function(e,t){},745:function(e,t){},840:function(e,t,a){"use strict";a.r(t);var r=a(0),n=a.n(r),o=a(14),s=a.n(o),i=(a(472),a(31)),c=a(27),l=a(29),u=a(28),d=a(30),p=a(864),m=a(868),f=a(845),h=a(17),g=a.n(h),b=a(66),y=a(842),E=a(856),v=a(862),C=a(858),S=a(319),j=a(236),k=a(844),w=a(867),O=a(13),x=a(464),D=a(68),A=a(843),_=a(866);function I(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];void 0===e&&console.log("El par\xe1metro 'query' de la funcion gql est\xe1 vac\xedo");var n=e.replace(/\n/gi,"%0A").replace(/:/gi,"%3A").replace(/\\/gi,"%22").replace(/ {2}/gi,"%09").replace(/ /gi,"%20").replace(/{/gi,"%7B").replace(/}/gi,"%7D").replace(/\(/gi,"%28").replace(/\)/gi,"%29");return a+"/graphql?query="+(r?n:n.replace(/\t/gi,"%09").split("%09").filter(function(e){return""!==e}).reduce(function(e,t){return e+"%09"+t},"").split("%0A%09").filter(function(e){return""!==e}).reduce(function(e,t){return e+"%09"+t},"").replace(/%7B%09/gi,"%7B").replace(/%7D%09/gi,"%7D").replace(/%09%7B/gi,"%7B").replace(/%09%7D/gi,"%7D").slice(3)).split("$").map(function(e,a){return a%2?t[e]:e}).reduce(function(e,t){return e+t},"")}function M(){return"undefined"!==window.localStorage.getItem("jwt")?JSON.parse(window.localStorage.getItem("jwt")):void 0}function P(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"application/json",a=M(),r={Accept:t,"Content-Type":t};return a&&!e&&(r.Authorization="Bearer "+a),r}function L(){var e=window.localStorage.getItem("user");return["undefined","",void 0].includes(e)?void 0:JSON.parse(window.localStorage.getItem("user"))}function T(e){window.localStorage.setItem("jwt",JSON.stringify(e.jwt)),window.localStorage.setItem("user",JSON.stringify(e.user))}var N="CARGAR_USUARIOS",R="CARGAR_CALENDARIO",U="CARGAR_ES",Y="CARGAR_DOCUMENTOS",q="CARGAR_GRUPOS",B="CARGAR_PWS",G="CARGAR_AUTH",F="CARGAR_ENTRADAS",z="CAMBIAR_BLUE_COLLAR",H="CAMBIAR_MES_ES",J="FALLO_CARGA";a(475);function W(e){return e.json?e.json():e}function V(e){return e.status>=200&&e.status<300?e:W(e).then(function(t){t.errors&&t.errors.forEach(function(e){console.log(e)});var a=new Error(e.statusText);throw a.response=e,a.response.payload=t,a})}function K(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];a&&(t.headers=Object.assign({"Content-Type":"application/json"},t.headers,{}));var r=M();if(r&&(t.headers=Object.assign({Authorization:"Bearer ".concat(r)},t.headers)),t&&t.params){var n=function(e){return Object.keys(e).map(function(t){return"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(e[t]))}).join("&")}(t.params);e="".concat(e,"?").concat(n)}return t&&t.body&&a&&(t.body=JSON.stringify(t.body)),fetch("https://we.blacknosaur.com"+e,t).then(V).then(W)}var Z=a(6),Q=a.n(Z);function $(e){return{type:J,payload:e}}function X(e){return{type:H,payload:e}}var ee=function(){return function(e){return K("/users?_limit=0&equipo="+(L()&&L().equipo)).then(function(t){e({type:N,payload:t})}).catch(function(t){ue(t,e,"usuarios")})}};var te=function(){return function(e){return K("/users/me").then(function(t){e({type:G,payload:t})}).catch(function(t){ue(t,e,"auth")})}};var ae=function(){return function(e){return K(I((t=L(),t.equipo?'{\n    dias(where: { equipo: "'.concat(t.equipo,'" }, limit: 10000){\n        _id\n        fecha\n        tipo\n        aprobado\n        nombre\n        user{\n            _id\n            username\n            avatar{\n                url\n            }\n        }\n    }\n}'):"{}"))).then(function(t){var a;e((a=t.data.dias,{type:R,payload:a}))}).catch(function(t){ue(t,e,"calendario")});var t}};var re=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Q()();return function(t){return K(I((a={equipo:L().equipo,desde:e.clone().startOf("month").utc().format(),hasta:e.clone().endOf("month").utc().format()},a.equipo?'{\n    equipo(id: "'.concat(a.equipo,'"){\n        razonSocial\n        cif\n        ccc\n        users{\n            _id\n            username\n            nombre\n            apellidos\n            nif\n            nuss\n            avatar{\n                url\n            }\n            registros(limit: 1000000000, where: {fecha_lte: "').concat(a.hasta,'", fecha_gte: "').concat(a.desde,'"}){\n                _id\n                fecha\n                idcard\n                aprobado\n                user{\n                    _id\n                    username\n                }\n                ultimoEditor{\n                    _id\n                    username\n                }\n            }\n            duracionjornada\n        }\n    }\n}'):"{}"))).then(function(e){var a;t((a=e.data.equipo,{type:U,payload:a}))}).catch(function(e){ue(e,t,"es")});var a}};var ne=function(){return function(e){return K("/documentos?_limit=0").then(function(t){e({type:Y,payload:t})}).catch(function(t){ue(t,e,"documentos")})}};var oe=function(){return function(e){return K("/grupos?_limit=0").then(function(t){e({type:q,payload:t})}).catch(function(t){ue(t,e,"grupos")})}};var se=function(){return function(e){return K("/pws?_limit=0").then(function(t){e({type:B,payload:t})}).catch(function(t){ue(t,e,"pws")})}};var ie=function(){return function(e){return K(I((t=L(),t.equipo?'\n{\n    entradas(where: {equipo: "'.concat(t.equipo,'"}, sort: "createdAt:desc", limit: 3){\n        _id\n        createdAt\n        titulo\n        imagen{\n            url\n        }\n        resumen\n        cuerpo\n        slug\n    }\n}'):"{}"))).then(function(t){e({type:F,payload:t})}).catch(function(t){ue(t,e,"entradas")});var t}},ce=function(e){return e.replace(/\s|-/g," ,").split(",").map(function(e){return e.slice(0,1).toUpperCase()+e.slice(1).toLowerCase()}).reduce(function(e,t){return e+t},"")},le=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return parseInt(e*Math.pow(10,t),10)/Math.pow(10,t)},ue=function(e,t,a){console.log(e.response.payload.error+" - "+e.response.payload.message),403===e.response.status?(v.a.error("No tienes permiso para acceder a ese contenido"),t($({error:403,redirectTo:"/",chivato:a}))):401===e.response.status&&(v.a.error("La sesi\xf3n ha caducado o los datos de autenticaci\xf3n son incorrectos"),localStorage.clear(),sessionStorage.clear(),t($({error:401,redirectTo:"/login",chivato:a})))},de=a(97),pe=a(39),me=y.a.Header,fe=y.a.Footer,he=y.a.Sider,ge=y.a.Content,be=E.a.Title,ye=E.a.Paragraph,Ee=function(e){function t(){var e,a;Object(c.a)(this,t);for(var r=arguments.length,o=new Array(r),s=0;s<r;s++)o[s]=arguments[s];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).state={user:{username:" "},local:!1,hoy:[],loading:!0},a.iframe=n.a.createRef(),a.cerrarSesion=function(){window.localStorage.removeItem("jwt"),window.localStorage.removeItem("user"),v.a.info("\xa1Vuelve pronto!"),a.props.history.push("/login")},a.fichar=function(){C.a.confirm({title:"".concat(ce(a.props.auth.nombre)," - ").concat(Q()().format("LLL")),content:"Vas a fichar para ".concat(a.state.hoy.length%2?"salir.":"entrar.","\n            ").concat(a.state.hoy.length>0?"Has fichado hoy "+a.state.hoy.length+" ve"+(1===a.state.hoy.length?"z":"ces"):"No has fichado todav\xeda hoy"),onOk:function(){K("/registros",{method:"POST",body:{fecha:Q()().format(),user:a.props.auth._id,ultimoEditor:a.props.auth._id,aprobado:!0}}).then(function(e){v.a.success("Has fichado correctamente a las "+Q()().format("HH:mm"))}).catch(function(e){v.a.error("Se ha producido un error"),console.log(e)})}})},a.abrirPuerta=function(){a.iframe.current.src=null,a.iframe.current.src="http://192.168.1.65:24491/puerta"},a}return Object(d.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){var e=Object(b.a)(g.a.mark(function e(){var t,a,r,n,o,s=this;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.props.socket.on("notification",function(e){e.es?s.props.dispatch(re()):e.dia?s.props.dispatch(ae()):e.user&&s.props.dispatch(ee())}),this.props.es.users&&this.props.dias&&(t=[].concat.apply([],this.props.es.users.map(function(e){return e.registros})).map(function(e){return e.aprobado}),a=!(!this.props.dias.map(function(e){return e.aprobado}).includes(null)&&!this.props.dias.map(function(e){return e.aprobado}).includes(!1)),r=!(!t.includes(!1)&&!t.includes(null)),n=!!this.props.usuarios.map(function(e){return e.confirmed}).includes(!1),this.setState({diasPorConfirmar:a,registrosPorConfirmar:r,usuariosPorConfirmar:n})),this.props.auth&&this.props.auth.registros&&(o=this.props.auth.registros.filter(function(e){return Q()(e.fecha).isSame(Q()(),"day")}),this.setState({hoy:o}));case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"componentDidUpdate",value:function(e,t){var a=this.props.errorCarga;if(a.error&&(this.props.dispatch($({error:!1})),this.props.history.push(a.redirectTo||"/login")),this.props.dias!==e.dias&&this.props.dias)console.log(this.props.dias),this.props.dias.map(function(e){return e.aprobado}).includes(null)||this.props.dias.map(function(e){return e.aprobado}).includes(!1)?this.setState({diasPorConfirmar:!0}):this.setState({diasPorConfirmar:!1});else if(this.props.es!==e.es&&this.props.es){var r=[].concat.apply([],this.props.es.users.map(function(e){return e.registros})).map(function(e){return e.aprobado});r.includes(!1)||r.includes(null)?this.setState({registrosPorConfirmar:!0}):this.setState({registrosPorConfirmar:!1})}else if(this.props.usuarios!==e.usuarios&&this.props.usuarios)this.props.usuarios.map(function(e){return e.confirmed}).includes(!1)?this.setState({usuariosPorConfirmar:!0}):this.setState({usuariosPorConfirmar:!1});else if(this.props.auth!==e.auth&&this.props.auth){var n=this.props.auth.registros.filter(function(e){return Q()(e.fecha).isSame(Q()(),"day")});this.setState({hoy:n})}}},{key:"render",value:function(){var e=this,t=this.state.user,a=this.props,r=a.isLogged,o=a.auth,s=n.a.createElement(S.b,null,n.a.createElement(S.b.Item,null,n.a.createElement(A.a,{to:"/perfil"},"Perfil")),n.a.createElement(S.b.Item,{onClick:this.cerrarSesion},n.a.createElement("span",null,"Cerrar sesi\xf3n")),o&&o.manager&&n.a.createElement(S.b.Item,{onClick:function(){return e.props.dispatch((t=!e.props.blueCollar,{type:z,payload:t}));var t}},n.a.createElement("span",null,this.props.blueCollar?"Modo Manager":"Modo Blue Collar")));return n.a.createElement("div",{style:{minHeight:"100vh",display:"flex",flexDirection:"column"}},n.a.createElement(me,{key:"header",style:{backgroundColor:"black",display:"flex",alignItems:"center",justifyContent:"space-between"}},n.a.createElement(A.a,{to:"/"},n.a.createElement(be,{style:{color:"#f0f0f0",margin:"0.25em",display:"flex",alignItems:"center"}},n.a.createElement("img",{src:"https://we.blacknosaur.com/logo.png",alt:"Blacknosaur Logo",style:{filter:"invert(1)",height:45,marginRight:20}})," Portal del Blacknosaurio")),r&&n.a.createElement(j.a,{overlay:s},n.a.createElement(k.a,{style:{objectFit:"cover",boxShadow:this.props.blueCollar?"inset 0 0 4px 1px blue":"none"},src:o&&o.avatar&&"https://we.blacknosaur.com"+o.avatar.url},t&&t.username&&t.username[0].toUpperCase()))),n.a.createElement(y.a,{key:"layout",style:{flex:1}},r&&n.a.createElement(he,{style:{backgroundColor:"#191919"}},n.a.createElement(S.b,{theme:"dark",style:{backgroundColor:"#191919",height:"100%",position:"relative"},mode:"vertical-left",selectedKeys:[window.location.pathname]},n.a.createElement(S.b.Item,{key:"/"},n.a.createElement(A.a,{to:"/"},"Home")),n.a.createElement(S.b.Item,{key:"/calendario",style:{display:"flex",alignItems:"center"}},n.a.createElement(A.a,{to:"/calendario"},"Calendario"),this.state.diasPorConfirmar&&o&&o.manager&&!this.props.blueCollar&&n.a.createElement(w.a,{style:{transform:"initial",position:"static",marginLeft:10},count:n.a.createElement(O.a,{type:"bell",style:{color:"#f5222d"}})})),n.a.createElement(S.b.Item,{key:"/archivos"},n.a.createElement(A.a,{to:"/archivos"},"Documentos")),n.a.createElement(S.b.Item,{key:"/registro",style:{display:"flex",alignItems:"center"}},n.a.createElement(A.a,{to:"/registro"},"Registro E/S"),this.state.registrosPorConfirmar&&o&&o.manager&&!this.props.blueCollar&&n.a.createElement(w.a,{style:{transform:"initial",position:"static",marginLeft:10},count:n.a.createElement(O.a,{type:"bell",style:{color:"#f5222d"}})})),n.a.createElement(S.b.Item,{key:"/exportacion",style:{alignItems:"center",display:o&&o.manager&&!this.props.blueCollar?"flex":"none"}},n.a.createElement(A.a,{to:"/exportacion"},"Exportaci\xf3n")),n.a.createElement(S.b.Item,{key:"/usuarios",style:{alignItems:"center"}},n.a.createElement(A.a,{to:"/usuarios"},"Usuarios"),this.state.usuariosPorConfirmar&&o&&o.manager&&!this.props.blueCollar&&n.a.createElement(w.a,{style:{transform:"initial",position:"static",marginLeft:10},count:n.a.createElement(O.a,{type:"bell",style:{color:"#f5222d"}})})),n.a.createElement(S.b.Item,{key:"/grupos",style:{alignItems:"center",display:o&&o.manager&&!this.props.blueCollar?"flex":"none"}},n.a.createElement(A.a,{to:"/grupos"},"Grupos")),n.a.createElement(S.b.Item,{key:"/passwords",style:{alignItems:"center"}},n.a.createElement(A.a,{to:"/passwords"},"Contrase\xf1as")),n.a.createElement(S.b.Item,{key:"/configuracion",style:{alignItems:"center",display:o&&o.manager&&!this.props.blueCollar?"flex":"none"}},n.a.createElement(A.a,{to:"/configuracion"},"Configuraci\xf3n")),n.a.createElement(S.b.Item,{key:"telefonillo",className:"telefonillo",style:{alignItems:"center",display:"flex",justifyContent:"space-between"}},n.a.createElement("div",{style:{width:"100%",display:"flex",justifyContent:"space-between",alignItems:"center"}},n.a.createElement("a",{style:{flex:1,color:"rgba(255, 255, 255, 0.65)"},href:"http://192.168.1.65:24491",target:"_blank",rel:"noopener noreferrer"},"Telefonillo "),n.a.createElement(x.a,{type:"primary",onClick:function(){return e.abrirPuerta()}},"Abrir\xa0",n.a.createElement(O.a,{style:{margin:0},type:"login"})))),n.a.createElement(S.b.Item,{key:"fichar",style:{position:"absolute",bottom:10,width:"100%",display:"flex",justifyContent:"center"}},n.a.createElement(D.a,{onClick:this.fichar},n.a.createElement(O.a,{type:this.state.hoy.length%2?"smile":"meh"})," Fichar")))),n.a.createElement(y.a,null,n.a.createElement(ge,{style:{padding:"2em",display:"flex",flexDirection:"column"}},n.a.createElement("div",{style:{flex:1}},this.props.children),n.a.createElement(fe,{style:{paddingBottom:0}},n.a.createElement(ye,null,"\xae 2019 - Made with ",n.a.createElement("span",{role:"img","aria-label":"heart"},"\u2764\ufe0f"),", ",n.a.createElement("span",{role:"img","aria-label":"beer"},"\ud83c\udf7a")," and ",n.a.createElement("span",{role:"img","aria-label":"poo"},"\ud83d\udca9")," by ",n.a.createElement("a",{href:"https://blacknosaur.com",target:"_blank",rel:"noopener noreferrer"},"Blacknosaur")," & ",n.a.createElement("a",{href:"https://www.alhill.dev",target:"_blank",rel:"noopener noreferrer"},"AlHill Development")))))),n.a.createElement("iframe",{style:{height:0,width:0,border:0},ref:this.iframe,src:""}))}}]),t}(r.Component),ve=Object(de.socketConnect)(Object(pe.b)(function(e){return{blueCollar:e.blueCollar,es:e.es,usuarios:e.usuarios,dias:e.dias,auth:e.auth,errorCarga:e.errorCarga}})(Object(_.a)(Ee))),Ce=a(854),Se=a(851),je=a(859),ke=a(166),we=a(91);var Oe=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).handleSubmit=function(e){e.preventDefault(),a.props.form.validateFields(function(e,t){e||fetch("https://we.blacknosaur.com/auth/local",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({identifier:t.userName,password:t.password})}).then(function(e){e.json().then(function(e){console.log(e.user),400===e.statusCode?a.setState({error:!0}):e.user.confirmed?(a.setState({error:!1}),T(e),a.props.dispatch(te()),a.props.dispatch(ee()),a.props.dispatch(ae()),a.props.dispatch(re()),a.props.history.push("/")):v.a.info("Tu acceso al equipo de trabajo todav\xeda no ha sido aprobado")}).catch(function(e){return console.log(e)})}).catch(function(e){return console.log(e)})})},a.state={error:!1},a}return Object(d.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){this.props.form.validateFields(),!this.props.errorCarga.error&&this.props.auth&&(console.log(this.props.auth),console.log(this.props.errorCarga))}},{key:"render",value:function(){var e,t=this,a=this.props.form,r=a.getFieldDecorator,o=a.getFieldsError,s=a.getFieldError,i=a.isFieldTouched,c=i("userName")&&s("userName"),l=i("password")&&s("password");return n.a.createElement(y.a,{style:{height:"100vh"}},n.a.createElement(ve,{isLogged:!!M()},n.a.createElement(y.a.Content,{style:{display:"flex",justifyContent:"center",alignItems:"center"}},n.a.createElement(Ce.a,{style:{width:450,maxWidth:"90%"}},n.a.createElement(Se.a,{onSubmit:this.handleSubmit},n.a.createElement(Se.a.Item,{validateStatus:c||this.state.error?"error":"",help:c||""},r("userName",{rules:[{required:!0,message:"Introduce tu nombre de usuario"}]})(n.a.createElement(je.a,{onChange:function(e){return t.setState({user:e.target.value})},prefix:n.a.createElement(O.a,{type:"user",style:{color:"rgba(0,0,0,.25)"}}),placeholder:"Nombre de usuario"}))),n.a.createElement(Se.a.Item,{validateStatus:l||this.state.error?"error":"",help:l||""},r("password",{rules:[{required:!0,message:"Introduce tu contrase\xf1a"}]})(n.a.createElement(je.a,{onChange:function(e){return t.setState({pw:e.target.value})},prefix:n.a.createElement(O.a,{type:"lock",style:{color:"rgba(0,0,0,.25)"}}),type:"password",placeholder:"Contrase\xf1a"}))),n.a.createElement(Se.a.Item,null,n.a.createElement(ke.a,null,n.a.createElement(we.a,{span:12,style:{justifyContent:"center",display:"flex"}},n.a.createElement(D.a,{type:"primary",onClick:function(){return t.props.history.push("/register")}},"Registrarse")),n.a.createElement(we.a,{span:12,style:{justifyContent:"center",display:"flex"}},n.a.createElement(D.a,{type:"primary",htmlType:"submit",disabled:(e=o(),Object.keys(e).some(function(t){return e[t]}))},"Acceder")))))))))}}]),t}(r.Component),xe=Se.a.create({name:"login_form"})(Object(pe.b)(function(e){return{errorCarga:e.errorCarga,auth:e.auth}})(Oe)),De=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).handleSubmit=function(e){e.preventDefault(),a.props.form.validateFields(function(e,t){e||(t.password===t.password2?a.validateEmail(t.email)?fetch("https://we.blacknosaur.com/auth/local/register",{method:"POST",headers:P(!0),body:JSON.stringify({username:t.userName,password:t.password,email:t.email,confirmed:!1})}).then(function(e){e.json().then(function(e){T(e),a.props.history.push("/nuevousuario")}).catch(function(e){return console.log(e)})}).catch(function(e){return console.log(e)}):a.setState({errorEmail:!0}):a.setState({errorPw:!0}))})},a.state={errorUser:!1,errorEmail:!1,errorPw:!1},a}return Object(d.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){this.props.form.validateFields()}},{key:"validateEmail",value:function(e){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(e).toLowerCase())}},{key:"render",value:function(){var e=this,t=this.props.form,a=t.getFieldDecorator,r=t.getFieldError,o=t.isFieldTouched,s=o("userName")&&r("userName"),i=o("email")&&r("email"),c=o("password")&&r("password"),l=o("password2")&&r("password2");return n.a.createElement(y.a,{style:{height:"100vh"}},n.a.createElement(ve,{isLogged:!!M()},n.a.createElement(y.a.Content,{style:{display:"flex",justifyContent:"center",alignItems:"center"}},n.a.createElement(Ce.a,{style:{width:450,maxWidth:"90%"}},n.a.createElement(Se.a,{onSubmit:this.handleSubmit},n.a.createElement(Se.a.Item,{validateStatus:s||this.state.errorUser?"error":"",help:s||""},a("userName",{rules:[{required:!0,message:"Introduce tu nombre de usuario"}]})(n.a.createElement(je.a,{onChange:function(t){return e.setState({user:t.target.value})},prefix:n.a.createElement(O.a,{type:"user",style:{color:"rgba(0,0,0,.25)"}}),placeholder:"Nombre de usuario"}))),n.a.createElement(Se.a.Item,{validateStatus:i||this.state.errorEmail?"error":"",help:i||""},a("email",{rules:[{required:!0,message:"Introduce tu email"}]})(n.a.createElement(je.a,{onChange:function(t){return e.setState({email:t.target.value})},prefix:n.a.createElement(O.a,{type:"mail",style:{color:"rgba(0,0,0,.25)"}}),type:"email",placeholder:"Email"}))),n.a.createElement(Se.a.Item,{validateStatus:c||this.state.errorPw?"error":"",help:c||""},a("password",{rules:[{required:!0,message:"Introduce tu contrase\xf1a"}]})(n.a.createElement(je.a,{onChange:function(t){return e.setState({pw:t.target.value})},prefix:n.a.createElement(O.a,{type:"lock",style:{color:"rgba(0,0,0,.25)"}}),type:"password",placeholder:"Contrase\xf1a"}))),n.a.createElement(Se.a.Item,{validateStatus:l||this.state.errorPw?"error":"",help:l||""},a("password2",{rules:[{required:!0,message:"Repite la contrase\xf1a"}]})(n.a.createElement(je.a,{onChange:function(t){return e.setState({pw:t.target.value})},prefix:n.a.createElement(O.a,{type:"lock",style:{color:"rgba(0,0,0,.25)"}}),type:"password",placeholder:"Repetir contrase\xf1a"}))),n.a.createElement(Se.a.Item,null,n.a.createElement(ke.a,null,n.a.createElement(we.a,{style:{justifyContent:"center",display:"flex"}},n.a.createElement(D.a,{type:"primary",onClick:this.handleSubmit},"Registrarse")))))))))}}]),t}(r.Component),Ae=Se.a.create({name:"register_form"})(De),_e=function(){return n.a.createElement(y.a,{style:{height:"100vh"}},n.a.createElement(ve,{isLogged:!!M()},n.a.createElement(y.a.Content,{style:{display:"flex",justifyContent:"center",alignItems:"center"}},n.a.createElement(Ce.a,{style:{width:450,maxWidth:"90%"}},n.a.createElement(E.a.Title,{style:{margin:0,textAlign:"center"}},"404!")))))},Ie=(a(577),a(850)),Me=a(461),Pe=a.n(Me),Le=(a(578),a(437)),Te=a.n(Le),Ne=a(465),Re=a(865),Ue=function(e){var t=e.component,a=e.onlyManager,r=void 0!==a&&a,o=Object(Ne.a)(e,["component","onlyManager"]),s=L();return n.a.createElement(f.a,Object.assign({},o,{render:function(e){return s&&(!r||r&&s.manager)?n.a.createElement(t,e):n.a.createElement(Re.a,{to:{pathname:"/login",state:{from:e.location}}})}}))},Ye=a(70),qe=a(438),Be=a.n(qe),Ge=function(e){function t(){var e,a;Object(c.a)(this,t);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={},a}return Object(d.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){var e=this;fetch("https://opendata.aemet.es/opendata/api/prediccion/especifica/municipio/horaria/28079/?api_key=eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJhbHZhcm9naWxAYmxhY2tub3NhdXIuY29tIiwianRpIjoiNTQwNjQ0NzEtMzhiMC00MTRiLWE3MDktMGYxYTVmY2JkOGUyIiwiaXNzIjoiQUVNRVQiLCJpYXQiOjE1NjAyNTcyNTMsInVzZXJJZCI6IjU0MDY0NDcxLTM4YjAtNDE0Yi1hNzA5LTBmMWE1ZmNiZDhlMiIsInJvbGUiOiIifQ.ihZx3I_3987zhxRmM8oA8_-hSI9OTakxR6e-WmU5fjs",{headers:{"Cache-Control":"no-cache"}}).then(function(t){t.json().then(function(t){fetch(t.datos).then(function(t){t.json().then(function(t){var a=t[0].prediccion.dia.map(function(e){var t=e.estadoCielo.map(function(e){return e.periodo});return Object(Ye.a)({},Q()().isSame(e.fecha,"day")?"Hoy":Q()().add(1,"day").isSame(e.fecha,"day")?"Ma\xf1ana":"borrar",t.map(function(t){return{hora:t,estadoCielo:e.estadoCielo.find(function(e){return e.periodo===t}).value,temperatura:e.temperatura.find(function(e){return e.periodo===t}).value}}))}).filter(function(e){return"borrar"!==Object.keys(e)[0]});console.log(a),e.setState({meteo:a})})})}).catch(function(e){console.log(e)})}).catch(function(e){console.log(e)})}},{key:"render",value:function(){var e=this.props.auth;return e||(e={}),n.a.createElement(y.a,{style:{height:"100vh"}},n.a.createElement(ve,{isLogged:!!M()},n.a.createElement("h1",null,"Hola, ",ce(L().nombre)),Q()(e.finalcontrato&&!e.indefinido).isBefore(Q()().add(1,"day"))?n.a.createElement("p",null,"Trabajaste para ",e.equipo&&ce(e.equipo.nombre)," entre el ",Q()(e.iniciocontrato).format("LL")," y el ",Q()(e.finalcontrato).format("LL"),", ",Q()(e.finalcontrato).diff(Q()(e.iniciocontrato),"days")," d\xedas"):n.a.createElement("div",null,n.a.createElement("p",null,"Llevas trabajando para ",e.equipo&&ce(e.equipo.nombre)," desde el ",Q()(e.iniciocontrato).format("LL"),", hace ",Q()().diff(Q()(e.iniciocontrato),"days")," d\xedas"),!e.indefinido&&n.a.createElement("p",null,"Tienes contrato hasta el ",Q()(e.finalcontrato).format("LL"),", en ",Q()(e.finalcontrato).diff(Q()(),"days")," d\xedas")),n.a.createElement("br",null),n.a.createElement("h2",null,"\xdaltimas noticias"),this.props.entradas.map(function(e){return n.a.createElement("div",{key:e._id,style:{width:"100%",display:"flex",padding:0,backgroundColor:"white",borderRadius:5,overflow:"hidden",marginBottom:"2em"}},n.a.createElement("div",{style:{display:"flex",flexDirection:"column",flex:2,backgroundColor:"#333",justifyContent:"center",alignItems:"center"}},n.a.createElement("img",{src:e.imagen&&"https://we.blacknosaur.com"+e.imagen.url,style:{maxWidth:"100%",maxHeight:300,objectFit:"contain",objectPosition:"center center"}})),n.a.createElement("div",{style:{padding:"2em",flex:3}},n.a.createElement("h2",null,Q()(e.createdAt).format("YYYY-MM-DD")+"  "+e.titulo),Be()(e.resumen)))}),n.a.createElement("br",null),n.a.createElement("h2",null,"El tiempo"),this.state.meteo&&this.state.meteo.map(function(e,t){return n.a.createElement("div",{key:"d"+t},n.a.createElement("h3",null,Object.keys(e)[0]),n.a.createElement("div",{style:{display:"inline-flex",border:"1px solid gainsboro",borderRadius:3,boxShadow:"rgba(0, 0, 0, 0.1) 1px 1px 5px 0px",overflowX:"auto",marginBottom:"1em"}},Object.values(e)[0].map(function(e,t){return n.a.createElement("div",{style:{display:"flex",flex:1,flexDirection:"column"}},n.a.createElement("div",{key:"c"+t,style:{backgroundColor:"#333",color:"white",padding:5,textAlign:"center"}},e.hora,":00"),n.a.createElement("div",{style:{padding:5,textAlign:"center",fontWeight:"bold",color:e.temperatura<=15?"#2222cc":e.temperatura>=28?"#cc0000":"#333"}},e.temperatura,"\xba"),n.a.createElement("div",{style:{display:"flex",justifyContent:"center",alignItems:"center"}},n.a.createElement("img",{src:"".concat("","/meteo/").concat(e.estadoCielo,".png")})))})))})))}}]),t}(r.Component),Fe=Object(pe.b)(function(e){return{auth:e.auth,entradas:e.entradas}})(Ge),ze=a(34),He=a(40),Je=a(846),We=a(847),Ve=a(860),Ke=a(178),Ze=a(861),Qe=a(852),$e=function(e){function t(){return Object(c.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=L();return("object"!==typeof e||null===e||!1!==e.blocked||this.props.blue?{role:{name:"Not Authorised"}}:e).manager?this.props.children:""}}]),t}(r.Component),Xe=function(e){function t(){var e,a;Object(c.a)(this,t);for(var r=arguments.length,o=new Array(r),s=0;s<r;s++)o[s]=arguments[s];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).state={modalPedirDia:!1,dias:[],diasFilter:[],diasPorAprobar:[],festivos:[],festivosArrUTC:[],sel1:"libres",sel2:"global"},a.fetchDias=Object(b.a)(g.a.mark(function e(){return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.props.dispatch(ae());case 2:return e.next=4,a.props.dispatch(te());case 4:a.organizarDias();case 5:case"end":return e.stop()}},e)})),a.organizarDias=function(){var e=a.props.dias;if(e){var t=e.filter(function(e){return"festivo"===e.tipo}).map(function(e){return Object(He.a)({},e,{fecha:Q.a.utc(e.fecha).hour(0).minute(0).seconds(0).milliseconds(0).format()})}),r=t.map(function(e){return Q.a.utc(e.fecha).hour(2).minute(0).seconds(0).milliseconds(0).format()});a.setState({dias:e,festivos:t,festivosArrUTC:r,diasFilter:a.filtrarDias(e),diasPorAprobar:e.filter(function(e){return!e.aprobado}).map(function(e){return Object(He.a)({},e,{key:e._id})})})}},a.filtrarDias=function(e){var t="libres"===a.state.sel1?e.filter(function(e){return"libre"===e.tipo}):e.filter(function(e){return"remoto"===e.tipo});return"mios"===a.state.sel2?t.filter(function(e){return e.user._id===L()._id}):t},a.responderSolicitud=function(e,t){t?K("/dias/"+e._id,{method:"PUT",body:{aprobado:!0}}).then(function(t){v.a.success("Se ha aprobado la solicitud de ".concat(e.user.username," de d\xeda ").concat(e.tipo," el d\xeda ").concat(Q()(e.fecha).format("YYYY-MM-DD"))),a.fetchDias()}).catch(function(t){console.error(t),v.a.error("Se ha producido un error durante la aprobaci\xf3n del d\xeda ".concat(e.tipo," solicitado"))}):K("/dias/"+e._id,{method:"DELETE"}).then(function(t){v.a.info("Se ha denegado la solicitud de d\xeda "+e.tipo),a.fetchDias()}).catch(function(t){v.a.error("Se ha producido un error durante la denegaci\xf3n del d\xeda ".concat(e.tipo," solicitado")),console.error(t)})},a.getListData=function(e){return a.state.diasFilter.filter(function(t){return Q()(t.fecha).format("YYYYMMDD")===Q()(e).format("YYYYMMDD")}).map(function(e){return{user:e.user.username,aprobado:e.aprobado,tipo:e.tipo,_id:e._id,fecha:Q()(e.fecha),avatar:e.user.avatar&&"https://we.blacknosaur.com"+e.user.avatar.url}})||[]},a.dateFullCellRender=function(e){var t=a.getListData(e),r=Q.a.utc(e.hour(2).minute(0).seconds(0).milliseconds(0)).format(),o=a.state.festivos.find(function(e){return Q.a.utc(e.fecha).format()===r}),s={title:o?o.nombre:e.format("LL"),color:o?"rgba(255, 40, 30, 0.5)":[0,6].includes(e.day())?"rgba(255, 200, 100, 0.5)":"transparent"};return n.a.createElement("div",{className:"ant-fullcalendar-date",style:{backgroundColor:s.color,margin:"-1px 0",borderRadius:3},title:s.title,onClick:function(t){return a.handleCellClick(t,e)}},n.a.createElement("div",{className:"ant-fullcalendar-value"},e.date()),n.a.createElement("div",{className:"ant-fullcalendar-content"},n.a.createElement("ul",{className:"events",style:{margin:0,padding:2}},t.map(function(e){return n.a.createElement(Je.a,{className:e.aprobado?"":"sinactimel",key:e.user+e.fecha,content:n.a.createElement("div",{style:{display:"flex",flexDirection:"column",textAlign:"center"}},n.a.createElement("span",null,e.user),!e.aprobado&&L().manager&&n.a.createElement("div",{style:{display:"flex",marginTop:"1em"}},n.a.createElement(We.a,{title:"\xbfEst\xe1s seguro de que deseas aceptar la solicitud de d\xeda ".concat(e.tipo," para el d\xeda ").concat(Q()(e.fecha).format("YYYY-MM-DD")," a ").concat(e.user,"?"),onConfirm:function(t){return a.responderSolicitud(e,!0)}},n.a.createElement(x.a,{color:"green",key:"".concat(e._id,"_aceptar")},"Aprobar")),n.a.createElement(We.a,{title:"\xbfEst\xe1s seguro de que deseas denegar la solicitud de d\xeda ".concat(e.tipo," para el d\xeda ").concat(Q()(e.fecha).format("YYYY-MM-DD")," a ").concat(e.user,"?"),onConfirm:function(t){return a.responderSolicitud(e,!1)}},n.a.createElement(x.a,{color:"volcano",key:"".concat(e._id,"_denegar")},"Denegar"))))},n.a.createElement(k.a,{style:{margin:1},src:e.avatar?e.avatar:null},e.user[0].toUpperCase()))}))))},a.handleCellClick=function(e,t){e.persist(),["span","img","button"].includes(e._targetInst.elementType)||Object(ze.a)(e._targetInst.stateNode.classList).includes("ant-tag")||a.lanzarModalDia(t)},a.solicitarDia=function(e,t){var r=L(),n=r._id,o=r.equipo;console.log(L()),console.log(t),fetch("https://we.blacknosaur.com/dias",{method:"POST",headers:P(),body:JSON.stringify({fecha:e,tipo:t,user:n,aprobado:L().manager,equipo:o})}).then(function(e){e.json().then(function(e){e.aprobado?v.a.info("Te has asignado como d\xeda ".concat(t," el ").concat(Q()(a.state.dia).format("DD/MM/YYYY"))):v.a.info("Has solicitado como d\xeda ".concat(t," el ").concat(Q()(a.state.dia).format("DD/MM/YYYY"),". Tu solicitud est\xe1 pendiente de aprobaci\xf3n")),a.fetchDias(),a.setState({modalPedirDia:!1,dias:[].concat(Object(ze.a)(a.state.dias),[e])})}).catch(function(e){return console.log(e)})}).catch(function(e){return console.log(e)})},a.lanzarModalDia=function(e){console.log(e);var t=a.state.dias.filter(function(e){return e.user&&e.user._id===L()._id});if(Q()().isSameOrBefore(e,"day"))if(void 0===a.state.festivos.find(function(t){return Q()(t.fecha).isSame(e,"day")})){var r=t.find(function(t){return Q()(t.fecha).isSame(e,"day")});r?r.aprobado||v.a.warning("La solicitud de ese d\xeda todav\xeda se encuentra pendiente de aprobaci\xf3n"):a.setState({dia:e,modalPedirDia:!0})}else v.a.warning("No puedes solicitar un d\xeda festivo");else v.a.warning("No puedes solicitar un d\xeda pasado")},a.calcularVacaciones=function(){var e=a.props.auth,t=365+(Q()().isLeapYear()?1:0),r=e.iniciocontrato?Q()().diff(Q()(e.iniciocontrato),"days"):void 0,n=a.props.auth.correccion&&a.props.auth.correccion.length>0?a.props.auth.correccion.find(function(e){return parseInt(e.ano,10)===Q()().year()}):{correccion:0},o=r?r<=t?Math.trunc(r/t*23)+(parseInt(n.correccion,10)||0):23+(parseInt(n.correccion,10)||0):" - ",s=a.props.auth.dias?a.props.auth.dias.filter(function(e){return"libre"===e.tipo&&e.aprobado&&Q()(e.fecha).isAfter(Q()())}).length:"",i=a.props.auth.dias?a.props.auth.dias.filter(function(e){return"libre"===e.tipo&&e.aprobado&&Q()(e.fecha).isBetween(Q()().startOf("year"),Q()(),"days","[]")}).length:"",c=a.props.auth.dias?a.props.auth.dias.filter(function(e){return"libre"===e.tipo&&!e.aprobado&&Q()(e.fecha).isAfter(Q()())}).length:"";a.setState({diasTotales:o,diasLibresFuturos:s,diasLibresPasados:i,diasLibresPendientes:c})},a}return Object(d.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=[{title:"Nombre de usuario",key:"user",render:function(e){return e.user&&e.user.username}},{title:"Tipo",dataIndex:"tipo",key:"tipo"},{title:"Fecha",key:"fecha",render:function(e){return Q()(e.fecha).format("YYYY-MM-DD")}},{title:"Acci\xf3n",key:"action",render:function(t,a){return n.a.createElement("span",null,n.a.createElement(We.a,{title:"\xbfEst\xe1s seguro de que deseas aceptar la solicitud de d\xeda ".concat(a.tipo," para el d\xeda ").concat(Q()(a.fecha).format("YYYY-MM-DD")," a ").concat(a.user&&a.user.username,"?"),onConfirm:function(t){return e.responderSolicitud(a,!0)}},n.a.createElement(x.a,{color:"green",key:"".concat(a._id,"_aceptar")},"Aprobar")),n.a.createElement(We.a,{title:"\xbfEst\xe1s seguro de que deseas denegar la solicitud de d\xeda ".concat(a.tipo," para el d\xeda ").concat(Q()(a.fecha).format("YYYY-MM-DD")," a ").concat(a.user&&a.user.username,"?"),onConfirm:function(t){return e.responderSolicitud(a,!1)}},n.a.createElement(x.a,{color:"volcano",key:"".concat(a._id,"_denegar")},"Denegar")))}}];this.setState({columns:t}),this.props.dias&&(this.organizarDias(),this.calcularVacaciones())}},{key:"componentDidUpdate",value:function(e,t){t.sel1!==this.state.sel1||t.sel2!==this.state.sel2?this.setState({diasFilter:this.filtrarDias(this.state.dias)}):e.dias!==this.props.dias&&(this.organizarDias(),this.calcularVacaciones())}},{key:"render",value:function(){var e=this;return n.a.createElement(y.a,{style:{height:"100vh"}},n.a.createElement(ve,{isLogged:!!M()},n.a.createElement(ke.a,{style:{justifyContent:"space-around",display:"flex",marginBottom:20}},n.a.createElement(Ve.a,{title:"D\xedas de vacaciones",value:this.state.diasTotales}),n.a.createElement(Ve.a,{title:"D\xedas de vacaciones disfrutados",value:this.state.diasLibresPasados}),n.a.createElement(Ve.a,{title:"D\xedas de vacaciones solicitados",value:this.state.diasLibresFuturos}),n.a.createElement(Ve.a,{title:"D\xedas de vacaciones pendientes de aprobar",value:this.state.diasLibresPendientes})),n.a.createElement(ke.a,{style:{justifyContent:"space-around",display:"flex"}},n.a.createElement(Ke.a.Group,{defaultValue:this.state.sel1,buttonStyle:"solid"},n.a.createElement(Ke.a.Button,{onClick:function(){return e.setState({sel1:"libres"})},value:"libres"},"Libres"),n.a.createElement(Ke.a.Button,{onClick:function(){return e.setState({sel1:"remotos"})},value:"remotos"},"Remotos")),n.a.createElement(Ke.a.Group,{defaultValue:this.state.sel2,buttonStyle:"solid"},n.a.createElement(Ke.a.Button,{onClick:function(){return e.setState({sel2:"global"})},value:"global"},"Global"),n.a.createElement(Ke.a.Button,{onClick:function(){return e.setState({sel2:"mios"})},value:"mios"},"Mis d\xedas"))),n.a.createElement(Ze.a,{dateFullCellRender:this.dateFullCellRender,style:{margin:"-1px 0"}}),n.a.createElement($e,{blue:this.props.blueCollar},n.a.createElement("h1",null,"D\xedas pendientes de revisi\xf3n"),n.a.createElement(Qe.a,{dataSource:this.state.diasPorAprobar,columns:this.state.columns||[]}))),n.a.createElement(C.a,{visible:this.state.modalPedirDia,onCancel:function(){return e.setState({modalPedirDia:!1})},footer:[n.a.createElement(D.a,{key:"libre",onClick:function(){return e.solicitarDia(e.state.dia,"libre")}},"D\xeda libre"),n.a.createElement(D.a,{key:"remoto",type:"primary",onClick:function(){return e.solicitarDia(e.state.dia,"remoto")}},"D\xeda remoto")]},n.a.createElement("p",null,"Solicitar el d\xeda ",Q()(this.state.dia).format("DD/MM/YYYY")," como... ")))}}]),t}(r.Component),et=Object(pe.b)(function(e){return{dias:e.dias,auth:e.auth,blueCollar:e.blueCollar}})(Xe),tt=E.a.Title,at='{\n    equipos(where: {nombre: "$nombre$"}){\n        _id\n    }\n}',rt=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).solicitarAcceso=function(e){e.preventDefault(),a.props.form.validateFields(function(e,t){fetch("https://we.blacknosaur.com"+I(at,{nombre:t.unirse}),{headers:P()}).then(function(e){console.log(e),e.json().then(function(e){console.log(e),e.data.equipos[0]?fetch("https://we.blacknosaur.com/users/"+L()._id,{method:"PUT",headers:P(),body:JSON.stringify({equipo:e.data.equipos[0]._id,confirmed:!1})}).then(function(e){console.log(e),e.ok&&v.a.info('Se ha solicitado con \xe9xito el acceso al equipo "'.concat(t.unirse,'"'))}):v.a.error('No se ha encontrado ning\xfan equipo "'.concat(t.unirse,'"'))}).catch(function(e){return console.log(e)})}).catch(function(e){return console.log(e)})})},a.crearEquipo=function(e){e.preventDefault(),a.props.form.validateFields(function(e,t){fetch("https://we.blacknosaur.com/equipos",{method:"POST",headers:P(),body:JSON.stringify({nombre:t.crear,users:[L()._id]})}).then(function(e){e.json().then(function(e){fetch("https://we.blacknosaur.com/users/"+L()._id,{method:"PUT",headers:P(),body:JSON.stringify({confirmed:!0,manager:!0})}).then(function(){a.props.history.push("/")})}).catch(function(e){console.log(e),v.a.error("Se ha producido un error al asignar el usuario al equipo recien creado")})}).catch(function(e){console.log(e),v.a.error("Se ha producido un error al crear el equipo")})})},a.state={errorUser:!1,errorEmail:!1,errorPw:!1},a}return Object(d.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this,t=this.props.form,a=t.getFieldDecorator,r=t.getFieldError,o=t.isFieldTouched,s=o("unirse")&&r("unirse"),i=o("crear")&&r("crear");return n.a.createElement(y.a,{style:{height:"100vh"}},n.a.createElement(ve,{isLogged:!!M()},n.a.createElement(y.a.Content,{style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"}},n.a.createElement(Se.a,{onSubmit:this.handleSubmit},n.a.createElement(Ce.a,{style:{width:450,maxWidth:"90%",marginBottom:"1em"}},n.a.createElement(tt,{level:2},"Unirse a un equipo"),n.a.createElement(Se.a.Item,{validateStatus:s||this.state.errorUnirse?"error":"",help:s||""},a("unirse",{rules:[{required:!0,message:"Introduce el nombre del equipo"}]})(n.a.createElement(je.a,{onChange:function(t){return e.setState({pw:t.target.value})},prefix:n.a.createElement(O.a,{type:"team",style:{color:"rgba(0,0,0,.25)"}}),type:"text",placeholder:"Nombre del equipo al que te quieres unir"}))),n.a.createElement(Se.a.Item,null,n.a.createElement(ke.a,null,n.a.createElement(we.a,{style:{justifyContent:"center",display:"flex"}},n.a.createElement(D.a,{type:"primary",onClick:this.solicitarAcceso},"Solicitar acceso"))))),n.a.createElement(Ce.a,{style:{width:450,maxWidth:"90%"}},n.a.createElement(tt,{level:2},"Crear un equipo"),n.a.createElement(Se.a.Item,{validateStatus:i||this.state.errorCrear?"error":"",help:i||""},a("crear",{rules:[{required:!0,message:"Introduce el nombre del equipo"}]})(n.a.createElement(je.a,{onChange:function(t){return e.setState({pw:t.target.value})},prefix:n.a.createElement(O.a,{type:"usergroup-add",style:{color:"rgba(0,0,0,.25)"}}),type:"password",placeholder:"Nombre del equipo a crear"}))),n.a.createElement(Se.a.Item,null,n.a.createElement(ke.a,null,n.a.createElement(we.a,{style:{justifyContent:"center",display:"flex"}},n.a.createElement(D.a,{type:"primary",onClick:this.crearEquipo},"Crear equipo")))))))))}}]),t}(r.Component),nt=Se.a.create({name:"nuevousuario_form"})(rt),ot=a(855),st=a(163),it=a(857),ct=a(113),lt='{\nuser(id:"$userId$"){\n    documentos{\n        _id\n    }\n}}',ut=function(e){function t(){var e,a;Object(c.a)(this,t);for(var r=arguments.length,o=new Array(r),s=0;s<r;s++)o[s]=arguments[s];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).state={fileList:[],asociarA:[],userInfo:L(),selectedUser:{documentos:[]},disponibleParaTodos:!0,columns:[{title:"Nombre de usuario",dataIndex:"username",key:"username"},{title:"Email",dataIndex:"email",key:"email"}],misArchColumns:[{title:"Nombre de archivo",dataIndex:"name",key:"name"},{key:"archivo",render:function(e){return n.a.createElement("div",{key:e._id,style:{display:"flex",justifyContent:"flex-end"}},n.a.createElement("a",{href:"https://we.blacknosaur.com"+e.url,target:"_blank",rel:"noopener noreferrer"},n.a.createElement(x.a,{color:"geekblue",key:"".concat(e._id,"_file")},n.a.createElement(O.a,{type:"file-text"})," Enlace")),n.a.createElement(We.a,{title:"\xbfEst\xe1s seguro de que deseas desvincular ".concat(e.name," de ").concat(a.state.selectedUser.username,"?"),onConfirm:function(){return a.desvincularArchivo(e,a.state.selectedUser)}},n.a.createElement(x.a,{color:"orange",key:"".concat(e._id,"_file")},n.a.createElement(O.a,{type:"disconnect"})," Desvincular")),n.a.createElement(We.a,{title:"\xbfEst\xe1s seguro de que deseas borrar ".concat(e.name,"? Esto borrar\xe1 el archivo para todos los usuarios"),onConfirm:function(){return a.borrarArchivo(e)},icon:n.a.createElement(O.a,{type:"warning",style:{color:"red"}})},n.a.createElement(x.a,{color:"volcano",key:"".concat(e._id,"_file")},n.a.createElement(O.a,{type:"delete"})," Borrar")))}}],archGlobColumns:[{title:"Nombre de archivo",dataIndex:"name",key:"name"},{key:"archivo",render:function(e){return n.a.createElement("div",{key:e._id,style:{display:"flex",justifyContent:"flex-end"}},n.a.createElement("a",{href:"https://we.blacknosaur.com"+e.url,target:"_blank",rel:"noopener noreferrer"},n.a.createElement(x.a,{color:"geekblue",key:"".concat(e._id,"_file")},n.a.createElement(O.a,{type:"file-text"})," Enlace")),n.a.createElement(We.a,{title:"\xbfEst\xe1s seguro de que deseas borrar ".concat(e.name,"? Esto borrar\xe1 el archivo para todos los usuarios"),onConfirm:function(){return a.borrarArchivo(e)},icon:n.a.createElement(O.a,{type:"warning",style:{color:"red"}})},n.a.createElement(x.a,{color:"volcano",key:"".concat(e._id,"_file")},n.a.createElement(O.a,{type:"delete"})," Borrar")))}}],archUserColumns:[{title:"Nombre de archivo",dataIndex:"name",key:"name"},{key:"archivo",render:function(e){return n.a.createElement("div",{key:e._id,style:{display:"flex",justifyContent:"flex-end"}},n.a.createElement("a",{href:"https://we.blacknosaur.com"+e.url,target:"_blank",rel:"noopener noreferrer"},n.a.createElement(x.a,{color:"geekblue",key:"".concat(e._id,"_file")},n.a.createElement(O.a,{type:"file-text"})," Enlace")))}}]},a.rowSelection={onChange:function(e,t){a.setState({asociarA:t.map(function(e){return e._id})})},getCheckboxProps:function(e){return{disabled:"Disabled User"===e.name,name:e.name}}},a.desvincularArchivo=function(){var e=Object(b.a)(g.a.mark(function e(t,r){var n,o,s;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.state.selectedUser.documentos.find(function(e){return e.archivo._id===t._id})._id,e.next=3,K("/documentos/"+n);case 3:o=e.sent,s=o.users.filter(function(e){return e._id!==r._id}),K("/documentos/"+n,{method:"PUT",body:{users:s}}).then(function(e){v.a.info("El archivo se desvincul\xf3 correctamente"),a.props.dispatch(ne())}).catch(function(e){console.log(e),v.a.error("Se produjo un error durante la desvinculaci\xf3n del documento")});case 6:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}(),a.borrarArchivo=function(){var e=Object(b.a)(g.a.mark(function e(t){var r;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=a.props.documentos.find(function(e){return e.archivo._id===t._id})._id,K("/upload/files/"+t._id,{method:"DELETE"}).then(function(e){K("/documentos/"+r,{method:"DELETE"}).then(function(e){v.a.info("El archivo se borr\xf3 correctamente"),a.props.dispatch(ne())}).catch(function(e){console.log(e),v.a.error("Se produjo un error durante el borrado del documento")})}).catch(function(e){console.log(e),v.a.error("Se produjo un error durante el borrado del documento")});case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.handleUpload=Object(b.a)(g.a.mark(function e(){var t,r,n;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=a.state.fileList.map(function(){var e=Object(b.a)(g.a.mark(function e(t){var r,n;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(),e.next=3,K("/documentos",{method:"POST",body:{global:a.state.disponibleParaTodos}});case 3:return r=e.sent,(n=new FormData).append("ref","documento"),n.append("refId",r._id),n.append("field","archivo"),n.append("files",t),K("/upload",{method:"POST",headers:{Authorization:"Bearer "+M()},body:n},!1),e.abrupt("return",r._id);case 11:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),e.next=4,Promise.all(t);case 4:r=e.sent,console.log(r),0!==a.state.asociarA.length||a.state.disponibleParaTodos?a.state.disponibleParaTodos?(v.a.info("Los documentos se han subido correctamente"),a.props.dispatch(ne()),a.setState({mostrarListaUsuarios:!1,fileList:[]})):(n=a.state.asociarA.map(function(){var e=Object(b.a)(g.a.mark(function e(t){var a;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,K(I(lt,{userId:t}));case 2:return a=e.sent.data.user.documentos,e.abrupt("return",K("/users/"+t,{method:"PUT",body:{documentos:[].concat(Object(ze.a)(a),Object(ze.a)(r))}}));case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),Promise.all(n).then(function(){v.a.info("Los documentos se han subido correctamente"),a.props.dispatch(ne()),a.setState({mostrarListaUsuarios:!1,fileList:[]})})):v.a.error("El documento no est\xe1 asociado a ning\xfan usuario"),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(0),console.log(e.t0),v.a.error("Ocurri\xf3 un error durante la subida de documentos");case 13:case"end":return e.stop()}},e,null,[[0,9]])})),a}return Object(d.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){this.setState({selectedUser:this.props.usuarios.find(function(e){return e.username===L().username})})}},{key:"componentDidUpdate",value:function(e){e.usuarios!==this.props.usuarios&&this.setState({selectedUser:this.props.usuarios.find(function(e){return e.username===L().username})})}},{key:"render",value:function(){var e=this;return n.a.createElement(y.a,{style:{height:"100vh"}},n.a.createElement(ve,{isLogged:!!M()},n.a.createElement("h1",null,"Documentos"),this.state.userInfo.manager&&!this.props.blueCollar&&[n.a.createElement("div",{key:"sa",style:{marginBottom:50}},n.a.createElement("h2",null,"Subir archivo"),n.a.createElement("div",{style:{width:"320px",marginBottom:20}},n.a.createElement(ot.a.Dragger,{name:"file",action:"https://we.blacknosaur.com/upload",multiple:!0,onChange:function(t){var a=t.file.status;"uploading"!==a&&0===t.fileList.length&&e.setState({mostrarListaUsuarios:!1}),"done"===a?v.a.success("".concat(t.file.name," se ha subido correctamente.")):"error"===a&&v.a.error("La subida de ".concat(t.file.name," fall\xf3."))},beforeUpload:function(t,a){return e.setState({fileList:a,mostrarListaUsuarios:!0}),!1},fileList:this.state.fileList,onRemove:function(t){var a=e.state.fileList.filter(function(e){return e.uid!==t.uid});e.setState({fileList:a,mostrarListaUsuarios:a.length>0})}},n.a.createElement(O.a,{type:"inbox"}),n.a.createElement("p",null,"Arrastra documentos aqu\xed"))),this.state.mostrarListaUsuarios&&n.a.createElement("div",{style:{display:"flex",flexDirection:"column"}},n.a.createElement(st.a,{style:{marginBottom:20},checked:this.state.disponibleParaTodos,onChange:function(t){return e.setState({disponibleParaTodos:t.target.checked})}},"Disponible para todos los usuarios"),n.a.createElement(it.a,{className:"sinCabecera",bordered:!1,activeKey:this.state.disponibleParaTodos?"0":"1"},n.a.createElement(it.a.Panel,{key:"1"},n.a.createElement("h3",{key:"asociarTitle"},"Asociar archivo a:"),n.a.createElement(Qe.a,{key:"asociarTabla",rowSelection:this.rowSelection,dataSource:this.props.usuarios,columns:this.state.columns}))),n.a.createElement("div",null,n.a.createElement(D.a,{onClick:this.handleUpload},"Subir documentos")))),n.a.createElement("div",{key:"apu"},n.a.createElement("h2",null,"Archivos por usuario"),n.a.createElement(ct.a,{showSearch:!0,style:{width:200,marginBottom:20},placeholder:"Selecciona un usuario",defaultValue:L().username,optionFilterProp:"children",onChange:function(t){var a=e.props.usuarios.find(function(e){return e.username===t});e.setState({selectedUser:a})},filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},this.props.usuarios.map(function(e){return n.a.createElement(ct.a.Option,{value:e.username,key:e._id},e.username)})),this.state.selectedUser&&n.a.createElement(Qe.a,{dataSource:this.props.documentos.filter(function(t){return t.users.map(function(e){return e._id}).includes(e.state.selectedUser._id)}).map(function(e){return e.archivo}),columns:this.state.misArchColumns,rowKey:"_id"}),n.a.createElement("h2",{style:{marginTop:20}},"Archivos globales"),n.a.createElement(Qe.a,{dataSource:this.props.documentos.filter(function(e){return e.global}).map(function(e){return e.archivo}),columns:this.state.archGlobColumns,rowKey:"_id"}))],(!this.state.userInfo.manager||this.props.blueCollar)&&n.a.createElement("div",null,n.a.createElement("h2",null,"Mis archivos"),n.a.createElement(Qe.a,{dataSource:this.props.documentos.filter(function(t){return e.state.userInfo.documentos.includes(t._id)||t.global}).map(function(e){return e.archivo}),columns:this.state.archUserColumns,rowKey:"_id"}))))}}]),t}(r.Component),dt=Object(pe.b)(function(e){return{usuarios:e.usuarios,documentos:e.documentos,blueCollar:e.blueCollar}})(ut),pt=function(e){function t(){var e,a;Object(c.a)(this,t);for(var r=arguments.length,o=new Array(r),s=0;s<r;s++)o[s]=arguments[s];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).state={columns:[],extraColumnsA:[],extraColumnsA2:[],extraColumnsB:[]},a.cargaColumnas=function(){var e=L().manager&&!a.props.blueCollar?[{title:"Manager",dataIndex:"manager",render:function(e){return e?n.a.createElement(O.a,Object(Ye.a)({type:"check-circle",theme:"twoTone",twoToneColor:"#eb2f96"},"twoToneColor","#52c41a")):n.a.createElement(O.a,{type:"close-circle",theme:"twoTone",twoToneColor:"#eb2f96"})}},{title:"ID Tarjeta",key:"idcard",render:function(e,t){return t.idcard?n.a.createElement("div",null,n.a.createElement("span",null,t.idcard,"\xa0\xa0"),n.a.createElement(We.a,{title:"\xbfEst\xe1s seguro de que deseas desasociar la tarjeta de ".concat(t.email,"?"),onConfirm:function(e){return a.desasociarTarjeta(t)}},n.a.createElement(x.a,{color:"volcano",key:"".concat(t._id,"_denegar")},n.a.createElement(O.a,{type:"delete"})))):n.a.createElement(D.a,{type:"primary",onClick:function(){return a.setState({modalAsociar:!0,usuarioAsociar:t._id})}},"Asociar tarjeta")}}]:[],t=[{key:"btn",render:function(e,t){return n.a.createElement(A.a,{to:"/usuario/"+t._id},n.a.createElement(x.a,{key:"".concat(t._id,"_denegar")},n.a.createElement(O.a,{type:"user"})," Editar"))}}],r=[{title:"Acci\xf3n",key:"action",render:function(e,t){return n.a.createElement("span",null,n.a.createElement(We.a,{title:"\xbfEst\xe1s seguro de que deseas aceptar en ".concat(t.equipo&&t.equipo.nombre," a ").concat(t.email,"?"),onConfirm:function(e){return a.responderSolicitud(t,!0)}},n.a.createElement(x.a,{color:"green",key:"".concat(t._id,"_aceptar")},"Aceptar")),n.a.createElement(We.a,{title:"\xbfEst\xe1s seguro de que deseas denegar la solicitud de ".concat(t.email," para entrar en ").concat(t.equipo&&t.equipo.nombre,"?"),onConfirm:function(e){return a.responderSolicitud(t,!1)}},n.a.createElement(x.a,{color:"volcano",key:"".concat(t._id,"_denegar")},"Denegar")))}}];a.setState({columns:[{title:"Nombre de usuario",dataIndex:"username",key:"username"},{title:"Email",dataIndex:"email",key:"email"}],extraColumnsA:e,extraColumnsA2:t,extraColumnsB:r})},a.filtraUsuarios=function(e){var t=a.props.usuarios.filter(function(e){return e.confirmed}).map(function(e){return Object(He.a)({},e,{key:e._id})}),r=a.props.usuarios.filter(function(e){return!e.confirmed}).map(function(e){return Object(He.a)({},e,{key:e._id})});a.setState({activos:t,pendientes:r})},a.fetchUsers=Object(b.a)(g.a.mark(function e(){return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.props.dispatch(ee());case 2:a.filtraUsuarios(a.props.usuarios);case 3:case"end":return e.stop()}},e)})),a.responderSolicitud=function(e,t){t?K("/users/"+e._id,{method:"PUT",body:{confirmed:!0}}).then(function(t){v.a.success("\xa1".concat(e.email," ahora forma parte del equipo ").concat(e.equipo.nombre,"!")),a.fetchUsers()}).catch(function(e){console.error(e),v.a.error("Se ha producido un error durante la confirmaci\xf3n de la solicitud del usuario")}):K("/users/"+e._id,{method:"DELETE"}).then(function(e){v.a.info("La solicitud se ha denegado correctamente"),a.fetchUsers()}).catch(function(e){v.a.error("Se ha producido un error durante la denegaci\xf3n de la solicitud del usuario"),console.error(e)})},a.desasociarTarjeta=function(e){console.log(e),K("/users/"+e._id,{method:"PUT",body:{idcard:""}}).then(function(){return a.fetchUsers()})},a}return Object(d.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){this.cargaColumnas(),this.props.usuarios&&this.filtraUsuarios(this.props.usuarios)}},{key:"componentDidUpdate",value:function(e,t){var a=this;e.usuarios!==this.props.usuarios?this.filtraUsuarios(this.props.usuarios):t.modalAsociar!==this.state.modalAsociar?this.state.modalAsociar?this.props.socket.on("notification",function(e){console.log(e),a.props.usuarios.map(function(e){return e.idcard}).includes(e.es)?v.a.error("Esa tarjeta ya est\xe1 asociada a un usuario. Desasociela antes de reasignarla."):K("/users/"+a.state.usuarioAsociar,{method:"PUT",body:{idcard:e.es&&e.es.idcard}}).then(function(e){v.a.info("La tarjeta ha sido asociada correctamente"),a.fetchUsers(),a.setState({modalAsociar:!1,usuarioAsociar:void 0})}).catch(function(e){v.a.error("Se produjo un error durante el proceso de asociaci\xf3n de la tarjeta"),console.log(e),a.setState({modalAsociar:!1,usuarioAsociar:void 0})})}):this.props.socket.off("notification"):e.blueCollar!==this.props.blueCollar&&this.cargaColumnas()}},{key:"render",value:function(){var e=this,t=this.state,a=t.activos,r=t.pendientes,o=t.columns,s=t.extraColumnsA,i=t.extraColumnsA2,c=t.extraColumnsB;return n.a.createElement(y.a,{style:{height:"100vh"}},n.a.createElement(ve,{isLogged:!!M()},n.a.createElement("h1",null,"Usuarios activos"),n.a.createElement(Qe.a,{dataSource:a,columns:[].concat(Object(ze.a)(o),Object(ze.a)(s),Object(ze.a)(i))}),L().manager&&!this.props.blueCollar&&[n.a.createElement("h1",{key:"pendAprobTitle"},"Usuarios pendientes de aprobaci\xf3n"),n.a.createElement(Qe.a,{key:"pendAprobTable",dataSource:r,columns:[].concat(Object(ze.a)(o),Object(ze.a)(c))})]),n.a.createElement(C.a,{visible:this.state.modalAsociar,onOk:function(e){return e},onCancel:function(){return e.setState({modalAsociar:!1,usuarioAsociar:void 0})},footer:[n.a.createElement(D.a,{key:"back",type:"primary",onClick:function(){return e.setState({modalAsociar:!1,usuarioAsociar:void 0})}},"Cancelar")]},n.a.createElement("p",null,"Acerca la tarjeta al lector sin cerrar esta ventana para asociarla al usuario")))}}]),t}(r.Component),mt=Object(de.socketConnect)(Object(pe.b)(function(e){return{usuarios:e.usuarios,blueCollar:e.blueCollar}})(pt)),ft=a(853),ht=a(848),gt=a(849),bt=function(e){function t(){var e,a;Object(c.a)(this,t);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={usuario:{},duracionjornada:"",frasesStr:"",frases:[],frasePr:"",frasePrAct:!1,manager:void 0,inicioContrato:Q()(),correccion:[]},a.guardarFrases=function(){K("/users/"+a.state.usuario._id,{method:"PUT",body:{frases:a.state.frases.filter(function(e){return![void 0,null,""].includes(e)}),frasePrioritaria:a.state.frasePr,actFrasePrioritaria:a.state.frasePrAct}}).then(function(e){v.a.success("Los cambios se guardaron correctamente"),a.props.dispatch(ee())}).catch(function(e){console.log(e),v.a.error("Se produjo un error durante el guardado")})},a.guardarDatosSerios=function(){a.state.duracionjornada>0&&a.state.duracionjornada<24?K("/users/"+a.state.usuario._id,{method:"PUT",body:{manager:a.state.manager,duracionjornada:a.state.duracionjornada,iniciocontrato:a.state.inicioContrato?a.state.inicioContrato.utc().format():void 0,finalcontrato:a.state.finalContrato?a.state.finalContrato.utc().format():void 0,indefinido:a.state.indefinido,tipocontrato:a.state.tipocontrato,correccion:a.state.correccion.filter(function(e){return void 0!==e.ano&&void 0!==e.correccion})}}).then(function(e){v.a.success("Los cambios se guardaron correctamente"),a.props.dispatch(re()),a.props.dispatch(ee()),a.props.dispatch(te())}).catch(function(e){console.log(e),v.a.error("Se produjo un error durante el guardado")}):v.a.error("La duraci\xf3n media de la jornada ha de estar entre 0 y 24")},a.handleCorreccion=function(e,t,r){var n=Object(ze.a)(a.state.correccion);n[t][r]=e,a.setState({correccion:n})},a}return Object(d.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){var e=this;if(this.props.usuarios.length>0){var t=this.props.usuarios.find(function(t){return t._id===e.props.match.params.id});console.log(t),this.setState({duracionjornada:t.duracionjornada,frasesStr:t.frases.reduce(function(e,t){return e+t+"\n"},""),frases:t.frases,frasePr:t.frasePrioritaria,frasePrAct:t.actFrasePrioritaria,correccion:t.correccion||[],tipocontrato:t.tipocontrato,inicioContrato:t.iniciocontrato?Q()(t.iniciocontrato):null,finalContrato:t.finalcontrato?Q()(t.finalcontrato):null,indefinido:t.indefinido,manager:t.manager,usuario:t})}}},{key:"componentDidUpdate",value:function(e,t){var a=this;if(this.props.usuarios&&this.props.usuarios!==e.usuarios){var r=this.props.usuarios.find(function(e){return e._id===a.props.match.params.id});console.log(r),this.setState({duracionjornada:r.duracionjornada,frasesStr:r.frases.reduce(function(e,t){return e+t+"\n"},""),frases:r.frases,frasePr:r.frasePrioritaria,frasePrAct:r.actFrasePrioritaria,correccion:r.correccion||[],tipocontrato:r.tipocontrato,inicioContrato:r.iniciocontrato?Q()(r.iniciocontrato):null,finalContrato:r.finalcontrato?Q()(r.finalcontrato):null,indefinido:r.indefinido,manager:r.manager,usuario:r})}else this.state.frasesStr!==t.frasesStr&&this.setState({frases:this.state.frasesStr.split(/\n/gm)})}},{key:"render",value:function(){var e=this,t=this.state,a=t.usuario,r=t.correccion;return n.a.createElement(y.a,{style:{height:"100vh"}},n.a.createElement(ve,{isLogged:!!M()},n.a.createElement("h1",null,a.username),n.a.createElement($e,{blue:this.props.blueCollar},n.a.createElement(Se.a.Item,{key:"editUserJornada",label:"Duraci\xf3n media de su jornada laboral"},n.a.createElement(je.a,{type:"number",value:this.state.duracionjornada,onChange:function(t){return e.setState({duracionjornada:t.target.value})}})),n.a.createElement(Se.a.Item,{key:"tipoContrato",label:"Tipo de contrato"},n.a.createElement(ct.a,{value:this.state.tipocontrato,onChange:function(t){return e.setState({tipocontrato:t})},style:{width:300}},n.a.createElement(ct.a.Option,{value:"contratado"},"Contratado"),n.a.createElement(ct.a.Option,{value:"practicas"},"Pr\xe1cticas"))),n.a.createElement(Se.a.Item,{key:"inicioContrato",label:"Fecha de inicio de contrato"},n.a.createElement(ft.a,{value:this.state.inicioContrato,onChange:function(t){return e.setState({inicioContrato:t})}})),n.a.createElement(Se.a.Item,{key:"finalContrato",label:"Fecha de final de contrato"},!this.state.indefinido&&n.a.createElement("div",null,n.a.createElement(ft.a,{value:this.state.finalContrato,onChange:function(t){return e.setState({finalContrato:t})}}),n.a.createElement("br",null)),n.a.createElement("span",null,"Indefinido\xa0",n.a.createElement(ht.a,{checked:this.state.indefinido,onChange:function(t){return e.setState({indefinido:t})}}))),n.a.createElement(Se.a.Item,{key:"compensacionDias",label:"Correcci\xf3n de d\xedas de vacaciones"},r.map(function(t,a){return n.a.createElement("div",{style:{display:"flex"}},n.a.createElement(je.a,{type:"number",placeholder:"A\xf1o",style:{marginRight:20},value:e.state.correccion[a].ano,onChange:function(t){return e.handleCorreccion(t.target.value,a,"ano")}}),n.a.createElement(je.a,{type:"number",placeholder:"Correcci\xf3n",style:{marginRight:20},value:e.state.correccion[a].correccion,onChange:function(t){return e.handleCorreccion(t.target.value,a,"correccion")}}),n.a.createElement("div",{style:{display:"flex",alignItems:"center"}},n.a.createElement(x.a,{color:"volcano",onClick:function(){return e.setState({correccion:r.filter(function(e,t){return t!==a})})}},n.a.createElement(O.a,{type:"delete"}))))}),n.a.createElement(D.a,{onClick:function(){return e.setState({correccion:[].concat(Object(ze.a)(e.state.correccion),[{}])})}},"A\xf1adir a\xf1o")),n.a.createElement(Se.a.Item,{key:"editUserManager",label:"Manager"},n.a.createElement(Ke.a.Group,{value:this.state.manager},n.a.createElement(Ke.a.Button,{value:!0,onClick:function(){return e.setState({manager:!0})}},"S\xed"),n.a.createElement(Ke.a.Button,{value:!1,onClick:function(){return e.setState({manager:!1})}},"No"))),n.a.createElement(D.a,{onClick:this.guardarDatosSerios},"Guardar datos del usuario"),n.a.createElement(gt.a,null)),n.a.createElement(Se.a.Item,{label:"Frases (una por l\xednea)"},n.a.createElement(je.a.TextArea,{rows:6,value:this.state.frasesStr,onChange:function(t){return e.setState({frasesStr:t.target.value})}})),n.a.createElement(Se.a.Item,{label:"Frase prioritaria"},n.a.createElement(je.a,{type:"text",value:this.state.frasePr,onChange:function(t){return e.setState({frasePr:t.target.value})}}),n.a.createElement(Ke.a.Group,{value:this.state.frasePrAct},n.a.createElement(Ke.a.Button,{value:!0,onClick:function(){return e.setState({frasePrAct:!0})}},"Activada"),n.a.createElement(Ke.a.Button,{value:!1,onClick:function(){return e.setState({frasePrAct:!1})}},"Desactivada"))),n.a.createElement(D.a,{onClick:this.guardarFrases},"Guardar frases")))}}]),t}(r.Component),yt=Object(pe.b)(function(e){return{usuarios:e.usuarios,blueCollar:e.blueCollar}})(bt),Et=function(e){function t(){return Object(c.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return n.a.createElement(y.a,{style:{height:"100vh"}},n.a.createElement(ve,{isLogged:!!M()},n.a.createElement("h1",null,"Analitica")))}}]),t}(r.Component),vt=a(462),Ct=a(463),St=function(e){function t(){var e,a;Object(c.a)(this,t);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).addRegistro=Object(b.a)(g.a.mark(function e(){var t,r,n,o,s,i,c,l;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.props.usuario||a.state.selectedUser._id||void 0,[a.state.fechaNuevoRegistro,a.state.horaEntradaNuevoRegistro,a.state.horaSalidaNuevoRegistro,t].includes(void 0)){e.next=33;break}if(r=a.state.fechaNuevoRegistro.clone().hour(a.state.horaEntradaNuevoRegistro.hour()).minute(a.state.horaEntradaNuevoRegistro.minute()),n=a.state.fechaNuevoRegistro.clone().hour(a.state.horaSalidaNuevoRegistro.hour()).minute(a.state.horaSalidaNuevoRegistro.minute()),o=r.isBefore(Q()()),s=n.isBefore(Q()()),i=r.isBefore(n),!(o&&s&&i)){e.next=28;break}return c={user:t,fecha:Q.a.utc(r).format(),ultimoEditor:L()._id,aprobado:!!L().manager},l={user:t,fecha:Q.a.utc(n).format(),ultimoEditor:L()._id,aprobado:!!L().manager},e.prev=10,e.next=13,K("/registros",{method:"POST",body:c});case 13:return e.sent,e.next=16,K("/registros",{method:"POST",body:l});case 16:e.sent,!0===L().manager?v.a.success("El registro se a\xf1adi\xf3 correctamente"):v.a.success("El registro se a\xf1adi\xf3 correctamente, actualmente est\xe1 pendiente de aprobaci\xf3n"),a.props.cerrarModal&&a.props.cerrarModal(),a.setState({fechaNuevoRegistro:void 0,horaEntradaNuevoRegistro:void 0,horaSalidaNuevoRegistro:void 0}),e.next=26;break;case 22:e.prev=22,e.t0=e.catch(10),console.log(e.t0),v.a.error("Se produjo un error durante el guardado del registro");case 26:e.next=31;break;case 28:o||v.a.error("La hora de entrada es inv\xe1lida"),s||v.a.error("La hora de salida es inv\xe1lida"),i||v.a.error("La hora de entrada ha de ser anterior a la de salida");case 31:e.next=34;break;case 33:v.a.warning("Faltan campos por completar");case 34:case"end":return e.stop()}},e,null,[[10,22]])})),a}return Object(d.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this,t=ct.a.Option;return n.a.createElement("div",null,n.a.createElement("div",{style:{display:"flex",justifyContent:"space-between",flexWrap:"wrap"}},!this.props.usuario&&n.a.createElement(Se.a.Item,{label:"Usuario"},n.a.createElement(ct.a,Object(Ye.a)({showSearch:!0,style:{width:200,marginBottom:20},placeholder:"Selecciona un usuario",optionFilterProp:"children",onChange:function(t){var a=e.props.usuarios.find(function(e){return e.username===t});e.setState({selectedUser:a})},filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},"style",{width:250}),this.props.usuarios.map(function(e){return n.a.createElement(t,{value:e.username,key:e._id},e.username)}))),n.a.createElement(Se.a.Item,{label:"Fecha"},n.a.createElement(ft.a,{onChange:function(t){return e.setState({fechaNuevoRegistro:t})},style:{width:250}})),n.a.createElement(Se.a.Item,{label:"Hora de entrada"},n.a.createElement(Ct.a,{onChange:function(t){return e.setState({horaEntradaNuevoRegistro:t})},style:{width:250}})),n.a.createElement(Se.a.Item,{label:"Hora de salida"},n.a.createElement(Ct.a,{onChange:function(t){return e.setState({horaSalidaNuevoRegistro:t})},style:{width:250}}))),n.a.createElement(D.a,{onClick:this.addRegistro},"A\xf1adir registro"))}}]),t}(r.Component),jt=Object(pe.b)(function(e){return{usuarios:e.usuarios}})(St),kt=function(e){function t(){var e,a;Object(c.a)(this,t);for(var r=arguments.length,o=new Array(r),s=0;s<r;s++)o[s]=arguments[s];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).state={datos:{},datosMod:{},modificado:!1,nuevosRegistros:[],hora:Q()(),columns:[],extraColumns:[]},a.cargaColumnas=function(){var e=[{key:"a",title:"Hora",render:function(e){return Q()(e.fecha).format("HH:mm")}},{key:"b",title:"Evento",render:function(e,t,r){return 0===r?"Entrada":r%2?r===a.state.datosMod.registros.length-1?"Salida":"Comienzo de descanso":"Final de descanso"}}],t=a.props.colAprobado?[{key:"c",title:"Aprobado",render:function(e){return e.aprobado?n.a.createElement(O.a,Object(Ye.a)({type:"check-circle",theme:"twoTone",twoToneColor:"#eb2f96"},"twoToneColor","#52c41a")):L().manager&&!a.props.blueCollar?n.a.createElement("span",null,n.a.createElement(We.a,{title:"\xbfEst\xe1s seguro de que deseas aprobar la jornada?",onConfirm:function(){return a.jornadaPendiente(!0,e)}},n.a.createElement(x.a,{color:"green",key:"".concat(e._id,"_aceptar")},"Aceptar")),n.a.createElement(We.a,{title:"\xbfEst\xe1s seguro de que deseas denegar jornada?",onConfirm:function(){return a.jornadaPendiente(!1,e)}},n.a.createElement(x.a,{color:"volcano",key:"".concat(e._id,"_denegar")},"Denegar"))):n.a.createElement(O.a,{type:"close-circle",theme:"twoTone",twoToneColor:"#eb2f96"})}}]:[];a.setState({columns:e,extraColumns:t})},a.addRegistro=function(){var e=a.state.hora.date(Q()(a.state.datos.entrada).date()).month(Q()(a.state.datos.entrada).month()).year(Q()(a.state.datos.entrada).year());if(e.isSameOrBefore(Q()())){var t=[].concat(Object(ze.a)(a.state.datosMod.registros),[{fecha:e.utc().format()}]).sort(function(e,t){return Q()(e.fecha).isBefore(Q()(t.fecha))?-1:Q()(e.fecha).isAfter(Q()(t.fecha))?1:0});a.setState({modificado:!0,datosMod:Object(He.a)({},a.state.datosMod,{registros:t}),nuevosRegistros:[].concat(Object(ze.a)(a.state.nuevosRegistros),[{fecha:a.state.hora.utc().format(),user:a.state.datos.registros[0].user._id,ultimoEditor:L()._id,aprobado:!!L().manager}])})}else v.a.warning("No se pueden a\xf1adir registros por adelantado")},a.guardarNuevosRegistros=function(){var e=a.state.nuevosRegistros.length,t=a.state.nuevosRegistros;C.a.confirm({title:"Por razones legales no es posible editar ni borrar registros. \xbfEst\xe1s seguro de que quieres a\xf1adir ".concat(e>1?e:"un"," nuevo").concat(e>1?"s":""," registro").concat(e>1?"s":"","?"),onOk:function(){var e=Object(b.a)(g.a.mark(function e(){var r,n;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.map(function(e){return fetch("https://we.blacknosaur.com/registros",{method:"POST",headers:{Authorization:"Bearer "+M(),Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e)}).catch(function(e){return e})}),e.next=3,Promise.all(r);case 3:e.t0=function(e){return e.status},(n=e.sent.map(e.t0)).some(function(e){return e>=400})?(v.a.error("Se ha producido un error durante el guardado de los registros"),console.log(n)):(v.a.success("Los nuevos registros se a\xf1adieron correctamente"),a.setState({modificado:!1,nuevosRegistros:[]}),C.a.destroyAll());case 6:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()})},a.jornadaPendiente=function(e,t){!0===e?K("/registros/"+t._id,{method:"PUT",body:{aprobado:!0}}).then(function(e){v.a.success("Se ha aprobado el registro correctamente"),a.props.dispatch(re()),a.setState({datosMod:Object(He.a)({},a.state.datosMod,{registros:a.state.datosMod.registros.map(function(e){return e._id===t._id?Object(He.a)({},e,{aprobado:!0}):e})})})}).catch(function(e){console.log(e),v.a.error("Ha ocurrido un error durante la aprobaci\xf3n del registro")}):K("/registros/"+t._id,{method:"DELETE"}).then(function(e){v.a.success("Se ha denegado el registro correctamente"),a.props.dispatch(re()),a.setState({datosMod:Object(He.a)({},a.state.datosMod,{registros:a.state.datosMod.registros.filter(function(e){return e._id!==t._id})})})}).catch(function(e){console.log(e),v.a.error("Ha ocurrido un error durante la denegaci\xf3n del registro")})},a}return Object(d.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){this.cargaColumnas()}},{key:"componentDidUpdate",value:function(e){e.datos!==this.props.datos&&this.props.datos&&(this.setState({datos:this.props.datos,datosMod:this.props.datos}),this.cargaColumnas())}},{key:"render",value:function(){var e=this,t=this.state,a=t.datos,r=t.datosMod;return n.a.createElement(C.a,{visible:this.props.visible,footer:null,onCancel:function(){e.state.modificado?C.a.confirm({title:"Los registros no han sido guardados. \xbfSeguro que desea salir?",onOk:function(){e.setState({datosMod:e.state.datos,modificado:!1,nuevosRegistros:[]}),e.props.cb()}}):e.props.cb()},width:"80vw"},n.a.createElement("h2",null,a.usuario+" - "+Q()(a.entrada).format("YYYY-MM-DD")),n.a.createElement("div",null,n.a.createElement(Qe.a,{dataSource:r.registros,rowKey:"_id",pagination:!1,style:{marginBottom:20},columns:[].concat(Object(ze.a)(this.state.columns),Object(ze.a)(this.state.extraColumns))})),n.a.createElement("div",{style:{marginBottom:20}},n.a.createElement(Ct.a,{placeholder:"Selecciona hora",value:this.state.hora.utcOffset(2),onChange:function(t){return e.setState({hora:t})},style:{marginRight:20}}),n.a.createElement(D.a,{onClick:this.addRegistro},"A\xf1adir registro")),this.state.modificado&&n.a.createElement("div",null,n.a.createElement(D.a,{type:"danger",style:{marginRight:20},onClick:function(){return e.setState({datosMod:e.state.datos,modificado:!1,nuevosRegistros:[]})}},"Restablecer"),n.a.createElement(D.a,{type:"primary",onClick:function(){return e.guardarNuevosRegistros()}},"Guardar")))}}]),t}(r.Component),wt=Object(pe.b)()(kt),Ot=function(e){function t(){var e,a;Object(c.a)(this,t);for(var r=arguments.length,o=new Array(r),s=0;s<r;s++)o[s]=arguments[s];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).state={usuarios:[],userInfo:L(),modalVisible:!1,modalLoading:!1},a.columns=[{title:"Entrada",dataIndex:"entrada",key:"entrada",defaultSortOrder:"descend",sorter:function(e,t){return Q()(e.entrada).diff(Q()(t.entrada))},render:function(e){return Q()(e).format("YYYY-MM-DD, HH:mm")}},{title:"Salida",dataIndex:"salida",key:"salida",sorter:function(e,t){return Q()(e.entrada).diff(Q()(t.entrada))},render:function(e){return"-"!==e?Q()(e).format("YYYY-MM-DD, HH:mm"):"-"}},{title:"Tiempo trabajado",dataIndex:"horas",key:"horas",sorter:function(e,t){return e.horas-t.horas},render:function(e){return"-"!==e?Math.trunc(e,10)+"h "+Math.round(e%1*60)+"m":"-"}},{title:"Tiempo de descanso",dataIndex:"tiempoDescanso",key:"tiempoDescanso",sorter:function(e,t){return e.tiempoDescanso-t.tiempoDescanso},render:function(e){return"-"!==e?Math.trunc(e,10)+"h "+Math.round(e%1*60)+"m":"-"}},{title:"",dataIndex:"detalles",key:"detalles",render:function(){return n.a.createElement(x.a,{color:"blue"},"Detalles")}}],a.diasLaborables=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Q()().month()+1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Q()().year(),n=a.props.dias.filter(function(e){return"festivo"===e.tipo&&Q()(e.fecha).month()===t}).length;return Array(Q()().month(t).year(r).daysInMonth()).fill(null).filter(function(e,a){return Q()().year(r).month(t).date(a+1).weekday()<=4}).length-a.props.dias.filter(function(a){return a.user&&a.user._id===e&&!0===a.aprobado&&"libre"===a.tipo&&Q()(a.fecha).month()===t}).length-n},a.procesaES=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Q()().month()+1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Q()().year(),r=Q()().month(e-1).year(t).daysInMonth();if(Array.isArray(a.props.es.users)){var n=a.props.es.users.map(function(n){var o=n.duracionjornada||8,s=a.diasLaborables(n._id,e,t),i=Array(r).fill(null).map(function(e,t){return Q()().subtract(t,"days").format("YYYY-MM-DD")}).map(function(e){return n.registros.filter(function(t){return Q()(t.fecha).isSame(Q()(e),"days")&&Q()(t.fecha).isSame(a.props.mesES,"month")}).sort(function(e,t){return Q()(e.fecha).isBefore(Q()(t.fecha))?-1:Q()(t.fecha).isBefore(Q()(e.fecha))?1:0})}).map(function(e,t){var r=Array(Math.ceil(e.length/2)).fill(null).map(function(a,r){var o=Q()(e[2*r].fecha),s=e[2*r+1]?Q()(e[2*r+1].fecha):void 0,i=s?Q.a.duration(s.diff(o)):o.isSame(Q()(),"day")?Q.a.duration(Q()().diff(o)):"-",c="-"!==i?Math.round(100*i.as("hours"))/100:"-";return{key:n._id+"-"+t+"-"+r,entrada:o.format(),aprobado:!(!e[2*r].aprobado||e[2*r+1]&&!e[2*r+1].aprobado),salida:s?s.format():"-",horas:c}}),o=Array(r.length>0?r.length-1:0).fill(null).map(function(e,t){var a=Q()(r[t].salida),n=Q()(r[t+1].entrada);return Math.round(100*Q.a.duration(n.diff(a)).as("hours"))/100}).reduce(function(e,t){return e+t},0),s=r.map(function(e){return e.horas});return r[0]?{key:r[0].key,entrada:r[0].entrada,salida:r.slice(-1)[0].salida,aprobado:!r.map(function(e){return e.aprobado}).includes(!1),horas:s.includes("-")?"-":s.reduce(function(e,t){return e+t},0),usuario:n.username,registros:e,empresa:{nombre:a.props.es.nombre,cif:a.props.es.cif,ccc:a.props.es.ccc},tiempoDescanso:o}:[]}),c=Math.round(100*i.filter(function(e){return e.aprobado}).map(function(e){return e.horas}).filter(function(e){return"-"!==e&&void 0!==e}).reduce(function(e,t){return e+t},0))/100,l=s*o,u=Math.round(c/(s*o)*1e4)/100,d=Math.round(100*(l-c))/100,p={nombre:a.props.es.razonSocial,cif:a.props.es.cif,ccc:a.props.es.ccc};return Object(He.a)({},n,{jornadas:i,horasTrabajadas:c,horasPendientes:d,porcentajeHoras:u,duracionJornada:o,diasLaborables:s,empresa:p})});a.setState({usuarios:n,jornadasPorAprobar:[].concat.apply([],n.filter(function(e){return e._id===L()._id||L().manager&&!a.props.blueCollar}).map(function(e){return e.jornadas})).filter(function(e){return!Array.isArray(e)&&!e.aprobado})})}},a.handleRowClick=function(e,t){a.setState({rowSelect:e,modalInfo:!0,modalInfoApr:t})},a}return Object(d.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){this.props.es&&this.procesaES(this.props.mesES.month(),this.props.mesES.year())}},{key:"componentDidUpdate",value:function(e,t){e.es!==this.props.es?this.procesaES(this.props.mesES.month(),this.props.mesES.year()):e.mesES.isSame(this.props.mesES,"month")||this.props.dispatch(re(this.props.mesES))}},{key:"render",value:function(){var e=this,t=this.state,a=t.modalVisible,r=(t.modalLoading,ft.a.MonthPicker);return n.a.createElement(y.a,{style:{height:"100vh"}},n.a.createElement(ve,{isLogged:!!M()},n.a.createElement("h1",null,"Jornadas"),n.a.createElement(r,{placeholder:"Seleccionar mes",value:this.props.mesES,onChange:function(t){e.props.dispatch(X(t))},style:{marginBottom:20}}),n.a.createElement("div",null,n.a.createElement("h3",null,"Jornadas pendientes de aprobaci\xf3n"),n.a.createElement(Qe.a,{style:{marginBottom:"1em"},dataSource:this.state.jornadasPorAprobar,locale:{emptyText:"No hay jornadas pendientes de aprobar"},onRow:function(t){return{onClick:function(){return e.handleRowClick(t,!0)}}},columns:[{title:"Usuario",dataIndex:"usuario",key:"usuario"},{title:"D\xeda",dataIndex:"entrada",key:"dia",render:function(e){return Q()(e).format("YYYY-MM-DD")}},{title:"Entrada",dataIndex:"entrada",key:"entrada",render:function(e){return Q()(e).format("HH:mm")}},{title:"Salida",dataIndex:"salida",key:"salida",render:function(e){return"Invalid date"===Q()(e).format("HH:mm")?" - ":Q()(e).format("HH:mm")}},{title:"Horas",dataIndex:"horas",key:"horas"},{title:"",dataIndex:"detalles",key:"detalles",render:function(){return n.a.createElement(x.a,{color:"blue"},"Detalles")}}]})),n.a.createElement(it.a,{defaultActiveKey:!L().manager||this.props.blueCollar?L()._id:void 0},this.state.usuarios&&this.state.usuarios.filter(function(t){return e.state.userInfo._id===t._id||e.state.userInfo.manager&&!e.props.blueCollar}).map(function(t,a){return[n.a.createElement(it.a.Panel,{header:n.a.createElement("div",{style:{display:"flex",justifyContent:"space-between",paddingRight:"10px"}},n.a.createElement("span",null,t.username),n.a.createElement("div",{style:{width:"200px"}},n.a.createElement(vt.a,{percent:t.porcentajeHoras}))),key:t._id},n.a.createElement("div",{style:{display:"flex",flexWrap:"wrap",justifyContent:"space-evenly"}},n.a.createElement(Ve.a,{title:"Horas trabajadas",value:Math.trunc(t.horasTrabajadas,10)+"h "+Math.round(t.horasTrabajadas%1*60)+"m"}),n.a.createElement(Ve.a,{title:"Horas ".concat(t.horasPendientes>=0?"pendientes":"extra"),valueStyle:{color:t.horasPendientes<0?"red":"inherit"},value:t.horasPendientes>0?Math.trunc(t.horasPendientes,10)+"h "+Math.round(t.horasPendientes%1*60)+"m":Math.trunc(-t.horasPendientes,10)+"h "+Math.round(-t.horasPendientes%1*60)+"m"}),n.a.createElement(Ve.a,{title:"D\xedas laborables de este mes",value:t.diasLaborables}),n.a.createElement(Ve.a,{title:"Duraci\xf3n de jornada",value:t.duracionJornada+"h"})),n.a.createElement("h3",{style:{marginTop:20}},"Desglose de jornadas"),n.a.createElement(Qe.a,{key:"table"+a,dataSource:[].concat.apply([],t.jornadas.filter(function(e){return e.aprobado})),columns:e.columns,onRow:function(t){return{onClick:function(){return e.handleRowClick(t,!1)}}}}),(e.state.userInfo._id===t._id||e.state.userInfo.manager&&!e.props.blueCollar)&&n.a.createElement("div",{style:{display:"flex",justifyContent:"center",marginTop:20}},n.a.createElement(D.a,{onClick:function(){return e.setState({modalVisible:!0,modalUser:t._id})}},"A\xf1adir jornada")))]}))),n.a.createElement(C.a,{visible:a,title:"A\xf1adir registro",onOk:this.handleNuevoRegistro,onCancel:function(){e.setState({modalVisible:!1})},style:{maxWidth:900},width:"90%",footer:null},n.a.createElement(jt,{usuario:this.state.modalUser,cerrarModal:function(){return e.setState({modalVisible:!1})}})),n.a.createElement(wt,{visible:this.state.modalInfo,colAprobado:this.state.modalInfoApr,cb:function(){return e.setState({modalInfo:!1})},datos:this.state.rowSelect,blueCollar:this.props.blueCollar}))}}]),t}(r.Component),xt=Object(de.socketConnect)(Object(pe.b)(function(e){return{es:e.es,mesES:e.mesES,dias:e.dias,blueCollar:e.blueCollar}})(Ot)),Dt=function(e){function t(){var e,a;Object(c.a)(this,t);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={loading:!1,nombre:L().nombre||""},a.handleUpload=function(e){e.onSuccess,e.onError;var t=e.file,r=new FormData,n="image/jpeg"===t.type||"image/png"===t.type;n||v.a.error("Solo se aceptan imagenes en formato JPG y PNG");var o=t.size/1024/1024<2;o||v.a.error("Las imagenes han de ser m\xe1s peque\xf1as de 2MB"),n&&o&&(r.append("files",t),r.append("field","avatar"),r.append("refId",L()._id),r.append("ref","user"),r.append("source","users-permissions"),a.setState({loading:!0}),K("/upload",{method:"POST",body:r},!1).then(function(e){console.log(e),a.setState({loading:!1}),v.a.success("El avatar se actualiz\xf3 correctamente.");var t=L();t.avatar=e[0],window.localStorage.setItem("user",JSON.stringify(t)),a.props.dispatch(te())}).catch(function(e){a.setState({loading:!1}),console.log(e),v.a.error("Ocurri\xf3 un error durante la subida del nuevo avatar")}))},a.handleSave=function(){K("/users/"+L()._id,{method:"PUT",body:{nombre:a.state.nombre}}).then(function(e){var t=L();t.nombre=a.state.nombre,window.localStorage.setItem("user",JSON.stringify(t)),a.props.dispatch(te()),v.a.success("Los datos se guardaron correctamente")}).catch(function(e){v.a.error("Ocurri\xf3 un error durante el guardado de datos"),console.log(e)})},a}return Object(d.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){console.log(this.props.auth)}},{key:"componentDidUpdate",value:function(){console.log(this.props.auth)}},{key:"render",value:function(){var e=this,t=n.a.createElement("div",null,n.a.createElement(O.a,{type:this.state.loading?"loading":"plus"}),n.a.createElement("div",{className:"ant-upload-text"},"Upload")),a=this.props.auth&&this.props.auth.avatar&&"https://we.blacknosaur.com"+this.props.auth.avatar.url;return n.a.createElement(y.a,{style:{height:"100vh"}},n.a.createElement(ve,{isLogged:!!M()},n.a.createElement("h1",null,"Perfil"),n.a.createElement("div",{style:{width:"320px",marginBottom:20}},n.a.createElement(Se.a.Item,{label:"Avatar",style:{marginRight:20}},n.a.createElement(ot.a,{name:"avatar",defaultFileList:[this.props.auth&&this.props.auth.avatar],listType:"picture-card",className:"avatar-uploader",showUploadList:!1,onChange:this.handleChange,customRequest:this.handleUpload},a?n.a.createElement("img",{src:a,style:{maxHeight:300,maxWidth:300,objectFit:"cover"},alt:"avatar"}):t)),n.a.createElement(Se.a.Item,{label:"Nombre",style:{marginRight:20}},n.a.createElement(je.a,{type:"text",value:this.state.nombre,onChange:function(t){return e.setState({nombre:t.target.value})}})),n.a.createElement(D.a,{onClick:this.handleSave},"Guardar"))))}}]),t}(r.Component),At=Object(pe.b)(function(e){return{auth:e.auth}})(Dt),_t={users:[]},It=function(e){function t(){var e,a;Object(c.a)(this,t);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={seleccionados:[],nombreNuevoGrupo:"",grupoEditar:_t},a.addSeleccionado=function(e,t){if(t){var r=a.props.usuarios.find(function(t){return t.username===e});a.setState({grupoEditar:Object(He.a)({},a.state.grupoEditar,{users:[].concat(Object(ze.a)(a.state.grupoEditar.users),[r])})})}else a.setState({seleccionados:Object(ze.a)(new Set([].concat(Object(ze.a)(a.state.seleccionados),[e])))})},a.removeSeleccionado=function(e,t){t?a.setState({grupoEditar:Object(He.a)({},a.state.grupoEditar,{users:a.state.grupoEditar.users.filter(function(t){return t._id!==e._id})})}):a.setState({seleccionados:a.state.seleccionados.filter(function(t){return e!==t})})},a.crearGrupo=function(){if(""===a.state.nombreNuevoGrupo)v.a.warning("Es necesario introducir un nombre para el grupo");else if(0===a.state.seleccionados.length)v.a.warning("No se han a\xf1adido usuarios al grupo");else{var e=a.state.seleccionados.map(function(e){return a.props.usuarios.find(function(t){return t.username===e})}).map(function(e){return e._id}),t=L().equipo;K("/grupos",{method:"POST",body:{nombre:a.state.nombreNuevoGrupo,users:e,equipo:t}}).then(function(e){console.log(e),v.a.success("El grupo se cre\xf3 correctamente"),a.props.dispatch(oe())}).catch(function(e){console.log(e),v.a.error("Se produjo un error durante la creaci\xf3n del grupo")})}},a.borrarGrupo=function(e){K("/grupos/"+e._id,{method:"DELETE"}).then(function(e){a.props.dispatch(oe()),v.a.success("El grupo se borr\xf3 correctamente")}).catch(function(e){console.log(e),v.a.error("Se produjo un error durante el borrado del grupo")})},a.editarGrupo=function(){var e=a.state.grupoEditar,t=e.nombre,r=e.users;K("/grupos/"+e._id,{method:"PUT",body:{nombre:t,users:r}}).then(function(e){a.props.dispatch(oe()),v.a.success("El grupo se edit\xf3 correctamente"),a.setState({modalEdicion:!1,grupoEditar:_t})}).catch(function(e){console.log(e),v.a.error("Se produjo un error durante la edici\xf3n del grupo")})},a}return Object(d.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this,t=it.a.Panel;return n.a.createElement(y.a,{style:{height:"100vh"}},n.a.createElement(ve,{isLogged:!!M()},n.a.createElement("h2",null,"Grupos"),n.a.createElement(Qe.a,{style:{paddingBottom:30},rowKey:"_id",dataSource:this.props.grupos,columns:[{title:"Grupo",dataIndex:"nombre",key:"nombre"},{title:"Usuarios",dataIndex:"users",render:function(e){return e.map(function(e){return n.a.createElement(x.a,{key:"u"+e._id},e.username)})}},{render:function(t){return n.a.createElement("div",{style:{display:"flex",margin:5}},n.a.createElement(x.a,{color:"blue",onClick:function(){return e.setState({modalEdicion:!0,grupoEditar:t})}},n.a.createElement(O.a,{type:"edit"})),n.a.createElement(We.a,{title:"\xbfSeguro que deseas borrar el equipo ".concat(t.nombre,"?"),onConfirm:function(){return e.borrarGrupo(t)},okText:"Aceptar",cancelText:"Cancelar"},n.a.createElement(x.a,{color:"volcano"},n.a.createElement(O.a,{type:"delete"}))))}}]}),n.a.createElement(it.a,null,n.a.createElement(t,{key:"nuevoGrupo",header:"Nuevo grupo de usuarios"},n.a.createElement(Se.a.Item,{label:"Nombre del grupo"},n.a.createElement(je.a,{type:"text",value:this.state.nombreNuevoGrupo,onChange:function(t){return e.setState({nombreNuevoGrupo:t.target.value})}})),n.a.createElement(Se.a.Item,{label:"Integrantes"},n.a.createElement(ct.a,{style:{width:"100%"},onChange:function(t){return e.addSeleccionado(t,!1)}},this.props.usuarios.map(function(e,t){return n.a.createElement(ct.a.Option,{key:"user"+t,value:e.username},e.username)}))),n.a.createElement("div",{style:{paddingBottom:30}},this.state.seleccionados.map(function(t,a){return n.a.createElement(x.a,{closable:!0,key:t,onClose:function(){return e.removeSeleccionado(t)}},t)})),n.a.createElement(D.a,{onClick:this.crearGrupo},"Crear nuevo grupo")))),n.a.createElement(C.a,{visible:this.state.modalEdicion,footer:null,onCancel:function(){return e.setState({modalEdicion:!1,grupoEditar:_t})}},n.a.createElement("h3",null,"Editar grupo"),n.a.createElement(Se.a.Item,{label:"Nombre del grupo"},n.a.createElement(je.a,{type:"text",value:this.state.grupoEditar.nombre,onChange:function(t){return e.setState({grupoEditar:Object(He.a)({},e.state.grupoEditar,{nombre:t.target.value})})}})),n.a.createElement(Se.a.Item,{label:"Integrantes"},n.a.createElement(ct.a,{style:{width:"100%"},onChange:function(t){return e.addSeleccionado(t,!0)}},this.props.usuarios.map(function(e,t){return n.a.createElement(ct.a.Option,{key:"user"+t,value:e.username},e.username)}))),n.a.createElement("div",{style:{paddingBottom:30}},this.state.grupoEditar.users.map(function(t,a){return n.a.createElement(x.a,{closable:!0,key:t._id,onClose:function(){return e.removeSeleccionado(t,!0)}},t.username)})),n.a.createElement("div",{style:{display:"flex",justifyContent:"flex-end"}},n.a.createElement(D.a,{style:{paddingLeft:20},onClick:this.editarGrupo},"Editar Grupo"),n.a.createElement(D.a,{type:"danger",onClick:function(){return e.setState({modalEdicion:!1,grupoEditar:_t})}},"Cancelar"))))}}]),t}(r.Component),Mt=Object(pe.b)(function(e){return{usuarios:e.usuarios,grupos:e.grupos}})(It),Pt=function(e){function t(){var e,a;Object(c.a)(this,t);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={editNombre:"",editCampos:[{"":""}],editGrupos:[],editUsuarios:[]},a.componentDidUpdate=function(e){e.pwSelect!==a.props.pwSelect&&a.props.pwSelect&&(console.log(a.props.pwSelect),a.setState({editNombre:a.props.pwSelect.nombre,editCampos:Object.keys(a.props.pwSelect.datos).map(function(e,t){return Object(Ye.a)({},e,a.props.pwSelect.datos[e])}),editGrupos:a.props.pwSelect.grupos.map(function(e){return e.nombre}),editUsuarios:a.props.pwSelect.users.map(function(e){return e.username})}))},a.handleRepeater=function(e,t,r){var n=a.state.editCampos[t],o=Object.keys(n)[0],s=Object.values(n)[0];"key"===r?(n[e]=s,delete n[o]):"value"===r&&(n[Object.keys(n)[0]]=e);var i=a.state.editCampos.map(function(e,a){return t===a?n:e});a.setState({editCampos:i})},a.editarEntrada=function(){var e=a.state.editUsuarios.map(function(e){return a.props.usuarios.find(function(t){return t.username===e})._id}),t=a.state.editGrupos.map(function(e){return a.props.grupos.find(function(t){return t.nombre===e})._id}),r=a.state.editCampos.reduce(function(e,t){return Object(He.a)({},e,t)},{});a.state.editCampos.length>Object.keys(r).length?v.a.warning("No puede haber dos campos con el mismo identificador"):(0===t.length&&0===e.length&&v.a.info("La entrada no ha sido asignada a nadie, estar\xe1 solo disponible para administradores"),K("/pws/"+a.props.pwSelect._id,{method:"PUT",body:{nombre:a.state.editNombre,datos:r,users:e,grupos:t}}).then(function(e){v.a.success("La entrada se edit\xf3 correctamente"),a.props.dispatch(se()),a.setState({editNombre:"",editCampos:[{"":""}],editGrupos:[],editUsuarios:[]}),a.props.cb()}).catch(function(e){console.log(e),v.a.error("Ocurri\xf3 un error durante la edici\xf3n de la entrada")}))},a}return Object(d.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this,t=Se.a.Item,a=ct.a.Option;return n.a.createElement(C.a,{visible:this.props.visible,footer:null,onCancel:this.props.cb,width:"80vw"},n.a.createElement("h2",null,this.props.pwSelect.nombre),n.a.createElement("div",null,n.a.createElement(t,{label:"Nombre de la entrada"},n.a.createElement(je.a,{type:"text",value:this.state.editNombre,onChange:function(t){return e.setState({editNombre:t.target.value})}})),n.a.createElement(t,{label:"Campos"},this.state.editCampos.map(function(a,r){return n.a.createElement("div",{key:"campo"+r,style:{display:"flex"}},n.a.createElement(t,{label:"Identificador",style:{flex:1,paddingRight:"1em"}},n.a.createElement(je.a,{type:"text",value:Object.keys(a)[0],onChange:function(t){return e.handleRepeater(t.target.value,r,"key")}})),n.a.createElement(t,{label:"Valor",style:{flex:1,paddingRight:"1em"}},n.a.createElement(je.a,{type:"text",value:Object.values(a)[0],onChange:function(t){return e.handleRepeater(t.target.value,r,"value")}})),e.state.editCampos.length>1&&n.a.createElement(t,{label:" ",colon:!1},n.a.createElement(x.a,{color:"volcano",onClick:function(){return e.setState({editCampos:e.state.editCampos.filter(function(e,t){return t!==r})})}},n.a.createElement(O.a,{type:"delete"}))))}),n.a.createElement(x.a,{onClick:function(){return e.setState({editCampos:[].concat(Object(ze.a)(e.state.editCampos),[{"":""}])})}},n.a.createElement(O.a,{type:"plus"})," Nuevo campo")),n.a.createElement($e,{blue:this.props.blue},n.a.createElement(t,{label:"Asignar a grupos"},n.a.createElement(ct.a,{style:{width:"100%"},onChange:function(t){return e.setState({editGrupos:Object(ze.a)(new Set([].concat(Object(ze.a)(e.state.editGrupos),[t])))})}},this.props.grupos.map(function(e,t){return n.a.createElement(a,{key:"grupo"+t,value:e.nombre},e.nombre)})),n.a.createElement("div",{style:{paddingBottom:30}},this.state.editGrupos.map(function(t,a){return n.a.createElement(x.a,{closable:!0,key:"gtag"+t,onClose:function(){return e.setState({editGrupos:e.state.editGrupos.filter(function(e){return e!==t})})}},t)}))),n.a.createElement(t,{label:"Asignar a usuarios"},n.a.createElement(ct.a,{style:{width:"100%"},onChange:function(t){return e.setState({editUsuarios:Object(ze.a)(new Set([].concat(Object(ze.a)(e.state.editUsuarios),[t])))})}},this.props.usuarios.map(function(e,t){return n.a.createElement(a,{key:"user"+t,value:e.username},e.username)})),n.a.createElement("div",{style:{paddingBottom:30}},this.state.editUsuarios.map(function(t,a){return n.a.createElement(x.a,{closable:!0,key:"utag"+t,onClose:function(){return e.setState({editUsuarios:e.state.editUsuarios.filter(function(e){return e!==t})})}},t)})))),n.a.createElement(D.a,{onClick:this.editarEntrada},"Editar entrada")))}}]),t}(r.Component),Lt=Object(pe.b)()(Pt),Tt=function(e){function t(){var e,a;Object(c.a)(this,t);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={nuevaNombre:"",nuevaCampos:[{username:""},{password:""}],nuevaGrupos:[],nuevaUsuarios:[],modalPw:!1,pwSelect:{datos:{}}},a.txtRefs=[],a.filtraPw=function(){return a.props.pws.filter(function(e){var t=e.grupos.map(function(e){return e._id}),r=a.props.auth.grupos.map(function(e){return e._id}),n=t.filter(function(e){return r.includes(e)}).length>0,o=e.users.map(function(e){return e._id}).includes(a.props.auth._id),s=a.props.auth.manager&&!a.props.blueCollar;return n||o||s})},a.handleRepeater=function(e,t,r){var n=a.state.nuevaCampos[t],o=Object.keys(n)[0],s=Object.values(n)[0];"key"===r?(n[e]=s,delete n[o]):"value"===r&&(n[Object.keys(n)[0]]=e);var i=a.state.nuevaCampos.map(function(e,a){return t===a?n:e});a.setState({nuevaCampos:i})},a.nuevaEntrada=function(){var e=a.state.nuevaUsuarios.map(function(e){return a.props.usuarios.find(function(t){return t.username===e})._id}),t=a.state.nuevaGrupos.map(function(e){return a.props.grupos.find(function(t){return t.nombre===e})._id}),r=a.state.nuevaCampos.reduce(function(e,t){return Object(He.a)({},e,t)},{});a.state.nuevaCampos.length>Object.keys(r).length?v.a.warning("No puede haber dos campos con el mismo identificador"):(0===t.length&&0===e.length&&v.a.info("La contrase\xf1a no ha sido asignada a nadie, estar\xe1 solo disponible para administradores"),K("/pws",{method:"POST",body:{nombre:a.state.nuevaNombre,datos:r,users:e,grupos:t,equipo:L().equipo}}).then(function(e){v.a.success("La entrada se guard\xf3 correctamente"),a.props.dispatch(se()),a.setState({nuevaNombre:"",nuevaCampos:[{username:""},{password:""}],nuevaGrupos:[],nuevaUsuarios:[]})}).catch(function(e){console.log(e),v.a.error("Ocurri\xf3 un error durante el guardado de la entrada")}))},a.borrarEntrada=function(e){console.log(e),K("/pws/"+e._id,{method:"DELETE"}).then(function(e){v.a.success("La entrada se elimin\xf3 correctamente"),a.props.dispatch(se())}).catch(function(e){console.log(e),v.a.error("Se produjo un error durante el borrado de la entrada")})},a}return Object(d.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){this.props.pws.length>0&&this.props.auth&&this.setState({pws:this.filtraPw()})}},{key:"componentDidUpdate",value:function(e){e.pws===this.props.pws&&this.props.blueCollar===e.blueCollar||!this.props.auth||this.setState({pws:this.filtraPw()})}},{key:"render",value:function(){var e=this,t=it.a.Panel,a=Se.a.Item,r=ct.a.Option;return n.a.createElement(y.a,{style:{height:"100vh"}},n.a.createElement(ve,{isLogged:!!M()},n.a.createElement("h2",null,"Contrase\xf1as"),n.a.createElement(Qe.a,{style:{paddingBottom:30},rowKey:"_id",dataSource:this.state.pws,onRow:function(t){return{onClick:function(){return e.setState({modalPw:!0,pwSelect:t})}}},columns:[{title:"Entrada",dataIndex:"nombre",key:"nombre"},{title:"Asignada a",render:function(e){return[].concat(Object(ze.a)(e.grupos),Object(ze.a)(e.users)).map(function(e,t){return n.a.createElement(x.a,{key:e._id+"-"+t,style:{margin:"2px"}},e.username?e.username:e.nombre)})},key:"asignadaA"},{title:"",key:"btnConsulta",render:function(t){return n.a.createElement("div",{style:{display:"flex",justifyContent:"flex-end"}},n.a.createElement("div",{style:{display:"flex"}},n.a.createElement($e,{blue:e.props.blueCollar},n.a.createElement(We.a,{title:"Se borrar\xe1 la entrada. \xbfQuieres continuar?",onConfirm:function(){return e.borrarEntrada(t)},okText:"Aceptar",cancelText:"Cancelar"},n.a.createElement(x.a,{color:"volcano",onClick:function(){return e.setState({pwSelect:t})}},n.a.createElement(O.a,{type:"delete"})," Eliminar"))),n.a.createElement(x.a,{color:"gold",onClick:function(){return e.setState({modalEditarPws:!0,pwSelect:t})}},n.a.createElement(O.a,{type:"edit"})," Editar")),n.a.createElement(x.a,{color:"blue",onClick:function(){return e.setState({modalPw:!0,pwSelect:t})}},n.a.createElement(O.a,{type:"search"})," Consultar"))}}]}),n.a.createElement(it.a,null,n.a.createElement(t,{key:"nueva",header:"Nueva entrada"},n.a.createElement(a,{label:"Nombre de la entrada"},n.a.createElement(je.a,{type:"text",value:this.state.nuevaNombre,onChange:function(t){return e.setState({nuevaNombre:t.target.value})}})),n.a.createElement(a,{label:"Campos"},this.state.nuevaCampos.map(function(t,r){return n.a.createElement("div",{key:"campo"+r,style:{display:"flex"}},n.a.createElement(a,{label:"Identificador",style:{flex:1,paddingRight:"1em"}},n.a.createElement(je.a,{type:"text",value:Object.keys(t)[0],onChange:function(t){return e.handleRepeater(t.target.value,r,"key")}})),n.a.createElement(a,{label:"Valor",style:{flex:1,paddingRight:"1em"}},n.a.createElement(je.a,{type:"text",value:Object.values(t)[0],onChange:function(t){return e.handleRepeater(t.target.value,r,"value")}})),e.state.nuevaCampos.length>1&&n.a.createElement(a,{label:" ",colon:!1},n.a.createElement(x.a,{color:"volcano",onClick:function(){return e.setState({nuevaCampos:e.state.nuevaCampos.filter(function(e,t){return t!==r})})}},n.a.createElement(O.a,{type:"delete"}))))}),n.a.createElement(x.a,{onClick:function(){return e.setState({nuevaCampos:[].concat(Object(ze.a)(e.state.nuevaCampos),[{"":""}])})}},n.a.createElement(O.a,{type:"plus"})," Nuevo campo")),n.a.createElement(a,{label:"Asignar a grupos"},n.a.createElement(ct.a,{style:{width:"100%"},onChange:function(t){return e.setState({nuevaGrupos:Object(ze.a)(new Set([].concat(Object(ze.a)(e.state.nuevaGrupos),[t])))})}},this.props.grupos.map(function(e,t){return n.a.createElement(r,{key:"grupo"+t,value:e.nombre},e.nombre)})),n.a.createElement("div",{style:{paddingBottom:30}},this.state.nuevaGrupos.map(function(t,a){return n.a.createElement(x.a,{closable:!0,key:"gtag"+t,onClose:function(){return e.setState({nuevaGrupos:e.state.nuevaGrupos.filter(function(e){return e!==t})})}},t)}))),n.a.createElement(a,{label:"Asignar a usuarios"},n.a.createElement(ct.a,{style:{width:"100%"},onChange:function(t){return e.setState({nuevaUsuarios:Object(ze.a)(new Set([].concat(Object(ze.a)(e.state.nuevaUsuarios),[t])))})}},this.props.usuarios.map(function(e,t){return n.a.createElement(r,{key:"user"+t,value:e.username},e.username)})),n.a.createElement("div",{style:{paddingBottom:30}},this.state.nuevaUsuarios.map(function(t,a){return n.a.createElement(x.a,{closable:!0,key:"utag"+t,onClose:function(){return e.setState({nuevaUsuarios:e.state.nuevaUsuarios.filter(function(e){return e!==t})})}},t)}))),n.a.createElement(D.a,{onClick:this.nuevaEntrada},"Guardar entrada")))),n.a.createElement(C.a,{visible:this.state.modalPw,footer:null,onCancel:function(){return e.setState({modalPw:!1})}},n.a.createElement("h2",null,this.state.pwSelect.nombre),n.a.createElement(Qe.a,{showHeader:!1,pagination:!1,size:"small",rowKey:"zzzzz",dataSource:Object.keys(this.state.pwSelect.datos).map(function(t,a){var r;return r={},Object(Ye.a)(r,t,e.state.pwSelect.datos[t]),Object(Ye.a)(r,"zzzzz",a),r}),columns:[{title:"Identificador",key:function(e){return Object.keys(e)[0]},render:function(e){return Object.keys(e)[0]}},{title:"Valor",render:function(e){return Object.values(e)[0]}},{title:"",render:function(e){return n.a.createElement("div",{style:{display:"flex",justifyContent:"flex-end"}},n.a.createElement(D.a,{onClick:function(){navigator.clipboard.writeText(Object.values(e)[0]),v.a.info("Se ha copiado la clave en el portapapeles")}},"Copiar"))}}]})),n.a.createElement(Lt,{visible:this.state.modalEditarPws,cb:function(){return e.setState({modalEditarPws:!1})},pwSelect:this.state.pwSelect,grupos:this.props.grupos,usuarios:this.props.usuarios,blue:this.props.blueCollar}))}}]),t}(r.Component),Nt=Object(pe.b)(function(e){return{grupos:e.grupos,usuarios:e.usuarios,pws:e.pws,auth:e.auth,blueCollar:e.blueCollar}})(Tt),Rt=function(e){function t(){var e,a;Object(c.a)(this,t);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={},a.addFestivo=function(){a.state.nombre?a.state.fecha?K("/dias",{method:"POST",body:{fecha:Q.a.utc(a.state.fecha).format(),tipo:"festivo",nombre:a.state.nombre,equipo:L().equipo,aprobado:!0}}).then(function(e){v.a.success("El nuevo festivo se ha a\xf1adido correctamente"),a.props.dispatch(ae()),a.setState({nombre:void 0,fecha:void 0})}).catch(function(e){console.log(e),v.a.error("Se ha producido un error durante la creaci\xf3n del nuevo festivo")}):v.a.warning("No se ha seleccionado ninguna fecha"):v.a.warning("No se ha asignado nombre al festivo")},a.borrarFestivo=function(e){K("/dias/"+e._id,{method:"DELETE"}).then(function(e){v.a.success("Se ha borrado el festivo correctamente"),a.props.dispatch(ae())}).catch(function(e){console.log(e),v.a.error("Ha ocurrido un error durante el borrado del festivo")})},a}return Object(d.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this;return n.a.createElement("div",null,n.a.createElement("h3",null,"Lista de festivos"),n.a.createElement(Qe.a,{dataSource:this.props.dias.filter(function(e){return"festivo"===e.tipo}),rowKey:"_id",columns:[{title:"Nombre",dataIndex:"nombre",key:"nombre"},{title:"D\xeda",key:"fecha",render:function(e){return Q()(e.fecha).format("YYYY-MM-DD")}},{key:"botones",render:function(t){return n.a.createElement("div",{key:t._id,style:{display:"flex",justifyContent:"flex-end"}},n.a.createElement(We.a,{title:"\xbfEst\xe1s seguro de que quieres borrar el d\xeda festivo?",onConfirm:function(){return e.borrarFestivo(t)},icon:n.a.createElement(O.a,{type:"warning",style:{color:"red"}})},n.a.createElement(x.a,{color:"volcano",key:"".concat(t._id,"_dia")},n.a.createElement(O.a,{type:"delete"})," Borrar")))}}]}),n.a.createElement("h3",{style:{marginTOp:20}},"A\xf1adir festivo"),n.a.createElement("div",{style:{display:"flex",flexWrap:"wrap"}},n.a.createElement(Se.a.Item,{label:"Nombre",style:{marginRight:20}},n.a.createElement(je.a,{type:"text",onChange:function(t){return e.setState({nombre:t.target.value})}})),n.a.createElement(Se.a.Item,{label:"Fecha",style:{marginRight:20}},n.a.createElement(ft.a,{onChange:function(t){return e.setState({fecha:t})},style:{width:250}})),n.a.createElement(Se.a.Item,{label:" ",colon:!1},n.a.createElement(D.a,{onClick:this.addFestivo},"A\xf1adir"))))}}]),t}(r.Component),Ut=Object(pe.b)(function(e){return{dias:e.dias}})(Rt),Yt=function(e){function t(){var e,a;Object(c.a)(this,t);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={},a}return Object(d.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=it.a.Panel;return n.a.createElement(y.a,{style:{height:"100vh"}},n.a.createElement(ve,{isLogged:!!M()},n.a.createElement("h1",null,"Configuraci\xf3n"),n.a.createElement(it.a,null,n.a.createElement(e,{header:"A\xf1adir registros"},n.a.createElement(jt,null))),n.a.createElement(it.a,null,n.a.createElement(e,{header:"Gestionar festivos"},n.a.createElement(Ut,null)))))}}]),t}(r.Component),qt=a(121);var Bt=Object(qt.combineReducers)({usuarios:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case N:return console.log(t),t.payload;default:return e}},dias:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case R:return console.log(t),t.payload;default:return e}},es:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case U:return console.log(t),t.payload;default:return e}},documentos:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Y:return console.log(t),t.payload;default:return e}},blueCollar:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case z:return t.payload;default:return e}},grupos:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case q:return console.log(t),t.payload;default:return e}},pws:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case B:return console.log(t),t.payload;default:return e}},auth:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case G:return console.log(t),t.payload;default:return e}},mesES:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Q()(),t=arguments.length>1?arguments[1]:void 0;switch(t.type){case H:return t.payload;default:return e}},entradas:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case F:return console.log(t),t.payload.data.entradas;default:return e}},errorCarga:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{error:!1},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case J:return t.payload;default:return e}}}),Gt=a(447),Ft=a(448),zt=Object(qt.createStore)(Bt,{},Object(Ft.composeWithDevTools)(Object(qt.applyMiddleware)(Gt.a))),Ht=a(863),Jt=a(26),Wt=function(e){var t=e.datos,a=e.mes;return n.a.createElement(Jt.a,null,n.a.createElement(Jt.c,{size:"A4",style:Kt.hoja},n.a.createElement(Jt.e,null,"WEEELCOME"),n.a.createElement(Jt.e,{style:{marginTop:10,marginBottom:20}},"Registro de jornada laboral - ",a&&ce(a.format("MMMM YYYY"))),n.a.createElement(Jt.f,{style:Kt.datos},n.a.createElement(Jt.f,{style:Kt.cajaDatos},n.a.createElement(Jt.f,{style:Kt.filaDatos},n.a.createElement(Jt.e,{style:Kt.claveDatos},"Trabajador:\xa0"),n.a.createElement(Jt.e,{style:Kt.valorDatos},t.nombre+" "+t.apellidos)),n.a.createElement(Jt.f,{style:Kt.filaDatos},n.a.createElement(Jt.e,{style:Kt.claveDatos},"NIF:\xa0"),n.a.createElement(Jt.e,{style:Kt.valorDatos},t.nif)),n.a.createElement(Jt.f,{style:Kt.filaDatos},n.a.createElement(Jt.e,{style:Kt.claveDatos},"N\xfamero afiliaci\xf3n:\xa0"),n.a.createElement(Jt.e,{style:Kt.valorDatos},t.nuss))),n.a.createElement(Jt.f,{style:Kt.cajaDatos},n.a.createElement(Jt.f,{style:Kt.filaDatos},n.a.createElement(Jt.e,{style:Kt.claveDatos},"Empresa:\xa0"),n.a.createElement(Jt.e,{style:Kt.valorDatos},t.empresa.razonSocial)),n.a.createElement(Jt.f,{style:Kt.filaDatos},n.a.createElement(Jt.e,{style:Kt.claveDatos},"CIF:\xa0"),n.a.createElement(Jt.e,{style:Kt.valorDatos},t.empresa.cif)),n.a.createElement(Jt.f,{style:Kt.filaDatos},n.a.createElement(Jt.e,{style:Kt.claveDatos},"CCC:\xa0"),n.a.createElement(Jt.e,{style:Kt.valorDatos},t.empresa.ccc)))),n.a.createElement(Jt.f,{style:Kt.tabla},n.a.createElement(Jt.f,{style:Object(He.a)({},Kt.fila,Kt.encabezado)},n.a.createElement(Jt.e,{style:Object(He.a)({},Kt.celda,Kt.celdaEncabezado)},"D\xeda"),n.a.createElement(Jt.e,{style:Object(He.a)({},Kt.celda,Kt.celdaEncabezado)},"Hora de entrada"),n.a.createElement(Jt.e,{style:Object(He.a)({},Kt.celda,Kt.celdaEncabezado)},"Hora de salida"),n.a.createElement(Jt.e,{style:Object(He.a)({},Kt.celda,Kt.celdaEncabezado)},"Tiempo de descanso"),n.a.createElement(Jt.e,{style:Object(He.a)({},Kt.celda,Kt.celdaEncabezado)},"Horas")),[].concat.apply([],t.jornadas.filter(function(e){return e.aprobado})).map(function(e,t){return n.a.createElement(Jt.f,{style:Object(He.a)({},Kt.fila,{backgroundColor:t%2?"white":"#eee"}),key:e.key},n.a.createElement(Jt.e,{style:Kt.celda},Q()(e.entrada).format("YYYY-MM-DD")),n.a.createElement(Jt.e,{style:Kt.celda},Q()(e.entrada).format("HH:mm")),n.a.createElement(Jt.e,{style:Kt.celda},"-"!==e.salida?Q()(e.salida).format("HH:mm"):" - "),n.a.createElement(Jt.e,{style:Kt.celda},le(e.tiempoDescanso,1),"h"),n.a.createElement(Jt.e,{style:Object(He.a)({},Kt.celda,Kt.ultimaColumna)},le(e.horas,1),"h"))})),n.a.createElement(Jt.f,{style:Kt.pie},n.a.createElement(Jt.e,{style:Kt.fecha},"A ",Q()().format("LL"),":"),n.a.createElement(Jt.f,{style:Kt.cajapie},n.a.createElement(Jt.e,{style:Kt.textopie},"Firma del trabajador"),n.a.createElement(Jt.e,{style:Kt.textopie},"Firma del responsable de la empresa")))))},Vt=function(e){function t(){var e,a;Object(c.a)(this,t);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={usuarios:[],userInfo:L()},a.diasLaborables=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Q()().month()+1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Q()().year(),n=a.props.dias.filter(function(e){return"festivo"===e.tipo&&Q()(e.fecha).month()===t}).length;return Array(Q()().month(t).year(r).daysInMonth()).fill(null).filter(function(e,a){return Q()().year(r).month(t).date(a+1).weekday()<=4}).length-a.props.dias.filter(function(a){return a.user&&a.user._id===e&&!0===a.aprobado&&Q()(a.fecha).month()===t}).length-n},a.procesaES=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Q()().month()+1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Q()().year(),r=Q()().month(e-1).year(t).daysInMonth();if(Array.isArray(a.props.es.users)){var n=a.props.es.users.map(function(n){var o=n.duracionjornada||8,s=a.diasLaborables(n._id,e,t),i=Array(r).fill(null).map(function(e,t){return Q()().subtract(t,"days").format("YYYY-MM-DD")}).map(function(e){return n.registros.filter(function(t){return Q()(t.fecha).isSame(Q()(e),"days")&&Q()(t.fecha).isSame(a.props.mesES,"month")}).sort(function(e,t){return Q()(e.fecha).isBefore(Q()(t.fecha))?-1:Q()(t.fecha).isBefore(Q()(e.fecha))?1:0})}).map(function(e,t){var a=Array(Math.ceil(e.length/2)).fill(null).map(function(a,r){var o=Q()(e[2*r].fecha),s=e[2*r+1]?Q()(e[2*r+1].fecha):void 0,i=s?Q.a.duration(s.diff(o)):o.isSame(Q()(),"day")?Q.a.duration(Q()().diff(o)):"-",c="-"!==i?Math.round(100*i.as("hours"))/100:"-";return{key:n._id+"-"+t+"-"+r,entrada:o.format(),aprobado:!(!e[2*r].aprobado||e[2*r+1]&&!e[2*r+1].aprobado),salida:s?s.format():"-",horas:c}}),r=Array(a.length>0?a.length-1:0).fill(null).map(function(e,t){var r=Q()(a[t].salida),n=Q()(a[t+1].entrada);return Math.round(100*Q.a.duration(n.diff(r)).as("hours"))/100}).reduce(function(e,t){return e+t},0),o=a.map(function(e){return e.horas});return a[0]?{key:a[0].key,entrada:a[0].entrada,salida:a.slice(-1)[0].salida,aprobado:!a.map(function(e){return e.aprobado}).includes(!1),horas:o.includes("-")?"-":o.reduce(function(e,t){return e+t},0),usuario:n.username,registros:e,tiempoDescanso:r}:[]}),c=Math.round(100*i.filter(function(e){return e.aprobado}).map(function(e){return e.horas}).filter(function(e){return"-"!==e&&void 0!==e}).reduce(function(e,t){return e+t},0))/100,l=s*o,u=Math.round(c/(s*o)*1e4)/100,d=Math.round(100*(l-c))/100,p={razonSocial:a.props.es.razonSocial,cif:a.props.es.cif,ccc:a.props.es.ccc};return Object(He.a)({},n,{jornadas:i,horasTrabajadas:c,horasPendientes:d,porcentajeHoras:u,duracionJornada:o,diasLaborables:s,empresa:p})});a.setState({usuarios:n})}},a}return Object(d.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){this.props.es&&this.props.es.users&&this.procesaES(this.props.mesES.month(),this.props.mesES.year())}},{key:"componentDidUpdate",value:function(e,t){e.es!==this.props.es?this.procesaES(this.props.mesES.month(),this.props.mesES.year()):e.mesES.isSame(this.props.mesES,"month")||this.props.dispatch(re(this.props.mesES))}},{key:"render",value:function(){var e=this,t=ft.a.MonthPicker;return n.a.createElement(y.a,{style:{height:"100vh"}},n.a.createElement(ve,{isLogged:!!M()},n.a.createElement("h1",null,"Jornadas"),n.a.createElement(t,{placeholder:"Seleccionar mes",value:this.props.mesES,onChange:function(t){e.props.dispatch(X(t))},style:{marginBottom:20}}),n.a.createElement(Ht.a,{dataSource:this.state.usuarios,renderItem:function(t){return n.a.createElement(Ht.a.Item,null,n.a.createElement("span",{style:{marginRight:20}},t.username),n.a.createElement(D.a,null,n.a.createElement(Jt.b,{document:n.a.createElement(Wt,{datos:t,mes:e.props.mesES}),fileName:"Weeelcome - ".concat(t.nombre," ").concat(t.apellidos," - ").concat(Q()(e.props.mesES).format("YYYYMM")," Volcado.pdf")},function(e){e.blob,e.url;var t=e.loading;e.error;return t?"Cargando documento...":"Descargar"})))}})))}}]),t}(r.Component),Kt=Jt.d.create({hoja:{display:"flex",alignItems:"center",padding:20},tabla:{display:"flex",flexDirection:"column",borderBottomColor:"#ddd",borderBottomWidth:1},fila:{display:"flex",flexDirection:"row",width:"100%"},celda:{display:"flex",width:"20%",justifyContent:"center",alignItems:"center",fontSize:"11pt",borderLeftColor:"#ddd",borderLeftWidth:1,padding:4},ultimaColumna:{borderRightColor:"#ddd",borderRightWidth:1},encabezado:{fontWeight:"bold",backgroundColor:"black",color:"white"},celdaEncabezado:{borderLeftColor:"black",borderRightColor:"black"},datos:{display:"flex",flexDirection:"row",justifyContent:"space-between",marginBottom:20},cajaDatos:{display:"flex",width:"50%"},filaDatos:{display:"flex",flexDirection:"row"},claveDatos:{fontSize:"14pt",marginRight:"1em"},valorDatos:{fontSize:"14pt"},pie:{display:"flex",marginTop:40,width:"100%",paddingLeft:40,paddingRight:40},fecha:{fontSize:"11pt",marginBottom:5},cajapie:{display:"flex",flexDirection:"row",justifyContent:"space-between"},textopie:{fontSize:"11pt"}}),Zt=Object(de.socketConnect)(Object(pe.b)(function(e){return{es:e.es,mesES:e.mesES,dias:e.dias,blueCollar:e.blueCollar}})(Vt));Q.a.locale("es");var Qt=Te.a.connect("https://we.blacknosaur.com",{transports:["websocket"]}),$t=(p.a,function(e){function t(){return Object(c.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){var e=L();e&&e.equipo&&(zt.dispatch(te()),zt.dispatch(ee()),zt.dispatch(ae()),zt.dispatch(re()),zt.dispatch(ie()),zt.dispatch(ne()),zt.dispatch(oe()),zt.dispatch(se()))}},{key:"render",value:function(){return n.a.createElement(pe.a,{store:zt},n.a.createElement(Ie.a,{locale:Pe.a},n.a.createElement(de.SocketProvider,{socket:Qt},n.a.createElement(p.a,null,n.a.createElement(m.a,null,n.a.createElement(f.a,{exact:!0,path:"/login",component:xe}),n.a.createElement(f.a,{exact:!0,path:"/register",component:Ae}),n.a.createElement(Ue,{exact:!0,path:"/calendario",component:et}),n.a.createElement(Ue,{exact:!0,path:"/archivos",component:dt}),n.a.createElement(Ue,{exact:!0,path:"/perfil",component:At}),n.a.createElement(Ue,{exact:!0,path:"/usuarios",component:mt}),n.a.createElement(Ue,{exact:!0,path:"/passwords",component:Nt}),n.a.createElement(Ue,{onlyManager:!0,exact:!0,path:"/analitica",component:Et}),n.a.createElement(Ue,{onlyManager:!0,exact:!0,path:"/grupos",component:Mt}),n.a.createElement(Ue,{onlyManager:!0,exact:!0,path:"/configuracion",component:Yt}),n.a.createElement(Ue,{onlyManager:!0,exact:!0,path:"/exportacion",component:Zt}),n.a.createElement(Ue,{exact:!0,path:"/usuario/:id",component:yt}),n.a.createElement(Ue,{exact:!0,path:"/registro",component:xt}),n.a.createElement(Ue,{exact:!0,path:"/nuevousuario",component:nt}),n.a.createElement(Ue,{exact:!0,path:"/",component:Fe}),n.a.createElement(f.a,{path:"",component:_e}))))))}}]),t}(r.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(n.a.createElement($t,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[467,1,2]]]);
//# sourceMappingURL=main.d06b3ff0.chunk.js.map