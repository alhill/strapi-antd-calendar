(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{268:function(e,t,a){e.exports=a(505)},273:function(e,t,a){},414:function(e,t){},505:function(e,t,a){"use strict";a.r(t);var r=a(0),n=a.n(r),o=a(9),s=a.n(o),i=(a(273),a(17)),c=a(18),l=a(20),u=a(19),d=a(21),m=a(526),p=a(529),f=a(509),h=a(28),g=a.n(h),y=a(41),b=a(524),v=a(518),E=a(523),j=a(185),k=a(137),S=a(508),C=a(530),w=a(10),O=a(507),x=a(528);function _(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return void 0===e&&console.log("El par\xe1metro 'query' de la funcion gql est\xe1 vac\xedo"),a+"/graphql?query="+e.replace(/\n/gi,"%0A").replace(/:/gi,"%3A").replace(/\\/gi,"%22").replace(/ {2}/gi,"%09").replace(/ /gi,"%20").replace(/{/gi,"%7B").replace(/}/gi,"%7D").replace(/\(/gi,"%28").replace(/\)/gi,"%29").split("$").map(function(e,a){return a%2?t[e]:e}).reduce(function(e,t){return e+t},"")}function A(){return"undefined"!==window.localStorage.getItem("jwt")?JSON.parse(window.localStorage.getItem("jwt")):void 0}function D(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"application/json",a=A(),r={Accept:t,"Content-Type":t};return a&&!e&&(r.Authorization="Bearer "+a),r}function I(){var e=window.localStorage.getItem("user");return["undefined","",void 0].includes(e)?void 0:JSON.parse(window.localStorage.getItem("user"))}function P(e){window.localStorage.setItem("jwt",JSON.stringify(e.jwt)),window.localStorage.setItem("user",JSON.stringify(e.user))}var U=a(62),L=a(33),T="CARGAR_USUARIOS",M="CARGAR_CALENDARIO",q="CARGAR_ES",N="CARGAR_DOCUMENTOS",R="CAMBIAR_BLUE_COLLAR";a(283);function Y(e){return e.json?e.json():e}function B(e){return e.status>=200&&e.status<300?e:Y(e).then(function(t){t.errors&&t.errors.forEach(function(e){console.log(e)});var a=new Error(e.statusText);throw a.response=e,a.response.payload=t,a})}function F(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];a&&(t.headers=Object.assign({"Content-Type":"application/json"},t.headers,{}));var r=A();if(r&&(t.headers=Object.assign({Authorization:"Bearer ".concat(r)},t.headers)),t&&t.params){var n=function(e){return Object.keys(e).map(function(t){return"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(e[t]))}).join("&")}(t.params);e="".concat(e,"?").concat(n)}return t&&t.body&&a&&(t.body=JSON.stringify(t.body)),fetch("https://we.blacknosaur.com"+e,t).then(B).then(Y)}var H=function(){return function(e){return F("/users?_limit=0&equipo="+(I()&&I().equipo)).then(function(t){e({type:T,payload:t})}).catch(function(e){throw e})}};var J=function(){return function(e){return F(_((t=I(),t.equipo?'{\n    dias(where: { equipo: "'.concat(t.equipo,'" }, limit: 10000){\n        _id\n        fecha\n        tipo\n        aprobado\n        nombre\n        user{\n            _id\n            username\n            avatar{\n                url\n            }\n        }\n    }\n}'):"{}"))).then(function(t){var a;e((a=t.data.dias,{type:M,payload:a}))}).catch(function(e){throw e});var t}};var G=function(){return function(e){return F(_((t=I(),t.equipo?'{\n    equipo(id: "'.concat(t.equipo,'"){\n        users{\n            _id\n            username\n            avatar{\n                url\n            }\n            registros{\n                _id\n                fecha\n                idcard\n                aprobado\n                user{\n                    _id\n                    username\n                }\n                ultimoEditor{\n                    _id\n                    username\n                }\n            }\n            duracionjornada\n        }\n    }\n}'):"{}"))).then(function(t){var a;e((a=t.data.equipo&&t.data.equipo.users,{type:q,payload:a}))}).catch(function(e){throw e});var t}};var z=function(){return function(e){return F("/documentos?_limit=0").then(function(t){e({type:N,payload:t})}).catch(function(e){throw e})}},W=(r.Component,function(e){function t(){return Object(i.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=I();return("object"===typeof e&&null!==e&&!1===e.blocked?e:{role:{name:"Not Authorised"}}).manager?this.props.children:""}}]),t}(r.Component)),V=b.a.Header,K=b.a.Footer,$=b.a.Sider,Z=b.a.Content,Q=v.a.Title,X=v.a.Paragraph,ee=function(e){function t(){var e,a;Object(i.a)(this,t);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={user:{username:" ",avatar:{}},local:!1},a.cerrarSesion=function(){window.localStorage.removeItem("jwt"),window.localStorage.removeItem("user"),E.a.info("\xa1Vuelve pronto!"),a.props.history.push("/login")},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=Object(y.a)(g.a.mark(function e(){var t,a,r,n,o,s=this;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=I(),this.props.socket.on("notification",function(e){e.es?s.props.dispatch(G()):e.dia?s.props.dispatch(J()):e.user&&s.props.dispatch(H())}),a=[].concat.apply([],this.props.es.map(function(e){return e.registros})).map(function(e){return e.aprobado}),r=!(!this.props.dias.map(function(e){return e.aprobado}).includes(null)&&!this.props.dias.map(function(e){return e.aprobado}).includes(!1)),n=!(!a.includes(!1)&&!a.includes(null)),o=!!this.props.usuarios.map(function(e){return e.confirmed}).includes(!1),this.setState({user:t,diasPorConfirmar:r,registrosPorConfirmar:n,usuariosPorConfirmar:o});case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"componentDidUpdate",value:function(e,t){if(this.props.dias!==e.dias)this.props.dias.map(function(e){return e.aprobado}).includes(null)||this.props.dias.map(function(e){return e.aprobado}).includes(!1)?this.setState({diasPorConfirmar:!0}):this.setState({diasPorConfirmar:!1});else if(this.props.es!==e.es){var a=[].concat.apply([],this.props.es.map(function(e){return e.registros})).map(function(e){return e.aprobado});a.includes(!1)||a.includes(null)?this.setState({registrosPorConfirmar:!0}):this.setState({registrosPorConfirmar:!1})}else this.props.usuarios!==e.usuarios&&(this.props.usuarios.map(function(e){return e.confirmed}).includes(!1)?this.setState({usuariosPorConfirmar:!0}):this.setState({usuariosPorConfirmar:!1}))}},{key:"render",value:function(){var e=this,t=this.state.user,a=this.props.isLogged,r=n.a.createElement(j.a,null,n.a.createElement(j.a.Item,null,n.a.createElement(O.a,{to:"/perfil"},"Perfil")),n.a.createElement(j.a.Item,{onClick:this.cerrarSesion},n.a.createElement("span",null,"Cerrar sesi\xf3n")),t&&t.manager&&n.a.createElement(j.a.Item,{onClick:function(){return e.props.dispatch((t=!e.props.blueCollar,{type:R,payload:t}));var t}},n.a.createElement("span",null,this.props.blueCollar?"Modo Manager":"Modo Blue Collar")));return n.a.createElement("div",{style:{minHeight:"100vh",display:"flex",flexDirection:"column"}},n.a.createElement(V,{key:"header",style:{backgroundColor:"black",display:"flex",alignItems:"center",justifyContent:"space-between"}},n.a.createElement(Q,{style:{color:"#f0f0f0",margin:"0.25em",display:"flex",alignItems:"center"}},n.a.createElement("img",{src:"https://we.blacknosaur.com/logo.png",alt:"Blacknosaur Logo",style:{filter:"invert(1)",height:45,marginRight:20}})," Portal del Blacknosaurio"),a&&n.a.createElement(k.a,{overlay:r},n.a.createElement(S.a,{style:{boxShadow:this.props.blueCollar?"inset 0 0 4px 1px blue":"none"},src:t&&t.avatar&&"https://we.blacknosaur.com"+t.avatar.url},t&&t.username[0].toUpperCase()))),n.a.createElement(b.a,{key:"layout",style:{flex:1}},a&&n.a.createElement($,{style:{backgroundColor:"#191919"}},n.a.createElement(j.a,{theme:"dark",style:{backgroundColor:"#191919"},mode:"vertical-left",selectedKeys:[window.location.pathname]},n.a.createElement(j.a.Item,{key:"/calendario",style:{display:"flex",alignItems:"center"}},n.a.createElement(O.a,{to:"/calendario"},"Calendario"),this.state.diasPorConfirmar&&t&&t.manager&&!this.props.blueCollar&&n.a.createElement(C.a,{style:{transform:"initial",position:"static",marginLeft:10},count:n.a.createElement(w.a,{type:"bell",style:{color:"#f5222d"}})})),n.a.createElement(j.a.Item,{key:"/archivos"},n.a.createElement(O.a,{to:"/archivos"},"Documentos")),n.a.createElement(j.a.Item,{key:"/registro",style:{display:"flex",alignItems:"center"}},n.a.createElement(O.a,{to:"/registro"},"Registro E/S"),this.state.registrosPorConfirmar&&t&&t.manager&&!this.props.blueCollar&&n.a.createElement(C.a,{style:{transform:"initial",position:"static",marginLeft:10},count:n.a.createElement(w.a,{type:"bell",style:{color:"#f5222d"}})})),n.a.createElement(j.a.Item,{key:"/usuarios",style:{alignItems:"center"}},n.a.createElement(O.a,{to:"/usuarios"},"Usuarios"),this.state.usuariosPorConfirmar&&t&&t.manager&&!this.props.blueCollar&&n.a.createElement(C.a,{style:{transform:"initial",position:"static",marginLeft:10},count:n.a.createElement(w.a,{type:"bell",style:{color:"#f5222d"}})})),n.a.createElement(j.a.Item,{key:"/grupos",style:{alignItems:"center",display:t&&t.manager&&!this.props.blueCollar?"flex":"none"}},n.a.createElement(O.a,{to:"/grupos"},"Grupos")),n.a.createElement(j.a.Item,{key:"/configuracion",style:{alignItems:"center",display:t&&t.manager&&!this.props.blueCollar?"flex":"none"}},n.a.createElement(O.a,{to:"/configuracion"},"Configuraci\xf3n")),n.a.createElement(j.a.Item,{key:"telefonillo",className:"telefonillo",style:{alignItems:"center",display:"flex",justifyContent:"space-between"}},n.a.createElement("a",{href:"http://192.168.1.65:24491",target:"_blank",rel:"noopener noreferrer"},"Telefonillo ")))),n.a.createElement(b.a,null,n.a.createElement(Z,{style:{padding:"2em",display:"flex",flexDirection:"column"}},n.a.createElement("div",{style:{flex:1}},this.props.children),n.a.createElement(K,{style:{paddingBottom:0}},n.a.createElement(X,null,"\xae 2019 - Made with ",n.a.createElement("span",{role:"img","aria-label":"heart"},"\u2764\ufe0f"),", ",n.a.createElement("span",{role:"img","aria-label":"beer"},"\ud83c\udf7a")," and ",n.a.createElement("span",{role:"img","aria-label":"poo"},"\ud83d\udca9")," by ",n.a.createElement("a",{href:"https://blacknosaur.com",target:"_blank",rel:"noopener noreferrer"},"Blacknosaur")," & ",n.a.createElement("a",{href:"https://www.alhill.dev",target:"_blank",rel:"noopener noreferrer"},"AlHill Development")))))))}}]),t}(r.Component),te=Object(U.socketConnect)(Object(L.b)(function(e){return{blueCollar:e.blueCollar,es:e.es,usuarios:e.usuarios,dias:e.dias}})(Object(x.a)(ee))),ae=a(516),re=a(514),ne=a(522),oe=a(94),se=a(52),ie=a(39);var ce=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).handleSubmit=function(e){e.preventDefault(),a.props.form.validateFields(function(e,t){e||fetch("https://we.blacknosaur.com/auth/local",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({identifier:t.userName,password:t.password})}).then(function(e){e.json().then(function(e){console.log(e.user),400===e.statusCode?a.setState({error:!0}):e.user.confirmed?(a.setState({error:!1}),P(e),a.props.dispatch(H()),a.props.dispatch(J()),a.props.dispatch(G()),a.props.history.push("/calendario")):E.a.info("Tu acceso al equipo de trabajo todav\xeda no ha sido aprobado")}).catch(function(e){return console.log(e)})}).catch(function(e){return console.log(e)})})},a.state={error:!1},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.props.form.validateFields(),A()&&this.props.history.push("/")}},{key:"render",value:function(){var e,t=this,a=this.props.form,r=a.getFieldDecorator,o=a.getFieldsError,s=a.getFieldError,i=a.isFieldTouched,c=i("userName")&&s("userName"),l=i("password")&&s("password");return n.a.createElement(b.a,{style:{height:"100vh"}},n.a.createElement(te,{isLogged:!!A()},n.a.createElement(b.a.Content,{style:{display:"flex",justifyContent:"center",alignItems:"center"}},n.a.createElement(ae.a,{style:{width:450,maxWidth:"90%"}},n.a.createElement(re.a,{onSubmit:this.handleSubmit},n.a.createElement(re.a.Item,{validateStatus:c||this.state.error?"error":"",help:c||""},r("userName",{rules:[{required:!0,message:"Introduce tu nombre de usuario"}]})(n.a.createElement(ne.a,{onChange:function(e){return t.setState({user:e.target.value})},prefix:n.a.createElement(w.a,{type:"user",style:{color:"rgba(0,0,0,.25)"}}),placeholder:"Nombre de usuario"}))),n.a.createElement(re.a.Item,{validateStatus:l||this.state.error?"error":"",help:l||""},r("password",{rules:[{required:!0,message:"Introduce tu contrase\xf1a"}]})(n.a.createElement(ne.a,{onChange:function(e){return t.setState({pw:e.target.value})},prefix:n.a.createElement(w.a,{type:"lock",style:{color:"rgba(0,0,0,.25)"}}),type:"password",placeholder:"Contrase\xf1a"}))),n.a.createElement(re.a.Item,null,n.a.createElement(oe.a,null,n.a.createElement(se.a,{span:12,style:{justifyContent:"center",display:"flex"}},n.a.createElement(ie.a,{type:"primary",onClick:function(){return t.props.history.push("/register")}},"Registrarse")),n.a.createElement(se.a,{span:12,style:{justifyContent:"center",display:"flex"}},n.a.createElement(ie.a,{type:"primary",htmlType:"submit",disabled:(e=o(),Object.keys(e).some(function(t){return e[t]}))},"Acceder")))))))))}}]),t}(r.Component),le=re.a.create({name:"login_form"})(Object(L.b)()(ce)),ue=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).handleSubmit=function(e){e.preventDefault(),a.props.form.validateFields(function(e,t){e||(t.password===t.password2?a.validateEmail(t.email)?fetch("https://we.blacknosaur.com/auth/local/register",{method:"POST",headers:D(!0),body:JSON.stringify({username:t.userName,password:t.password,email:t.email,confirmed:!1})}).then(function(e){e.json().then(function(e){P(e),a.props.history.push("/nuevousuario")}).catch(function(e){return console.log(e)})}).catch(function(e){return console.log(e)}):a.setState({errorEmail:!0}):a.setState({errorPw:!0}))})},a.state={errorUser:!1,errorEmail:!1,errorPw:!1},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.props.form.validateFields()}},{key:"validateEmail",value:function(e){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(e).toLowerCase())}},{key:"render",value:function(){var e=this,t=this.props.form,a=t.getFieldDecorator,r=t.getFieldError,o=t.isFieldTouched,s=o("userName")&&r("userName"),i=o("email")&&r("email"),c=o("password")&&r("password"),l=o("password2")&&r("password2");return n.a.createElement(b.a,{style:{height:"100vh"}},n.a.createElement(te,{isLogged:!!A()},n.a.createElement(b.a.Content,{style:{display:"flex",justifyContent:"center",alignItems:"center"}},n.a.createElement(ae.a,{style:{width:450,maxWidth:"90%"}},n.a.createElement(re.a,{onSubmit:this.handleSubmit},n.a.createElement(re.a.Item,{validateStatus:s||this.state.errorUser?"error":"",help:s||""},a("userName",{rules:[{required:!0,message:"Introduce tu nombre de usuario"}]})(n.a.createElement(ne.a,{onChange:function(t){return e.setState({user:t.target.value})},prefix:n.a.createElement(w.a,{type:"user",style:{color:"rgba(0,0,0,.25)"}}),placeholder:"Nombre de usuario"}))),n.a.createElement(re.a.Item,{validateStatus:i||this.state.errorEmail?"error":"",help:i||""},a("email",{rules:[{required:!0,message:"Introduce tu email"}]})(n.a.createElement(ne.a,{onChange:function(t){return e.setState({email:t.target.value})},prefix:n.a.createElement(w.a,{type:"mail",style:{color:"rgba(0,0,0,.25)"}}),type:"email",placeholder:"Email"}))),n.a.createElement(re.a.Item,{validateStatus:c||this.state.errorPw?"error":"",help:c||""},a("password",{rules:[{required:!0,message:"Introduce tu contrase\xf1a"}]})(n.a.createElement(ne.a,{onChange:function(t){return e.setState({pw:t.target.value})},prefix:n.a.createElement(w.a,{type:"lock",style:{color:"rgba(0,0,0,.25)"}}),type:"password",placeholder:"Contrase\xf1a"}))),n.a.createElement(re.a.Item,{validateStatus:l||this.state.errorPw?"error":"",help:l||""},a("password2",{rules:[{required:!0,message:"Repite la contrase\xf1a"}]})(n.a.createElement(ne.a,{onChange:function(t){return e.setState({pw:t.target.value})},prefix:n.a.createElement(w.a,{type:"lock",style:{color:"rgba(0,0,0,.25)"}}),type:"password",placeholder:"Repetir contrase\xf1a"}))),n.a.createElement(re.a.Item,null,n.a.createElement(oe.a,null,n.a.createElement(se.a,{style:{justifyContent:"center",display:"flex"}},n.a.createElement(ie.a,{type:"primary",onClick:this.handleSubmit},"Registrarse")))))))))}}]),t}(r.Component),de=re.a.create({name:"register_form"})(ue),me=function(){return n.a.createElement(b.a,{style:{height:"100vh"}},n.a.createElement(te,{isLogged:!!A()},n.a.createElement(b.a.Content,{style:{display:"flex",justifyContent:"center",alignItems:"center"}},n.a.createElement(ae.a,{style:{width:450,maxWidth:"90%"}},n.a.createElement(v.a.Title,{style:{margin:0,textAlign:"center"}},"404!")))))},pe=(a(387),a(512)),fe=a(261),he=a.n(fe),ge=a(7),ye=a.n(ge),be=(a(388),a(250)),ve=a.n(be),Ee=a(265),je=a(527),ke=function(e){var t=e.component,a=e.onlyManager,r=void 0!==a&&a,o=Object(Ee.a)(e,["component","onlyManager"]),s=I();return n.a.createElement(f.a,Object.assign({},o,{render:function(e){return s&&(!r||r&&s.manager)?n.a.createElement(t,e):n.a.createElement(je.a,{to:{pathname:"/login",state:{from:e.location}}})}}))},Se=function(e){function t(){return Object(i.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return n.a.createElement(b.a,{style:{height:"100vh"}},n.a.createElement(te,{isLogged:!!A()},n.a.createElement("h1",null,"Home")))}}]),t}(r.Component),Ce=a(50),we=a(67),Oe=a(510),xe=a(511),_e=a(264),Ae=a(100),De=a(525),Ie=a(513),Pe=a(520),Ue=(I()&&'{\n    dias(where: { equipo: "'.concat(I().equipo,'" }){\n        _id\n        fecha\n        tipo\n        aprobado\n        user{\n            _id\n            username\n            avatar{\n                url\n            }\n        }\n    }\n}'),function(e){function t(){var e,a;Object(i.a)(this,t);for(var r=arguments.length,o=new Array(r),s=0;s<r;s++)o[s]=arguments[s];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).state={modalPedirDia:!1,dias:[],diasFilter:[],diasPorAprobar:[],festivos:[],festivosArrUTC:[],sel1:"libres",sel2:"global"},a.fetchDias=Object(y.a)(g.a.mark(function e(){return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.props.dispatch(J());case 2:a.organizarDias();case 3:case"end":return e.stop()}},e)})),a.organizarDias=function(){var e=a.props.dias,t=a.props.dias.filter(function(e){return"festivo"===e.tipo}).map(function(e){return Object(we.a)({},e,{fecha:ye.a.utc(e.fecha).hour(0).minute(0).seconds(0).milliseconds(0).format()})}),r=t.map(function(e){return ye.a.utc(e.fecha).hour(2).minute(0).seconds(0).milliseconds(0).format()});a.setState({dias:e,festivos:t,festivosArrUTC:r,diasFilter:a.filtrarDias(e),diasPorAprobar:e.filter(function(e){return!e.aprobado}).map(function(e){return Object(we.a)({},e,{key:e._id})})})},a.filtrarDias=function(e){var t="libres"===a.state.sel1?e.filter(function(e){return"libre"===e.tipo}):e.filter(function(e){return"remoto"===e.tipo});return"aprobados"===a.state.sel2?t.filter(function(e){return e.aprobado&&e.user._id===I()._id}):"pendientes"===a.state.sel2?t.filter(function(e){return!e.aprobado&&e.user._id===I()._id}):t.filter(function(e){return e.aprobado})},a.responderSolicitud=function(e,t){t?F("/dias/"+e._id,{method:"PUT",body:{aprobado:!0}}).then(function(t){E.a.success("Se ha aprobado la solicitud de ".concat(e.user.username," de d\xeda ").concat(e.tipo," el d\xeda ").concat(ye()(e.fecha).format("YYYY-MM-DD"))),a.fetchDias()}).catch(function(t){console.error(t),E.a.error("Se ha producido un error durante la aprobaci\xf3n del d\xeda ".concat(e.tipo," solicitado"))}):F("/dias/"+e._id,{method:"DELETE"}).then(function(t){E.a.info("Se ha denegado la solicitud de d\xeda "+e.tipo),a.fetchDias()}).catch(function(t){E.a.error("Se ha producido un error durante la denegaci\xf3n del d\xeda ".concat(e.tipo," solicitado")),console.error(t)})},a.getListData=function(e){return a.state.diasFilter.filter(function(t){return ye()(t.fecha).format("YYYYMMDD")===ye()(e).format("YYYYMMDD")}).map(function(e){return{user:e.user.username,fecha:ye()(e.fecha),avatar:e.user.avatar&&"https://we.blacknosaur.com"+e.user.avatar.url}})||[]},a.dateFullCellRender=function(e){var t=a.getListData(e),r=ye.a.utc(e.hour(2).minute(0).seconds(0).milliseconds(0)).format(),o=a.state.festivos.find(function(e){return ye.a.utc(e.fecha).format()===r}),s={title:o?o.nombre:e.format("LL"),color:o?"rgba(255, 40, 30, 0.5)":[0,6].includes(e.day())?"rgba(255, 200, 100, 0.5)":"transparent"};return n.a.createElement("div",{className:"ant-fullcalendar-date",style:{backgroundColor:s.color,margin:"-1px 0",borderRadius:3},title:s.title},n.a.createElement("div",{className:"ant-fullcalendar-value"},e.date()),n.a.createElement("div",{className:"ant-fullcalendar-content"},n.a.createElement("ul",{className:"events"},t.map(function(e){return n.a.createElement(Oe.a,{key:e.fecha,content:n.a.createElement("span",null,e.user)},n.a.createElement(S.a,{src:e.avatar?e.avatar:null},e.user[0].toUpperCase()))}))))},a.solicitarDia=function(e,t){var r=I(),n=r._id,o=r.equipo;console.log(I()),console.log(t),fetch("https://we.blacknosaur.com/dias",{method:"POST",headers:D(),body:JSON.stringify({fecha:e,tipo:t,user:n,equipo:o})}).then(function(e){e.json().then(function(e){console.log(e),E.a.info("Has solicitado como d\xeda ".concat(t," el ").concat(ye()(a.state.dia).format("DD/MM/YYYY"),". Tu solicitud est\xe1 pendiente de aprobaci\xf3n")),a.fetchDias(),a.setState({modalPedirDia:!1,dias:[].concat(Object(Ce.a)(a.state.dias),[e])})}).catch(function(e){return console.log(e)})}).catch(function(e){return console.log(e)})},a.lanzarModalDia=function(e){var t=a.state.dias.filter(function(e){return e.user&&e.user._id===I()._id});if(ye()().isSameOrBefore(e,"day"))if(void 0===a.state.festivos.find(function(t){return ye()(t.fecha).isSame(e,"day")})){var r=t.find(function(t){return ye()(t.fecha).isSame(e,"day")});r?r.aprobado||E.a.warning("La solicitud de ese d\xeda todav\xeda se encuentra pendiente de aprobaci\xf3n"):a.setState({dia:e,modalPedirDia:!0})}else E.a.warning("No puedes solicitar un d\xeda festivo");else E.a.warning("No puedes solicitar un d\xeda pasado")},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=[{title:"Nombre de usuario",key:"user",render:function(e){return e.user&&e.user.username}},{title:"Tipo",dataIndex:"tipo",key:"tipo"},{title:"Fecha",key:"fecha",render:function(e){return ye()(e.fecha).format("YYYY-MM-DD")}},{title:"Acci\xf3n",key:"action",render:function(t,a){return n.a.createElement("span",null,n.a.createElement(xe.a,{title:"\xbfEst\xe1s seguro de que deseas aceptar la solicitud de d\xeda ".concat(a.tipo," para el d\xeda ").concat(ye()(a.fecha).format("YYYY-MM-DD")," a ").concat(a.user&&a.user.username,"?"),onConfirm:function(t){return e.responderSolicitud(a,!0)}},n.a.createElement(_e.a,{color:"green",key:"".concat(a._id,"_aceptar")},"Aprobar")),n.a.createElement(xe.a,{title:"\xbfEst\xe1s seguro de que deseas denegar la solicitud de d\xeda ".concat(a.tipo," para el d\xeda ").concat(ye()(a.fecha).format("YYYY-MM-DD")," a ").concat(a.user&&a.user.username,"?"),onConfirm:function(t){return e.responderSolicitud(a,!1)}},n.a.createElement(_e.a,{color:"volcano",key:"".concat(a._id,"_denegar")},"Denegar")))}}];this.setState({columns:t}),this.props.dias&&this.organizarDias()}},{key:"componentDidUpdate",value:function(e,t){t.sel1!==this.state.sel1||t.sel2!==this.state.sel2?this.setState({diasFilter:this.filtrarDias(this.state.dias)}):e.dias!==this.props.dias&&this.organizarDias()}},{key:"render",value:function(){var e=this;return n.a.createElement(b.a,{style:{height:"100vh"}},n.a.createElement(te,{isLogged:!!A()},n.a.createElement(oe.a,{style:{justifyContent:"space-around",display:"flex"}},n.a.createElement(Ae.a.Group,{defaultValue:this.state.sel1,buttonStyle:"solid"},n.a.createElement(Ae.a.Button,{onClick:function(){return e.setState({sel1:"libres"})},value:"libres"},"Libres"),n.a.createElement(Ae.a.Button,{onClick:function(){return e.setState({sel1:"remotos"})},value:"remotos"},"Remotos")),n.a.createElement(Ae.a.Group,{defaultValue:this.state.sel2,buttonStyle:"solid"},n.a.createElement(Ae.a.Button,{onClick:function(){return e.setState({sel2:"global"})},value:"global"},"Global aprobados"),n.a.createElement(Ae.a.Button,{onClick:function(){return e.setState({sel2:"aprobados"})},value:"aprobados"},"Mis d\xedas aprobados"),n.a.createElement(Ae.a.Button,{onClick:function(){return e.setState({sel2:"pendientes"})},value:"pendientes"},"Mis d\xedas pendientes de aprobaci\xf3n"))),n.a.createElement(De.a,{onSelect:function(t){return e.lanzarModalDia(t)},dateFullCellRender:this.dateFullCellRender,style:{margin:"-1px 0"}}),n.a.createElement(W,null,n.a.createElement("h1",null,"D\xedas pendientes de revisi\xf3n"),n.a.createElement(Ie.a,{dataSource:this.state.diasPorAprobar,columns:this.state.columns||[]}))),n.a.createElement(Pe.a,{visible:this.state.modalPedirDia,onCancel:function(){return e.setState({modalPedirDia:!1})},footer:[n.a.createElement(ie.a,{key:"libre",onClick:function(){return e.solicitarDia(e.state.dia,"libre")}},"D\xeda libre"),n.a.createElement(ie.a,{key:"remoto",type:"primary",onClick:function(){return e.solicitarDia(e.state.dia,"remoto")}},"D\xeda remoto")]},n.a.createElement("p",null,"Solicitar el d\xeda ",ye()(this.state.dia).format("DD/MM/YYYY")," como... ")))}}]),t}(r.Component)),Le=Object(L.b)(function(e){return{dias:e.dias}})(Ue),Te=v.a.Title,Me='{\n    equipos(where: {nombre: "$nombre$"}){\n        _id\n    }\n}',qe=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).solicitarAcceso=function(e){e.preventDefault(),a.props.form.validateFields(function(e,t){fetch("https://we.blacknosaur.com"+_(Me,{nombre:t.unirse}),{headers:D()}).then(function(e){console.log(e),e.json().then(function(e){console.log(e),e.data.equipos[0]?fetch("https://we.blacknosaur.com/users/"+I()._id,{method:"PUT",headers:D(),body:JSON.stringify({equipo:e.data.equipos[0]._id,confirmed:!1})}).then(function(e){console.log(e),e.ok&&E.a.info('Se ha solicitado con \xe9xito el acceso al equipo "'.concat(t.unirse,'"'))}):E.a.error('No se ha encontrado ning\xfan equipo "'.concat(t.unirse,'"'))}).catch(function(e){return console.log(e)})}).catch(function(e){return console.log(e)})})},a.crearEquipo=function(e){e.preventDefault(),a.props.form.validateFields(function(e,t){fetch("https://we.blacknosaur.com/equipos",{method:"POST",headers:D(),body:JSON.stringify({nombre:t.crear,users:[I()._id]})}).then(function(e){e.json().then(function(e){fetch("https://we.blacknosaur.com/users/"+I()._id,{method:"PUT",headers:D(),body:JSON.stringify({confirmed:!0,manager:!0})}).then(function(){a.props.history.push("/")})}).catch(function(e){console.log(e),E.a.error("Se ha producido un error al asignar el usuario al equipo recien creado")})}).catch(function(e){console.log(e),E.a.error("Se ha producido un error al crear el equipo")})})},a.state={errorUser:!1,errorEmail:!1,errorPw:!1},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this,t=this.props.form,a=t.getFieldDecorator,r=t.getFieldError,o=t.isFieldTouched,s=o("unirse")&&r("unirse"),i=o("crear")&&r("crear");return n.a.createElement(b.a,{style:{height:"100vh"}},n.a.createElement(te,{isLogged:!!A()},n.a.createElement(b.a.Content,{style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"}},n.a.createElement(re.a,{onSubmit:this.handleSubmit},n.a.createElement(ae.a,{style:{width:450,maxWidth:"90%",marginBottom:"1em"}},n.a.createElement(Te,{level:2},"Unirse a un equipo"),n.a.createElement(re.a.Item,{validateStatus:s||this.state.errorUnirse?"error":"",help:s||""},a("unirse",{rules:[{required:!0,message:"Introduce el nombre del equipo"}]})(n.a.createElement(ne.a,{onChange:function(t){return e.setState({pw:t.target.value})},prefix:n.a.createElement(w.a,{type:"team",style:{color:"rgba(0,0,0,.25)"}}),type:"text",placeholder:"Nombre del equipo al que te quieres unir"}))),n.a.createElement(re.a.Item,null,n.a.createElement(oe.a,null,n.a.createElement(se.a,{style:{justifyContent:"center",display:"flex"}},n.a.createElement(ie.a,{type:"primary",onClick:this.solicitarAcceso},"Solicitar acceso"))))),n.a.createElement(ae.a,{style:{width:450,maxWidth:"90%"}},n.a.createElement(Te,{level:2},"Crear un equipo"),n.a.createElement(re.a.Item,{validateStatus:i||this.state.errorCrear?"error":"",help:i||""},a("crear",{rules:[{required:!0,message:"Introduce el nombre del equipo"}]})(n.a.createElement(ne.a,{onChange:function(t){return e.setState({pw:t.target.value})},prefix:n.a.createElement(w.a,{type:"usergroup-add",style:{color:"rgba(0,0,0,.25)"}}),type:"password",placeholder:"Nombre del equipo a crear"}))),n.a.createElement(re.a.Item,null,n.a.createElement(oe.a,null,n.a.createElement(se.a,{style:{justifyContent:"center",display:"flex"}},n.a.createElement(ie.a,{type:"primary",onClick:this.crearEquipo},"Crear equipo")))))))))}}]),t}(r.Component),Ne=re.a.create({name:"nuevousuario_form"})(qe),Re=a(517),Ye=a(93),Be=a(519),Fe=a(58),He='{\nuser(id:"$userId$"){\n    documentos{\n        _id\n    }\n}}',Je=function(e){function t(){var e,a;Object(i.a)(this,t);for(var r=arguments.length,o=new Array(r),s=0;s<r;s++)o[s]=arguments[s];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).state={fileList:[],asociarA:[],userInfo:I(),selectedUser:{documentos:[]},disponibleParaTodos:!0,columns:[{title:"Nombre de usuario",dataIndex:"username",key:"username"},{title:"Email",dataIndex:"email",key:"email"}],misArchColumns:[{title:"Nombre de archivo",dataIndex:"name",key:"name"},{key:"archivo",render:function(e){return n.a.createElement("div",{key:e._id,style:{display:"flex",justifyContent:"flex-end"}},n.a.createElement("a",{href:"https://we.blacknosaur.com"+e.url,target:"_blank",rel:"noopener noreferrer"},n.a.createElement(_e.a,{color:"geekblue",key:"".concat(e._id,"_file")},n.a.createElement(w.a,{type:"file-text"})," Enlace")),n.a.createElement(xe.a,{title:"\xbfEst\xe1s seguro de que deseas desvincular ".concat(e.name," de ").concat(a.state.selectedUser.username,"?"),onConfirm:function(){return a.desvincularArchivo(e,a.state.selectedUser)}},n.a.createElement(_e.a,{color:"orange",key:"".concat(e._id,"_file")},n.a.createElement(w.a,{type:"disconnect"})," Desvincular")),n.a.createElement(xe.a,{title:"\xbfEst\xe1s seguro de que deseas borrar ".concat(e.name,"? Esto borrar\xe1 el archivo para todos los usuarios"),onConfirm:function(){return a.borrarArchivo(e)},icon:n.a.createElement(w.a,{type:"warning",style:{color:"red"}})},n.a.createElement(_e.a,{color:"volcano",key:"".concat(e._id,"_file")},n.a.createElement(w.a,{type:"delete"})," Borrar")))}}],archGlobColumns:[{title:"Nombre de archivo",dataIndex:"name",key:"name"},{key:"archivo",render:function(e){return n.a.createElement("div",{key:e._id,style:{display:"flex",justifyContent:"flex-end"}},n.a.createElement("a",{href:"https://we.blacknosaur.com"+e.url,target:"_blank",rel:"noopener noreferrer"},n.a.createElement(_e.a,{color:"geekblue",key:"".concat(e._id,"_file")},n.a.createElement(w.a,{type:"file-text"})," Enlace")),n.a.createElement(xe.a,{title:"\xbfEst\xe1s seguro de que deseas borrar ".concat(e.name,"? Esto borrar\xe1 el archivo para todos los usuarios"),onConfirm:function(){return a.borrarArchivo(e)},icon:n.a.createElement(w.a,{type:"warning",style:{color:"red"}})},n.a.createElement(_e.a,{color:"volcano",key:"".concat(e._id,"_file")},n.a.createElement(w.a,{type:"delete"})," Borrar")))}}],archUserColumns:[{title:"Nombre de archivo",dataIndex:"name",key:"name"},{key:"archivo",render:function(e){return n.a.createElement("div",{key:e._id,style:{display:"flex",justifyContent:"flex-end"}},n.a.createElement("a",{href:"https://we.blacknosaur.com"+e.url,target:"_blank",rel:"noopener noreferrer"},n.a.createElement(_e.a,{color:"geekblue",key:"".concat(e._id,"_file")},n.a.createElement(w.a,{type:"file-text"})," Enlace")))}}]},a.rowSelection={onChange:function(e,t){a.setState({asociarA:t.map(function(e){return e._id})})},getCheckboxProps:function(e){return{disabled:"Disabled User"===e.name,name:e.name}}},a.desvincularArchivo=function(){var e=Object(y.a)(g.a.mark(function e(t,r){var n,o,s;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.state.selectedUser.documentos.find(function(e){return e.archivo._id===t._id})._id,e.next=3,F("/documentos/"+n);case 3:o=e.sent,s=o.users.filter(function(e){return e._id!==r._id}),F("/documentos/"+n,{method:"PUT",body:{users:s}}).then(function(e){E.a.info("El archivo se desvincul\xf3 correctamente"),a.props.dispatch(z())}).catch(function(e){console.log(e),E.a.error("Se produjo un error durante la desvinculaci\xf3n del documento")});case 6:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}(),a.borrarArchivo=function(){var e=Object(y.a)(g.a.mark(function e(t){var r;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=a.props.documentos.find(function(e){return e.archivo._id===t._id})._id,F("/upload/files/"+t._id,{method:"DELETE"}).then(function(e){F("/documentos/"+r,{method:"DELETE"}).then(function(e){E.a.info("El archivo se borr\xf3 correctamente"),a.props.dispatch(z())}).catch(function(e){console.log(e),E.a.error("Se produjo un error durante el borrado del documento")})}).catch(function(e){console.log(e),E.a.error("Se produjo un error durante el borrado del documento")});case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.handleUpload=Object(y.a)(g.a.mark(function e(){var t,r,n;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=a.state.fileList.map(function(){var e=Object(y.a)(g.a.mark(function e(t){var r,n;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(),e.next=3,F("/documentos",{method:"POST",body:{global:a.state.disponibleParaTodos}});case 3:return r=e.sent,(n=new FormData).append("ref","documento"),n.append("refId",r._id),n.append("field","archivo"),n.append("files",t),F("/upload",{method:"POST",headers:{Authorization:"Bearer "+A()},body:n},!1),e.abrupt("return",r._id);case 11:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),e.next=4,Promise.all(t);case 4:r=e.sent,console.log(r),0!==a.state.asociarA.length||a.state.disponibleParaTodos?a.state.disponibleParaTodos?(E.a.info("Los documentos se han subido correctamente"),a.props.dispatch(z()),a.setState({mostrarListaUsuarios:!1,fileList:[]})):(n=a.state.asociarA.map(function(){var e=Object(y.a)(g.a.mark(function e(t){var a;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,F(_(He,{userId:t}));case 2:return a=e.sent.data.user.documentos,e.abrupt("return",F("/users/"+t,{method:"PUT",body:{documentos:[].concat(Object(Ce.a)(a),Object(Ce.a)(r))}}));case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),Promise.all(n).then(function(){E.a.info("Los documentos se han subido correctamente"),a.props.dispatch(z()),a.setState({mostrarListaUsuarios:!1,fileList:[]})})):E.a.error("El documento no est\xe1 asociado a ning\xfan usuario"),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(0),console.log(e.t0),E.a.error("Ocurri\xf3 un error durante la subida de documentos");case 13:case"end":return e.stop()}},e,null,[[0,9]])})),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.setState({selectedUser:this.props.usuarios.find(function(e){return e.username===I().username})})}},{key:"componentDidUpdate",value:function(e){e.usuarios!==this.props.usuarios&&this.setState({selectedUser:this.props.usuarios.find(function(e){return e.username===I().username})})}},{key:"render",value:function(){var e=this;return n.a.createElement(b.a,{style:{height:"100vh"}},n.a.createElement(te,{isLogged:!!A()},n.a.createElement("h1",null,"Documentos"),this.state.userInfo.manager&&!this.props.blueCollar&&[n.a.createElement("div",{key:"sa",style:{marginBottom:50}},n.a.createElement("h2",null,"Subir archivo"),n.a.createElement("div",{style:{width:"320px",marginBottom:20}},n.a.createElement(Re.a.Dragger,{name:"file",action:"https://we.blacknosaur.com/upload",multiple:!0,onChange:function(t){var a=t.file.status;"uploading"!==a&&0===t.fileList.length&&e.setState({mostrarListaUsuarios:!1}),"done"===a?E.a.success("".concat(t.file.name," se ha subido correctamente.")):"error"===a&&E.a.error("La subida de ".concat(t.file.name," fall\xf3."))},beforeUpload:function(t,a){return e.setState({fileList:a,mostrarListaUsuarios:!0}),!1},fileList:this.state.fileList,onRemove:function(t){var a=e.state.fileList.filter(function(e){return e.uid!==t.uid});e.setState({fileList:a,mostrarListaUsuarios:a.length>0})}},n.a.createElement(w.a,{type:"inbox"}),n.a.createElement("p",null,"Arrastra documentos aqu\xed"))),this.state.mostrarListaUsuarios&&n.a.createElement("div",{style:{display:"flex",flexDirection:"column"}},n.a.createElement(Ye.a,{style:{marginBottom:20},checked:this.state.disponibleParaTodos,onChange:function(t){return e.setState({disponibleParaTodos:t.target.checked})}},"Disponible para todos los usuarios"),n.a.createElement(Be.a,{className:"sinCabecera",bordered:!1,activeKey:this.state.disponibleParaTodos?"0":"1"},n.a.createElement(Be.a.Panel,{key:"1"},n.a.createElement("h3",{key:"asociarTitle"},"Asociar archivo a:"),n.a.createElement(Ie.a,{key:"asociarTabla",rowSelection:this.rowSelection,dataSource:this.props.usuarios,columns:this.state.columns}))),n.a.createElement("div",null,n.a.createElement(ie.a,{onClick:this.handleUpload},"Subir documentos")))),n.a.createElement("div",{key:"apu"},n.a.createElement("h2",null,"Archivos por usuario"),n.a.createElement(Fe.a,{showSearch:!0,style:{width:200,marginBottom:20},placeholder:"Selecciona un usuario",defaultValue:I().username,optionFilterProp:"children",onChange:function(t){var a=e.props.usuarios.find(function(e){return e.username===t});e.setState({selectedUser:a})},filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},this.props.usuarios.map(function(e){return n.a.createElement(Fe.a.Option,{value:e.username,key:e._id},e.username)})),this.state.selectedUser&&n.a.createElement(Ie.a,{dataSource:this.props.documentos.filter(function(t){return t.users.map(function(e){return e._id}).includes(e.state.selectedUser._id)}).map(function(e){return e.archivo}),columns:this.state.misArchColumns,rowKey:"_id"}),n.a.createElement("h2",{style:{marginTop:20}},"Archivos globales"),n.a.createElement(Ie.a,{dataSource:this.props.documentos.filter(function(e){return e.global}).map(function(e){return e.archivo}),columns:this.state.archGlobColumns,rowKey:"_id"}))],(!this.state.userInfo.manager||this.props.blueCollar)&&n.a.createElement("div",null,n.a.createElement("h2",null,"Mis archivos"),n.a.createElement(Ie.a,{dataSource:this.props.documentos.filter(function(t){return e.state.userInfo.documentos.includes(t._id)||t.global}).map(function(e){return e.archivo}),columns:this.state.archUserColumns,rowKey:"_id"}))))}}]),t}(r.Component),Ge=Object(L.b)(function(e){return{usuarios:e.usuarios,documentos:e.documentos,blueCollar:e.blueCollar}})(Je),ze=a(91),We=function(e){function t(){var e,a;Object(i.a)(this,t);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={columns:[],extraColumnsA:[],extraColumnsA2:[],extraColumnsB:[]},a.filtraUsuarios=function(e){var t=a.props.usuarios.filter(function(e){return e.confirmed}).map(function(e){return Object(we.a)({},e,{key:e._id})}),r=a.props.usuarios.filter(function(e){return!e.confirmed}).map(function(e){return Object(we.a)({},e,{key:e._id})});a.setState({activos:t,pendientes:r})},a.fetchUsers=Object(y.a)(g.a.mark(function e(){return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.props.dispatch(H());case 2:a.filtraUsuarios(a.props.usuarios);case 3:case"end":return e.stop()}},e)})),a.responderSolicitud=function(e,t){t?F("/users/"+e._id,{method:"PUT",body:{confirmed:!0}}).then(function(t){E.a.success("\xa1".concat(e.email," ahora forma parte del equipo ").concat(e.equipo.nombre,"!")),a.fetchUsers()}).catch(function(e){console.error(e),E.a.error("Se ha producido un error durante la confirmaci\xf3n de la solicitud del usuario")}):F("/users/"+e._id,{method:"DELETE"}).then(function(e){E.a.info("La solicitud se ha denegado correctamente"),a.fetchUsers()}).catch(function(e){E.a.error("Se ha producido un error durante la denegaci\xf3n de la solicitud del usuario"),console.error(e)})},a.desasociarTarjeta=function(e){console.log(e),F("/users/"+e._id,{method:"PUT",body:{idcard:""}}).then(function(){return a.fetchUsers()})},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=I.manager?[{title:"Manager",dataIndex:"manager",render:function(e){return e?n.a.createElement(w.a,Object(ze.a)({type:"check-circle",theme:"twoTone",twoToneColor:"#eb2f96"},"twoToneColor","#52c41a")):n.a.createElement(w.a,{type:"close-circle",theme:"twoTone",twoToneColor:"#eb2f96"})}},{title:"ID Tarjeta",key:"idcard",render:function(t,a){return a.idcard?n.a.createElement("div",null,n.a.createElement("span",null,a.idcard,"\xa0\xa0"),n.a.createElement(xe.a,{title:"\xbfEst\xe1s seguro de que deseas desasociar la tarjeta de ".concat(a.email,"?"),onConfirm:function(t){return e.desasociarTarjeta(a)}},n.a.createElement(_e.a,{color:"volcano",key:"".concat(a._id,"_denegar")},n.a.createElement(w.a,{type:"delete"})))):n.a.createElement(ie.a,{type:"primary",onClick:function(){return e.setState({modalAsociar:!0,usuarioAsociar:a._id})}},"Asociar tarjeta")}}]:[],a=[{key:"btn",render:function(e,t){return n.a.createElement(O.a,{to:"/usuario/"+t._id},n.a.createElement(_e.a,{key:"".concat(t._id,"_denegar")},n.a.createElement(w.a,{type:"user"})," Editar"))}}],r=[{title:"Acci\xf3n",key:"action",render:function(t,a){return n.a.createElement("span",null,n.a.createElement(xe.a,{title:"\xbfEst\xe1s seguro de que deseas aceptar en ".concat(a.equipo&&a.equipo.nombre," a ").concat(a.email,"?"),onConfirm:function(t){return e.responderSolicitud(a,!0)}},n.a.createElement(_e.a,{color:"green",key:"".concat(a._id,"_aceptar")},"Aceptar")),n.a.createElement(xe.a,{title:"\xbfEst\xe1s seguro de que deseas denegar la solicitud de ".concat(a.email," para entrar en ").concat(a.equipo&&a.equipo.nombre,"?"),onConfirm:function(t){return e.responderSolicitud(a,!1)}},n.a.createElement(_e.a,{color:"volcano",key:"".concat(a._id,"_denegar")},"Denegar")))}}];this.setState({columns:[{title:"Nombre de usuario",dataIndex:"username",key:"username"},{title:"Email",dataIndex:"email",key:"email"}],extraColumnsA:t,extraColumnsA2:a,extraColumnsB:r}),this.props.usuarios&&this.filtraUsuarios(this.props.usuarios)}},{key:"componentDidUpdate",value:function(e,t){var a=this;e.usuarios!==this.props.usuarios?this.filtraUsuarios(this.props.usuarios):t.modalAsociar!==this.state.modalAsociar&&(this.state.modalAsociar?this.props.socket.on("notification",function(e){console.log(e),a.props.usuarios.map(function(e){return e.idcard}).includes(e.es)?E.a.error("Esa tarjeta ya est\xe1 asociada a un usuario. Desasociela antes de reasignarla."):F("/users/"+a.state.usuarioAsociar,{method:"PUT",body:{idcard:e.es&&e.es.idcard}}).then(function(e){E.a.info("La tarjeta ha sido asociada correctamente"),a.fetchUsers(),a.setState({modalAsociar:!1,usuarioAsociar:void 0})}).catch(function(e){E.a.error("Se produjo un error durante el proceso de asociaci\xf3n de la tarjeta"),console.log(e),a.setState({modalAsociar:!1,usuarioAsociar:void 0})})}):this.props.socket.off("notification"))}},{key:"render",value:function(){var e=this,t=this.state,a=t.activos,r=t.pendientes,o=t.columns,s=t.extraColumnsA,i=t.extraColumnsA2,c=t.extraColumnsB;return n.a.createElement(b.a,{style:{height:"100vh"}},n.a.createElement(te,{isLogged:!!A()},n.a.createElement("h1",null,"Usuarios activos"),n.a.createElement(Ie.a,{dataSource:a,columns:[].concat(Object(Ce.a)(o),Object(Ce.a)(s),Object(Ce.a)(i))}),I.manager&&[n.a.createElement("h1",{key:"pendAprobTitle"},"Usuarios pendientes de aprobaci\xf3n"),n.a.createElement(Ie.a,{key:"pendAprobTable",dataSource:r,columns:[].concat(Object(Ce.a)(o),Object(Ce.a)(c))})]),n.a.createElement(Pe.a,{visible:this.state.modalAsociar,onOk:function(e){return e},onCancel:function(){return e.setState({modalAsociar:!1,usuarioAsociar:void 0})},footer:[n.a.createElement(ie.a,{key:"back",type:"primary",onClick:function(){return e.setState({modalAsociar:!1,usuarioAsociar:void 0})}},"Cancelar")]},n.a.createElement("p",null,"Acerca la tarjeta al lector sin cerrar esta ventana para asociarla al usuario")))}}]),t}(r.Component),Ve=Object(U.socketConnect)(Object(L.b)(function(e){return{usuarios:e.usuarios}})(We)),Ke=function(e){function t(){var e,a;Object(i.a)(this,t);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={usuario:{},duracionjornada:"",frasesStr:"",frases:[],frasePr:"",frasePrAct:!1,manager:void 0},a.guardarDatos=function(){a.state.duracionjornada>0&&a.state.duracionjornada<24?F("/users/"+a.state.usuario._id,{method:"PUT",body:{frases:a.state.frases.filter(function(e){return![void 0,null,""].includes(e)}),frasePrioritaria:a.state.frasePr,actFrasePrioritaria:a.state.frasePrAct,manager:a.state.manager,duracionjornada:a.state.duracionjornada}}).then(function(e){E.a.success("Los cambios se guardaron correctamente"),a.props.dispatch(G()),a.props.dispatch(H())}).catch(function(e){console.log(e),E.a.error("Se produjo un error durante el guardado")}):E.a.error("La duraci\xf3n media de la jornada ha de estar entre 0 y 24")},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this;if(this.props.usuarios.length>0){var t=this.props.usuarios.find(function(t){return t._id===e.props.match.params.id});console.log(t),this.setState({duracionjornada:t.duracionjornada,frasesStr:t.frases.reduce(function(e,t){return e+t+"\n"},""),frases:t.frases,frasePr:t.frasePrioritaria,frasePrAct:t.actFrasePrioritaria,manager:t.manager,usuario:t})}}},{key:"componentDidUpdate",value:function(e,t){var a=this;if(this.props.usuarios&&this.props.usuarios!==e.usuarios){var r=this.props.usuarios.find(function(e){return e._id===a.props.match.params.id});console.log(r),this.setState({duracionjornada:r.duracionjornada,frasesStr:r.frases.reduce(function(e,t){return e+t+"\n"},""),frases:r.frases,frasePr:r.frasePrioritaria,frasePrAct:r.actFrasePrioritaria,manager:r.manager,usuario:r})}else this.state.frasesStr!==t.frasesStr&&this.setState({frases:this.state.frasesStr.split(/\n/gm)})}},{key:"render",value:function(){var e=this,t=this.state.usuario;return n.a.createElement(b.a,{style:{height:"100vh"}},n.a.createElement(te,{isLogged:!!A()},n.a.createElement("h1",null,t.username),I.manager&&[n.a.createElement(re.a.Item,{key:"editUserJornada",label:"Duraci\xf3n media de su jornada laboral"},n.a.createElement(ne.a,{type:"number",value:this.state.duracionjornada,onChange:function(t){return e.setState({duracionjornada:t.target.value})}})),n.a.createElement(re.a.Item,{key:"editUserManager",label:"Manager"},n.a.createElement(Ae.a.Group,{value:this.state.manager},n.a.createElement(Ae.a.Button,{value:!0,onClick:function(){return e.setState({manager:!0})}},"S\xed"),n.a.createElement(Ae.a.Button,{value:!1,onClick:function(){return e.setState({manager:!1})}},"No")))],n.a.createElement(re.a.Item,{label:"Frases (una por l\xednea)"},n.a.createElement(ne.a.TextArea,{rows:6,value:this.state.frasesStr,onChange:function(t){return e.setState({frasesStr:t.target.value})}})),n.a.createElement(re.a.Item,{label:"Frase prioritaria"},n.a.createElement(ne.a,{type:"text",value:this.state.frasePr,onChange:function(t){return e.setState({frasePr:t.target.value})}}),n.a.createElement(Ae.a.Group,{value:this.state.frasePrAct},n.a.createElement(Ae.a.Button,{value:!0,onClick:function(){return e.setState({frasePrAct:!0})}},"Activada"),n.a.createElement(Ae.a.Button,{value:!1,onClick:function(){return e.setState({frasePrAct:!1})}},"Desactivada"))),n.a.createElement(ie.a,{onClick:this.guardarDatos},"Guardar")))}}]),t}(r.Component),$e=Object(L.b)(function(e){return{usuarios:e.usuarios}})(Ke),Ze=function(e){function t(){return Object(i.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return n.a.createElement(b.a,{style:{height:"100vh"}},n.a.createElement(te,{isLogged:!!A()},n.a.createElement("h1",null,"Analitica")))}}]),t}(r.Component),Qe=a(515),Xe=a(262),et=a(521),tt=a(263),at=function(e){function t(){var e,a;Object(i.a)(this,t);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).addRegistro=Object(y.a)(g.a.mark(function e(){var t,r,n,o,s,i,c,l;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.props.usuario||a.state.selectedUser._id||void 0,[a.state.fechaNuevoRegistro,a.state.horaEntradaNuevoRegistro,a.state.horaSalidaNuevoRegistro,t].includes(void 0)){e.next=33;break}if(r=a.state.fechaNuevoRegistro.clone().hour(a.state.horaEntradaNuevoRegistro.hour()).minute(a.state.horaEntradaNuevoRegistro.minute()),n=a.state.fechaNuevoRegistro.clone().hour(a.state.horaSalidaNuevoRegistro.hour()).minute(a.state.horaSalidaNuevoRegistro.minute()),o=r.isBefore(ye()()),s=n.isBefore(ye()()),i=r.isBefore(n),!(o&&s&&i)){e.next=28;break}return c={user:t,fecha:ye.a.utc(r).format(),ultimoEditor:I()._id,aprobado:!!I().manager},l={user:t,fecha:ye.a.utc(n).format(),ultimoEditor:I()._id,aprobado:!!I().manager},e.prev=10,e.next=13,F("/registros",{method:"POST",body:c});case 13:return e.sent,e.next=16,F("/registros",{method:"POST",body:l});case 16:e.sent,!0===I().manager?E.a.success("El registro se a\xf1adi\xf3 correctamente"):E.a.success("El registro se a\xf1adi\xf3 correctamente, actualmente est\xe1 pendiente de aprobaci\xf3n"),a.props.cerrarModal&&a.props.cerrarModal(),a.setState({fechaNuevoRegistro:void 0,horaEntradaNuevoRegistro:void 0,horaSalidaNuevoRegistro:void 0}),e.next=26;break;case 22:e.prev=22,e.t0=e.catch(10),console.log(e.t0),E.a.error("Se produjo un error durante el guardado del registro");case 26:e.next=31;break;case 28:o||E.a.error("La hora de entrada es inv\xe1lida"),s||E.a.error("La hora de salida es inv\xe1lida"),i||E.a.error("La hora de entrada ha de ser anterior a la de salida");case 31:e.next=34;break;case 33:E.a.warning("Faltan campos por completar");case 34:case"end":return e.stop()}},e,null,[[10,22]])})),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this,t=Fe.a.Option;return n.a.createElement("div",null,n.a.createElement("div",{style:{display:"flex",justifyContent:"space-between",flexWrap:"wrap"}},!this.props.usuario&&n.a.createElement(re.a.Item,{label:"Usuario"},n.a.createElement(Fe.a,Object(ze.a)({showSearch:!0,style:{width:200,marginBottom:20},placeholder:"Selecciona un usuario",optionFilterProp:"children",onChange:function(t){var a=e.props.usuarios.find(function(e){return e.username===t});e.setState({selectedUser:a})},filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},"style",{width:250}),this.props.usuarios.map(function(e){return n.a.createElement(t,{value:e.username,key:e._id},e.username)}))),n.a.createElement(re.a.Item,{label:"Fecha"},n.a.createElement(Qe.a,{onChange:function(t){return e.setState({fechaNuevoRegistro:t})},style:{width:250}})),n.a.createElement(re.a.Item,{label:"Hora de entrada"},n.a.createElement(tt.a,{onChange:function(t){return e.setState({horaEntradaNuevoRegistro:t})},style:{width:250}})),n.a.createElement(re.a.Item,{label:"Hora de salida"},n.a.createElement(tt.a,{onChange:function(t){return e.setState({horaSalidaNuevoRegistro:t})},style:{width:250}}))),n.a.createElement(ie.a,{onClick:this.addRegistro},"A\xf1adir registro"))}}]),t}(r.Component),rt=Object(L.b)(function(e){return{usuarios:e.usuarios}})(at),nt=function(e){function t(){var e,a;Object(i.a)(this,t);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={usuarios:[],userInfo:I(),mes:ye()(),modalVisible:!1,modalLoading:!1},a.columns=[{title:"Entrada",dataIndex:"entrada",key:"entrada",defaultSortOrder:"descend",sorter:function(e,t){return ye()(e.entrada).diff(ye()(t.entrada))},render:function(e){return ye()(e).format("YYYY-MM-DD, HH:mm")}},{title:"Salida",dataIndex:"salida",key:"salida",sorter:function(e,t){return ye()(e.entrada).diff(ye()(t.entrada))},render:function(e){return"-"!==e?ye()(e).format("YYYY-MM-DD, HH:mm"):"-"}},{title:"Tiempo trabajado",dataIndex:"horas",key:"horas",sorter:function(e,t){return e.horas-t.horas},render:function(e){return"-"!==e?Math.trunc(e,10)+"h "+Math.round(e%1*60)+"m":"-"}},{title:"Tiempo de descanso",dataIndex:"tiempoDescanso",key:"tiempoDescanso",sorter:function(e,t){return e.tiempoDescanso-t.tiempoDescanso},render:function(e){return"-"!==e?Math.trunc(e,10)+"h "+Math.round(e%1*60)+"m":"-"}}],a.diasLaborables=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ye()().month()+1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ye()().year(),n=a.props.dias.filter(function(e){return"festivo"===e.tipo&&ye()(e.fecha).month()===t}).length;return Array(ye()().month(t).year(r).daysInMonth()).fill(null).filter(function(e,a){return ye()().year(r).month(t).date(a+1).weekday()<=4}).length-a.props.dias.filter(function(a){return a.user&&a.user._id===e&&!0===a.aprobado&&ye()(a.fecha).month()===t}).length-n},a.procesaES=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ye()().month()+1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ye()().year(),r=ye()().month(e-1).year(t).daysInMonth(),n=a.props.es.map(function(n){var o=n.duracionjornada||8,s=a.diasLaborables(n._id,e,t),i=Array(r).fill(null).map(function(e,t){return ye()().subtract(t,"days").format("YYYY-MM-DD")}).map(function(e){return n.registros.filter(function(t){return ye()(t.fecha).isSame(ye()(e),"days")&&ye()(t.fecha).isSame(a.state.mes,"month")}).sort(function(e,t){return ye()(e.fecha).isBefore(ye()(t.fecha))?-1:ye()(t.fecha).isBefore(ye()(e.fecha))?1:0})}).map(function(e,t){var a=Array(Math.ceil(e.length/2)).fill(null).map(function(a,r){var o=ye()(e[2*r].fecha),s=e[2*r+1]?ye()(e[2*r+1].fecha):void 0,i=s?ye.a.duration(s.diff(o)):o.isSame(ye()(),"day")?ye.a.duration(ye()().diff(o)):"-",c="-"!==i?Math.round(100*i.as("hours"))/100:"-";return{key:n._id+"-"+t+"-"+r,entrada:o.format(),aprobado:!(!e[2*r].aprobado||e[2*r+1]&&!e[2*r+1].aprobado),salida:s?s.format():"-",horas:c}}),r=Array(a.length>0?a.length-1:0).fill(null).map(function(e,t){var r=ye()(a[t].salida),n=ye()(a[t+1].entrada);return Math.round(100*ye.a.duration(n.diff(r)).as("hours"))/100}).reduce(function(e,t){return e+t},0),o=a.map(function(e){return e.horas});return a[0]?{key:a[0].key,entrada:a[0].entrada,salida:a.slice(-1)[0].salida,aprobado:!a.map(function(e){return e.aprobado}).includes(!1),horas:o.includes("-")?"-":o.reduce(function(e,t){return e+t},0),usuario:n.username,idsRegistros:e.map(function(e){return e._id}),tiempoDescanso:r}:[]}),c=Math.round(100*i.filter(function(e){return e.aprobado}).map(function(e){return e.horas}).filter(function(e){return"-"!==e&&void 0!==e}).reduce(function(e,t){return e+t},0))/100,l=s*o,u=Math.round(c/(s*o)*1e4)/100,d=Math.round(100*(l-c))/100;return Object(we.a)({},n,{jornadas:i,horasTrabajadas:c,horasPendientes:d,porcentajeHoras:u,duracionJornada:o,diasLaborables:s})});a.setState({usuarios:n,jornadasPorAprobar:[].concat.apply([],n.map(function(e){return e.jornadas})).filter(function(e){return!Array.isArray(e)&&!e.aprobado})})},a.jornadaPendiente=function(e,t){!0===e?t.forEach(function(e){F("/registros/"+e,{method:"PUT",body:{aprobado:!0}}).then(function(e){E.a.success("Se ha aprobado la jornada correctamente"),a.props.dispatch(G())}).catch(function(e){console.log(e),E.a.error("Ha ocurrido un error durante la aprobaci\xf3n de la jornada")})}):t.forEach(function(e){F("/registros/"+e,{method:"DELETE"}).then(function(e){E.a.success("Se ha denegado la jornada correctamente"),a.props.dispatch(G())}).catch(function(e){console.log(e),E.a.error("Ha ocurrido un error durante la denegaci\xf3n de la jornada")})})},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.props.es&&this.procesaES(this.state.mes.month(),this.state.mes.year())}},{key:"componentDidUpdate",value:function(e,t){e.es===this.props.es&&t.mes.isSame(this.state.mes,"month")||this.procesaES(this.state.mes.month(),this.state.mes.year())}},{key:"render",value:function(){var e=this,t=this.state,a=t.modalVisible,r=(t.modalLoading,Qe.a.MonthPicker);return n.a.createElement(b.a,{style:{height:"100vh"}},n.a.createElement(te,{isLogged:!!A()},n.a.createElement("h1",null,"Jornadas"),n.a.createElement(r,{placeholder:"Seleccionar mes",value:this.state.mes,onChange:function(t){return e.setState({mes:t})},style:{marginBottom:20}}),this.state.userInfo.manager&&!this.props.blueCollar&&n.a.createElement("div",null,n.a.createElement("h3",null,"Jornadas pendientes de aprobaci\xf3n"),n.a.createElement(Ie.a,{style:{marginBottom:"1em"},dataSource:this.state.jornadasPorAprobar,locale:{emptyText:"No hay jornadas pendientes de aprobar"},columns:[{title:"Usuario",dataIndex:"usuario",key:"usuario"},{title:"D\xeda",dataIndex:"entrada",key:"dia",render:function(e){return ye()(e).format("YYYY-MM-DD")}},{title:"Entrada",dataIndex:"entrada",key:"entrada",render:function(e){return ye()(e).format("HH:mm")}},{title:"Salida",dataIndex:"salida",key:"salida",render:function(e){return ye()(e).format("HH:mm")}},{title:"Horas",dataIndex:"horas",key:"horas"},{title:"Acci\xf3n",key:"action",render:function(t,a){return n.a.createElement("span",null,n.a.createElement(xe.a,{title:"\xbfEst\xe1s seguro de que deseas aprobar la jornada?",onConfirm:function(t){return e.jornadaPendiente(!0,a.idsRegistros)}},n.a.createElement(_e.a,{color:"green",key:"".concat(a._id,"_aceptar")},"Aceptar")),n.a.createElement(xe.a,{title:"\xbfEst\xe1s seguro de que deseas denegar jornada?",onConfirm:function(t){return e.jornadaPendiente(!1,a.idsRegistros)}},n.a.createElement(_e.a,{color:"volcano",key:"".concat(a._id,"_denegar")},"Denegar")))}}]})),n.a.createElement(Be.a,null,this.state.usuarios&&this.state.usuarios.filter(function(t){return e.state.userInfo._id===t._id||e.state.userInfo.manager&&!e.props.blueCollar}).map(function(t,a){return[n.a.createElement(Be.a.Panel,{header:n.a.createElement("div",{style:{display:"flex",justifyContent:"space-between",paddingRight:"10px"}},n.a.createElement("span",null,t.username),n.a.createElement("div",{style:{width:"200px"}},n.a.createElement(Xe.a,{percent:t.porcentajeHoras}))),key:a},n.a.createElement("div",{style:{display:"flex",flexWrap:"wrap",justifyContent:"space-evenly"}},n.a.createElement(et.a,{title:"Horas trabajadas",value:Math.trunc(t.horasTrabajadas,10)+"h "+Math.round(t.horasTrabajadas%1*60)+"m"}),n.a.createElement(et.a,{title:"Horas pendientes",value:Math.trunc(t.horasPendientes,10)+"h "+Math.round(t.horasPendientes%1*60)+"m"}),n.a.createElement(et.a,{title:"D\xedas laborables de este mes",value:t.diasLaborables}),n.a.createElement(et.a,{title:"Duraci\xf3n de jornada",value:t.duracionJornada+"h"})),n.a.createElement("h3",{style:{marginTop:20}},"Desglose de jornadas"),n.a.createElement(Ie.a,{key:"table"+a,dataSource:[].concat.apply([],t.jornadas.filter(function(e){return e.aprobado})),columns:e.columns}),(e.state.userInfo._id===t._id||e.state.userInfo.manager&&!e.props.blueCollar)&&n.a.createElement("div",{style:{display:"flex",justifyContent:"center",marginTop:20}},n.a.createElement(ie.a,{onClick:function(){return e.setState({modalVisible:!0,modalUser:t._id})}},"A\xf1adir jornada")))]}))),n.a.createElement(Pe.a,{visible:a,title:"A\xf1adir registro",onOk:this.handleNuevoRegistro,onCancel:function(){e.setState({modalVisible:!1})},style:{maxWidth:900},width:"90%",footer:null},n.a.createElement(rt,{usuario:this.state.modalUser,cerrarModal:function(){return e.setState({modalVisible:!1})}})))}}]),t}(r.Component),ot=Object(U.socketConnect)(Object(L.b)(function(e){return{es:e.es,dias:e.dias,blueCollar:e.blueCollar}})(nt)),st=function(e){function t(){var e,a;Object(i.a)(this,t);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={loading:!1,nombre:I().nombre||""},a.handleUpload=function(e){e.onSuccess,e.onError;var t=e.file,r=new FormData,n="image/jpeg"===t.type||"image/png"===t.type;n||E.a.error("Solo se aceptan imagenes en formato JPG y PNG");var o=t.size/1024/1024<2;o||E.a.error("Las imagenes han de ser m\xe1s peque\xf1as de 2MB"),n&&o&&(r.append("files",t),r.append("field","avatar"),r.append("refId",I()._id),r.append("ref","user"),r.append("source","users-permissions"),a.setState({loading:!0}),F("/upload",{method:"POST",body:r},!1).then(function(e){console.log(e),a.setState({loading:!1}),E.a.success("El avatar se actualiz\xf3 correctamente.");var t=I();t.avatar=e[0],window.localStorage.setItem("user",JSON.stringify(t))}).catch(function(e){a.setState({loading:!1}),console.log(e),E.a.error("Ocurri\xf3 un error durante la subida del nuevo avatar")}))},a.handleSave=function(){F("/users/"+I()._id,{method:"PUT",body:{nombre:a.state.nombre}}).then(function(e){var t=I();t.nombre=a.state.nombre,window.localStorage.setItem("user",JSON.stringify(t)),E.a.success("Los datos se guardaron correctamente")}).catch(function(e){E.a.error("Ocurri\xf3 un error durante el guardado de datos"),console.log(e)})},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this,t=n.a.createElement("div",null,n.a.createElement(w.a,{type:this.state.loading?"loading":"plus"}),n.a.createElement("div",{className:"ant-upload-text"},"Upload")),a=this.state.imageUrl;return n.a.createElement(b.a,{style:{height:"100vh"}},n.a.createElement(te,{isLogged:!!A()},n.a.createElement("h1",null,"Perfil"),n.a.createElement("div",{style:{width:"320px",marginBottom:20}},n.a.createElement(Re.a,{name:"avatar",listType:"picture-card",className:"avatar-uploader",showUploadList:!1,onChange:this.handleChange,customRequest:this.handleUpload},a?n.a.createElement("img",{src:a,alt:"avatar"}):t),n.a.createElement(re.a.Item,{label:"Nombre",style:{marginRight:20}},n.a.createElement(ne.a,{type:"text",value:this.state.nombre,onChange:function(t){return e.setState({nombre:t.target.value})}})),n.a.createElement(ie.a,{onClick:this.handleSave},"Guardar"))))}}]),t}(r.Component),it=function(e){function t(){var e,a;Object(i.a)(this,t);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=Be.a.Panel;return n.a.createElement(b.a,{style:{height:"100vh"}},n.a.createElement(te,{isLogged:!!A()},n.a.createElement("h1",null,"Configuraci\xf3n"),n.a.createElement(Be.a,{defaultActiveKey:["grupos"]},n.a.createElement(e,{key:"grupos",header:"Grupos de usuarios"}),n.a.createElement(e,{key:"nuevoGrupo",header:"Nuevo grupo de usuarios"}))))}}]),t}(r.Component),ct=function(e){function t(){var e,a;Object(i.a)(this,t);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={},a.addFestivo=function(){a.state.nombre?a.state.fecha?F("/dias",{method:"POST",body:{fecha:ye.a.utc(a.state.fecha).format(),tipo:"festivo",nombre:a.state.nombre,equipo:I().equipo,aprobado:!0}}).then(function(e){E.a.success("El nuevo festivo se ha a\xf1adido correctamente"),a.props.dispatch(J()),a.setState({nombre:void 0,fecha:void 0})}).catch(function(e){console.log(e),E.a.error("Se ha producido un error durante la creaci\xf3n del nuevo festivo")}):E.a.warning("No se ha seleccionado ninguna fecha"):E.a.warning("No se ha asignado nombre al festivo")},a.borrarFestivo=function(e){F("/dias/"+e._id,{method:"DELETE"}).then(function(e){E.a.success("Se ha borrado el festivo correctamente"),a.props.dispatch(J())}).catch(function(e){console.log(e),E.a.error("Ha ocurrido un error durante el borrado del festivo")})},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return n.a.createElement("div",null,n.a.createElement("h3",null,"Lista de festivos"),n.a.createElement(Ie.a,{dataSource:this.props.dias.filter(function(e){return"festivo"===e.tipo}),rowKey:"_id",columns:[{title:"Nombre",dataIndex:"nombre",key:"nombre"},{title:"D\xeda",key:"fecha",render:function(e){return ye()(e.fecha).format("YYYY-MM-DD")}},{key:"botones",render:function(t){return n.a.createElement("div",{key:t._id,style:{display:"flex",justifyContent:"flex-end"}},n.a.createElement(xe.a,{title:"\xbfEst\xe1s seguro de que quieres borrar el d\xeda festivo?",onConfirm:function(){return e.borrarFestivo(t)},icon:n.a.createElement(w.a,{type:"warning",style:{color:"red"}})},n.a.createElement(_e.a,{color:"volcano",key:"".concat(t._id,"_dia")},n.a.createElement(w.a,{type:"delete"})," Borrar")))}}]}),n.a.createElement("h3",{style:{marginTOp:20}},"A\xf1adir festivo"),n.a.createElement("div",{style:{display:"flex",flexWrap:"wrap"}},n.a.createElement(re.a.Item,{label:"Nombre",style:{marginRight:20}},n.a.createElement(ne.a,{type:"text",onChange:function(t){return e.setState({nombre:t.target.value})}})),n.a.createElement(re.a.Item,{label:"Fecha",style:{marginRight:20}},n.a.createElement(Qe.a,{onChange:function(t){return e.setState({fecha:t})},style:{width:250}})),n.a.createElement(re.a.Item,{label:" ",colon:!1},n.a.createElement(ie.a,{onClick:this.addFestivo},"A\xf1adir"))))}}]),t}(r.Component),lt=Object(L.b)(function(e){return{dias:e.dias}})(ct),ut=function(e){function t(){var e,a;Object(i.a)(this,t);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=Be.a.Panel;return n.a.createElement(b.a,{style:{height:"100vh"}},n.a.createElement(te,{isLogged:!!A()},n.a.createElement("h1",null,"Configuraci\xf3n"),n.a.createElement(Be.a,null,n.a.createElement(e,{header:"A\xf1adir registros"},n.a.createElement(rt,null))),n.a.createElement(Be.a,null,n.a.createElement(e,{header:"Gestionar festivos"},n.a.createElement(lt,null)))))}}]),t}(r.Component),dt=a(77);var mt=Object(dt.c)({usuarios:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case T:return console.log(t),t.payload;default:return e}},dias:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case M:return console.log(t),t.payload;default:return e}},es:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case q:return console.log(t),t.payload;default:return e}},documentos:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case N:return console.log(t),t.payload;default:return e}},blueCollar:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case R:return t.payload;default:return e}}}),pt=a(260),ft=Object(dt.d)(mt,{},Object(dt.a)(pt.a));ye.a.locale("es");var ht=ve.a.connect("https://we.blacknosaur.com",{transports:["websocket"]}),gt=function(e){function t(){return Object(i.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=I();e&&e.equipo&&(ft.dispatch(H()),ft.dispatch(J()),ft.dispatch(G()),ft.dispatch(z()))}},{key:"render",value:function(){return n.a.createElement(L.a,{store:ft},n.a.createElement(pe.a,{locale:he.a},n.a.createElement(U.SocketProvider,{socket:ht},n.a.createElement(m.a,null,n.a.createElement(p.a,null,n.a.createElement(f.a,{exact:!0,path:"/login",component:le}),n.a.createElement(f.a,{exact:!0,path:"/register",component:de}),n.a.createElement(ke,{exact:!0,path:"/calendario",component:Le}),n.a.createElement(ke,{exact:!0,path:"/archivos",component:Ge}),n.a.createElement(ke,{exact:!0,path:"/perfil",component:st}),n.a.createElement(ke,{exact:!0,path:"/usuarios",component:Ve}),n.a.createElement(ke,{onlyManager:!0,exact:!0,path:"/analitica",component:Ze}),n.a.createElement(ke,{onlyManager:!0,exact:!0,path:"/grupos",component:it}),n.a.createElement(ke,{onlyManager:!0,exact:!0,path:"/configuracion",component:ut}),n.a.createElement(ke,{exact:!0,path:"/usuario/:id",component:$e}),n.a.createElement(ke,{exact:!0,path:"/registro",component:ot}),n.a.createElement(ke,{exact:!0,path:"/nuevousuario",component:Ne}),n.a.createElement(ke,{exact:!0,path:"/",component:Se}),n.a.createElement(f.a,{path:"",component:me}))))))}}]),t}(r.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(n.a.createElement(gt,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[268,1,2]]]);
//# sourceMappingURL=main.81e4e4bd.chunk.js.map